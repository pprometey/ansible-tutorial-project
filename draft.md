---
title: –û—Å–Ω–æ–≤—ã Ansible –∑–∞ 13 —à–∞–≥–æ–≤
description: –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π –∫—É—Ä—Å –ø–æ –æ—Å–Ω–æ–≤–∞–º Ansible —Å –≥–æ—Ç–æ–≤—ã–º –æ–∫—Ä—É–∂–µ–Ω–∏–µ–º –Ω–∞ –±–∞–∑–µ Docker –∏ VS Code Dev Containers –¥–ª—è –ø–æ—ç—Ç–∞–ø–Ω–æ–≥–æ –∏–∑—É—á–µ–Ω–∏—è –∏ –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–æ–≥–æ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è.
lang: ru
draft: false
publish: true
tags: ["infrastructure automation tools", "ansible", "devops", "dev containers", "docker", "infrastructure as code"]
created: 2025-07-18 15:26
---

## –í–≤–µ–¥–µ–Ω–∏–µ

–≠—Ç–æ—Ç –∫—É—Ä—Å –ø–æ –æ—Å–Ω–æ–≤–∞–º Ansible –ø–æ—Å—Ç—Ä–æ–µ–Ω –Ω–∞ –æ—Å–Ω–æ–≤–µ –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è, –∏—Å–ø–æ–ª—å–∑—É—é—â–µ–≥–æ Docker-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã, Visual Studio Code –∏ –∏ –ø–ª–∞–≥–∏–Ω Dev Containers. –¢–∞–∫–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ –ø–æ–∑–≤–æ–ª—è–µ—Ç –±—ã—Å—Ç—Ä–æ —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç—å –≥–æ—Ç–æ–≤—É—é –ø–ª–∞—Ç—Ñ–æ—Ä–º—É –¥–ª—è –∏–∑—É—á–µ–Ω–∏—è –æ—Å–Ω–æ–≤ Ansible, –Ω–µ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—è –Ω–∏—á–µ–≥–æ –ª–∏—à–Ω–µ–≥–æ –Ω–∞ –≤–∞—à—É –æ—Å–Ω–æ–≤–Ω—É—é —Å–∏—Å—Ç–µ–º—É.

–î–ª—è –ª—É—á—à–µ–≥–æ —É—Å–≤–æ–µ–Ω–∏—è –º–∞—Ç–µ—Ä–∏–∞–ª–∞ –Ω–∞—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –ø–æ–≤—Ç–æ—Ä–∏—Ç—å –≤—Å–µ —à–∞–≥–∏ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–∞ –≤—Ä—É—á–Ω—É—é, —Å–æ–∑–¥–∞–≤–∞—è –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç—ã —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ. –≠—Ç–æ –ø–æ–º–æ–∂–µ—Ç –≥–ª—É–±–∂–µ –ø–æ–Ω—è—Ç—å –ø—Ä–æ—Ü–µ—Å—Å—ã –∏ –ª—É—á—à–µ –∑–∞–ø–æ–º–Ω–∏—Ç—å –∫–ª—é—á–µ–≤—ã–µ –∫–æ–Ω—Ü–µ–ø—Ü–∏–∏.

- –ü—É—Å—Ç–æ–π —à–∞–±–ª–æ–Ω –¥–ª—è –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è –∫—É—Ä—Å–∞ —Å —Å–∞–º–æ–≥–æ –Ω–∞—á–∞–ª–∞:
  <https://github.com/pprometey/ansible-tutorial-lab>
- –ü–æ–ª–Ω—ã–π –ø—Ä–æ–µ–∫—Ç –∫—É—Ä—Å–∞ —Å–æ –≤—Å–µ–º–∏ –≥–æ—Ç–æ–≤—ã–º–∏ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–∞–º–∏ –∏ –∏—Å—Ç–æ—Ä–∏–µ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏:
  <https://github.com/pprometey/ansible-tutorial-project>

### –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —ç—Ç–æ –æ–∫—Ä—É–∂–µ–Ω–∏–µ –¥–ª—è –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è –∫—É—Ä—Å–∞

1. **–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ Docker Desktop:**

    –î–ª—è Windows, Mac –∏–ª–∏ Linux ‚Äî —Å–ª–µ–¥—É–π—Ç–µ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–º –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º:
    <https://docs.docker.com/get-docker/>

2. **–ö–ª–æ–Ω–∏—Ä—É–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –∫—É—Ä—Å–∞:**

    ```bash
    git clone https://github.com/pprometey/ansible-tutorial-lab.git
    ```

    –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ –∫–∞—Ç–∞–ª–æ–≥ —Å–∫–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è, —ç—Ç–æ –∏ –±—É–¥–µ—Ç –∫–æ—Ä–Ω–µ–≤–æ–π –∫–∞—Ç–∞–ª–æ–≥ –ø—Ä–æ–µ–∫—Ç–∞:

    ```bash
    cd ansible-tutorial-lab
    ```

3. **–ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –æ–∫—Ä—É–∂–µ–Ω–∏—è –¥–ª—è SSH-–∫–ª—é—á–µ–π:**

    - **Windows (PowerShell):**

    ```powershell
    [System.Environment]::SetEnvironmentVariable("DEFAULT_SSH_KEY", "<–ø—É—Ç—å_–∫_–ø–∞–ø–∫–µ_—Å_–∫–ª—é—á–∞–º–∏>", "User")
    ```

    –ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –≤—Å–µ –æ–∫–Ω–∞ VS Code.

    - **Mac/Linux (bash):**
    –î–æ–±–∞–≤—å—Ç–µ –≤ `~/.bashrc` –∏–ª–∏ `~/.zshrc`:

    ```bash
    export DEFAULT_SSH_KEY="<–ø—É—Ç—å_–∫_–ø–∞–ø–∫–µ_—Å_–∫–ª—é—á–∞–º–∏>"
    ```

    –ó–∞—Ç–µ–º –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:

    ```bash
    source ~/.bashrc
    ```

    –∏–ª–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ —Ç–µ—Ä–º–∏–Ω–∞–ª.

    –í —É–∫–∞–∑–∞–Ω–Ω–æ–π –ø–∞–ø–∫–µ –¥–æ–ª–∂–Ω—ã –Ω–∞—Ö–æ–¥–∏—Ç—å—Å—è –¥–≤–∞ —Ñ–∞–π–ª–∞ —Å –∏–º–µ–Ω–∞–º–∏ id_rsa –∏ id_rsa.pub, —ç—Ç–æ –ø—Ä–∏–≤–∞—Ç–Ω—ã–π –∏ –ø—É–±–ª–∏—á–Ω—ã–π SSH-–∫–ª—é—á–∏, –∫–æ—Ç–æ—Ä—ã–µ –±—É–¥—É—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è Ansible –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ —Ü–µ–ª–µ–≤—ã–º —É–∑–ª–∞–º.

4. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞:**

    - Windows (PowerShell):

    ```powershell
    $env:DEFAULT_SSH_KEY
    ```

    - Mac/Linux (bash):

    ```bash
    echo $DEFAULT_SSH_KEY
    ```

5. **–ó–∞–ø—É—Å—Ç–∏—Ç–µ –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ –≤ VS Code —Å —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ–º Remote - Containers:**

    - –û—Ç–∫—Ä–æ–π—Ç–µ VS Code –≤—ã–ø–æ–ª–Ω–∏–≤ –∫–æ–º–∞–Ω–¥—É `code .`
    - [–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ **Remote - Containers**](https://marketplace.visualstudio.com/items?itemName=ms-vscode-remote.remote-containers) –¥–ª—è VS Code, –µ—Å–ª–∏ –æ–Ω–æ –µ—â–µ –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ.
    - –ù–∞–∂–º–∏—Ç–µ `F1` –∏ –≤—ã–±–µ—Ä–∏—Ç–µ **Remote-Containers: Reopen in Container**.
      –≠—Ç–æ –∑–∞–ø—É—Å—Ç–∏—Ç –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã —Å Ansible-–º–∞—Å—Ç–µ—Ä–æ–º –∏ —Ü–µ–ª–µ–≤—ã–º–∏ –Ω–æ–¥–∞–º–∏.

## –ß—Ç–æ —Ç–∞–∫–æ–µ Ansible

**Ansible** ‚Äî —ç—Ç–æ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è–º–∏ (*Configuration Management Tool*), –ø–æ—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π –ø–æ –º–æ–¥–µ–ª–∏ push: —É–ø—Ä–∞–≤–ª—è—é—â–∏–π —É–∑–µ–ª –∏–Ω–∏—Ü–∏–∏—Ä—É–µ—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ —É–ø—Ä–∞–≤–ª—è–µ–º—ã–º —Ö–æ—Å—Ç–∞–º –ø–æ SSH –∏ –ø—Ä–∏–º–µ–Ω—è–µ—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –±–µ–∑ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–≥–æ –ü–û –Ω–∞ —ç—Ç–∏—Ö —Ö–æ—Å—Ç–∞—Ö.

–°—É—â–µ—Å—Ç–≤—É—é—Ç –¥–≤–∞ –ø–æ–¥—Ö–æ–¥–∞ –∫ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω–æ–º—É —É–ø—Ä–∞–≤–ª–µ–Ω–∏—é:

- **Pull-–º–æ–¥–µ–ª—å** ‚Äî –Ω–∞ —É–ø—Ä–∞–≤–ª—è–µ–º—ã–µ —Ö–æ—Å—Ç—ã —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—Ç—Å—è –∞–≥–µ–Ω—Ç—ã, –∫–æ—Ç–æ—Ä—ã–µ —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ –∑–∞–±–∏—Ä–∞—é—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ —Å —É–ø—Ä–∞–≤–ª—è—é—â–µ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, *Chef*, *Puppet*, *SaltStack*).
- **Push-–º–æ–¥–µ–ª—å** ‚Äî —É–ø—Ä–∞–≤–ª—è—é—â–∏–π —Å–µ—Ä–≤–µ—Ä —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –∫ —Ö–æ—Å—Ç–∞–º –∏ –ø—Ä–∏–º–µ–Ω—è–µ—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, *Ansible*).

```mermaid
flowchart LR
    AnsibleMaster["üñ•Ô∏è Ansible Master"]
    ClientDebian["üñ•Ô∏è client-linux-debian"]
    ClientRedHat["üñ•Ô∏è client-linux-redhat"]
    ClientWindows["üñ•Ô∏è client-windows"]

    AnsibleMaster -->|Push| ClientDebian
    AnsibleMaster -->|Push| ClientRedHat
    AnsibleMaster -->|Push| ClientWindows
```

### –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

**–£–ø—Ä–∞–≤–ª—è—é—â–∏–π —Å–µ—Ä–≤–µ—Ä (master):**

- –¢–æ–ª—å–∫–æ Linux
- Python –≤–µ—Ä—Å–∏–∏ 2.6+ –∏–ª–∏ 3.5+

**–£–ø—Ä–∞–≤–ª—è–µ–º—ã–µ —Å–µ—Ä–≤–µ—Ä—ã (managed):**

- **Linux:** –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å –ø—Ä–∞–≤–∞–º–∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ –∏ –¥–æ—Å—Ç—É–ø –ø–æ –ø–∞—Ä–æ–ª—é –∏–ª–∏ SSH-–∫–ª—é—á—É, Python 2.6+
- **Windows:** –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å –ø—Ä–∞–≤–∞–º–∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞, PowerShell –≤–µ—Ä—Å–∏–∏ 3.0+, –∑–∞–ø—É—Å–∫ —Å–∫—Ä–∏–ø—Ç–∞ `ConfigureRemotingForAnsible.ps1`

### –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Ansible

–ü–æ—Å–∫–æ–ª—å–∫—É –º—ã –∏—Å–ø–ª—å–∑—É–µ–º —É–∂–µ –≥–æ—Ç–æ–≤–æ–µ –∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ, —ç—Ç–æ—Ç –º—ã –º–æ–∂–µ–º –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å. –ù–æ –æ–∑–Ω–∞–∫–æ–º–∏—Ç—å—Å—è —Å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–µ–π –ø–æ —É—Å—Ç–∞–Ω–æ–≤–∫–µ –º–æ–∂–Ω–æ –Ω–∞ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–º —Å–∞–π—Ç–µ:  
<https://docs.ansible.com/ansible/latest/installation_guide/intro_installation.html>

## –®–∞–≥ 1. –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –∫–ª–∏–µ–Ω—Ç–∞–º –∏ –∏–Ω–≤–µ–Ω—Ç–æ—Ä–∏-—Ñ–∞–π–ª

–ü–µ—Ä–≤—ã–º —à–∞–≥–æ–º –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —Å–æ–∑–¥–∞—Ç—å **inventory-—Ñ–∞–π–ª** ‚Äî —ç—Ç–æ —Ñ–∞–π–ª, –≤ –∫–æ—Ç–æ—Ä–æ–º –æ–ø–∏—Å—ã–≤–∞—é—Ç—Å—è —Ü–µ–ª–µ–≤—ã–µ —Ö–æ—Å—Ç—ã –∏ –≥—Ä—É–ø–ø—ã —Ö–æ—Å—Ç–æ–≤ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è.

### –í–æ–∑–º–æ–∂–Ω—ã–µ –∏–º–µ–Ω–∞ inventory-—Ñ–∞–π–ª–æ–≤

- `/etc/ansible/hosts` ‚Äî —Å–∏—Å—Ç–µ–º–Ω—ã–π —Ñ–∞–π–ª –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
- –õ—é–±–æ–π –¥—Ä—É–≥–æ–π —Ñ–∞–π–ª, —É–∫–∞–∑–∞–Ω–Ω—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–º `-i` –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ
- –ß–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è:
  - `hosts`
  - `inventory`
  - `production`, `staging`, `dev` ‚Äî –ø–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è–º
  - `inventory.ini`, `inventory.yaml`, `inventory.json` ‚Äî –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ñ–æ—Ä–º–∞—Ç–∞

### –¢–∏–ø—ã inventory

- **–°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π**: –ø—Ä–æ—Å—Ç–æ–π —Ñ–∞–π–ª (`.ini`, `.yaml`, `.json`)
- **–î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π**: —Å–∫—Ä–∏–ø—Ç –∏–ª–∏ –ø–ª–∞–≥–∏–Ω, –≤–æ–∑–≤—Ä–∞—â–∞—é—â–∏–π —Å–ø–∏—Å–æ–∫ —Ö–æ—Å—Ç–æ–≤ –Ω–∞ –ª–µ—Ç—É

–°–æ–∑–¥–∞–¥–∏–º —Ñ–∞–π–ª `hosts` –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞ –∏ –æ–ø—Ä–µ–¥–µ–ª–∏–º —Ö–æ—Å—Ç—ã –∏ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è:

```ini
[minions]
minion1 ansible_user=developer ansible_ssh_private_key_file=/home/developer/.ssh/id_rsa ansible_python_interpreter=/usr/bin/python3
minion2 ansible_user=developer ansible_ssh_private_key_file=/home/developer/.ssh/id_rsa ansible_python_interpreter=/usr/bin/python3
```

–¢–µ–ø–µ—Ä—å –º–æ–∂–Ω–æ –≤—ã–ø–æ–ª–Ω–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è, –≤—ã–ø–æ–ª–Ω–∏–≤ –∫–æ–º–∞–Ω–¥—É:

```bash
ansible -i hosts all -m ping
```

–ü–æ—è—Å–Ω–µ–Ω–∏—è –∫ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º:

- `-i hosts` ‚Äî —É–∫–∞–∑–∞–Ω–∏–µ –ø—É—Ç–∏ –∫ inventory-—Ñ–∞–π–ª—É
- `all` ‚Äî –ø—Ä–∏–º–µ–Ω–∏—Ç—å –∫–æ –≤—Å–µ–º —Ö–æ—Å—Ç–∞–º
- `-m ping` ‚Äî –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –º–æ–¥—É–ª—å `ping`

–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:

```bash
minion2 | SUCCESS => {
    "changed": false,
    "ping": "pong"
}
minion1 | SUCCESS => {
    "changed": false,
    "ping": "pong"
}
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–ª—é—á–∞ SSH

–ü—Ä–∏ –ø–µ—Ä–≤–æ–º –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–∏ –∫ —Ö–æ—Å—Ç—É SSH –∑–∞–ø—Ä–æ—Å–∏—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –ø–æ–¥–ª–∏–Ω–Ω–æ—Å—Ç–∏:

```sh
The authenticity of host 'minion2 (172.18.0.2)' can't be established.
ED25519 key fingerprint is SHA256:WW96QnhRxdH6bes4Jb7XizPiJxmICoQUu/dDokoRm/M.
Are you sure you want to continue connecting (yes/no/[fingerprint])?
```

–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:

- SSH-–∫–ª–∏–µ–Ω—Ç –Ω–µ –∑–Ω–∞–µ—Ç –ø—É–±–ª–∏—á–Ω–æ–≥–æ –∫–ª—é—á–∞ —Ö–æ—Å—Ç–∞.
- –û–Ω –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç *–æ—Ç–ø–µ—á–∞—Ç–æ–∫* –∫–ª—é—á–∞ –∏ –ø—Ä–æ—Å–∏—Ç –ø–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å, —á—Ç–æ –≤—ã –¥–æ–≤–µ—Ä—è–µ—Ç–µ —Å–µ—Ä–≤–µ—Ä—É.
- –ü–æ—Å–ª–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –∫–ª—é—á —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ `~/.ssh/known_hosts`.
- –í –¥–∞–ª—å–Ω–µ–π—à–µ–º –ø—Ä–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–∏ –±—É–¥–µ—Ç –ø—Ä–æ–≤–µ—Ä—è—Ç—å—Å—è —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –∫–ª—é—á–∞ ‚Äî —ç—Ç–æ –∑–∞—â–∏—Ç–∞ –æ—Ç MITM-–∞—Ç–∞–∫.

–ú–æ–∂–Ω–æ –æ—Ç–∫–ª—é—á–∏—Ç—å —ç—Ç—É –ø—Ä–æ–≤–µ—Ä–∫—É (–≤ —Ü–µ–ª—è—Ö —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏), –Ω–æ **–≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ —ç—Ç–æ –∫—Ä–∞–π–Ω–µ –Ω–µ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è**.

–°–æ–∑–¥–∞–¥–∏–º —Ñ–∞–π–ª `ansible.cfg`:

```ini
[defaults]
host_key_checking = false
inventory = ./hosts
```

–¢–µ–ø–µ—Ä—å –º–æ–∂–Ω–æ –∑–∞–ø—É—Å–∫–∞—Ç—å –∫–æ–º–∞–Ω–¥—ã –±–µ–∑ —É–∫–∞–∑–∞–Ω–∏—è `-i hosts`.

---

## –ü—Ä–∞–≤–∏–ª–∞ —Å–æ–∑–¥–∞–Ω–∏—è inventory-—Ñ–∞–π–ª–∞

–ü—Ä–∏–º–µ—Ä—ã:

```ini
# –ü—Ä–æ—Å—Ç–æ IP-–∞–¥—Ä–µ—Å–∞
10.0.15.12
10.0.15.13

# –ê–ª–∏–∞—Å –∏ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
ansible-debian ansible_host=10.0.15.12
```

### –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ —Ö–æ—Å—Ç–æ–≤

```ini
[group_name]
hostname ansible_host=10.0.15.12
```

–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –¥–æ—Å—Ç—É–ø–Ω—ã –¥–≤–µ –≥—Ä—É–ø–ø—ã:

- `all` ‚Äî –≤—Å–µ —Ö–æ—Å—Ç—ã
- `ungrouped` ‚Äî —Ö–æ—Å—Ç—ã, –Ω–µ –≤—Ö–æ–¥—è—â–∏–µ –Ω–∏ –≤ –æ–¥–Ω—É –≥—Ä—É–ø–ø—É

–ü–æ–∫–∞–∑–∞—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É –º–æ–∂–Ω–æ –∫–æ–º–∞–Ω–¥–æ–π:

```bash
ansible-inventory --graph
```

–ü—Ä–∏–º–µ—Ä –≤—ã–≤–æ–¥–∞:

```bash
@all:
  |--@ungrouped:
  |  |--10.0.15.11
  |--@cluster_servers:
  |  |--@master_servers:
  |  |  |--control1
  |  |--@worker_servers:
  |  |  |--worker1
  |  |  |--worker2
```

### –í–ª–æ–∂–µ–Ω–Ω—ã–µ –≥—Ä—É–ø–ø—ã (`:children`)

```ini
10.0.15.11

[master_servers]
control1 ansible_host=10.0.15.12

[worker_servers]
worker1 ansible_host=10.0.15.13
worker2 ansible_host=10.0.15.14

[cluster_servers:children]
master_servers
worker_servers
```

–ú–æ–∂–Ω–æ —Å–æ–∑–¥–∞–≤–∞—Ç—å –∏ –±–æ–ª–µ–µ –≥–ª—É–±–æ–∫–∏–µ —É—Ä–æ–≤–Ω–∏ –≤–ª–æ–∂–µ–Ω–Ω–æ—Å—Ç–∏:

```ini
[all_cluster_servers:children]
cluster_servers
cluster2_servers
```

### –û–±—â–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è –≥—Ä—É–ø–ø (`:vars`)

```ini
[cluster_servers:children]
master_servers
worker_servers

[cluster_servers:vars]
ansible_user=developer
ansible_ssh_private_key_file=/home/developer/.ssh/id_rsa
ansible_python_interpreter=/usr/bin/python3
```

–ò—Ç–æ–≥–æ–≤—ã–π –ø—Ä–∏–º–µ—Ä —Ñ–∞–π–ª–∞ `hosts`:

```ini
[master_servers]
minion1

[worker_servers]
minion2

[cluster_servers:children]
master_servers
worker_servers

[cluster_servers:vars]
ansible_user=developer
ansible_ssh_private_key_file=/home/developer/.ssh/id_rsa
ansible_python_interpreter=/usr/bin/python3
```

## –®–∞–≥ 2. –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ ad-hoc –∫–æ–º–∞–Ω–¥ –∏ –æ—Å–Ω–æ–≤–Ω—ã–µ –º–æ–¥—É–ª–∏ Ansible

**Ad-hoc –∫–æ–º–∞–Ω–¥—ã** ‚Äî —ç—Ç–æ –æ–¥–Ω–æ–∫—Ä–∞—Ç–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã, –∫–æ—Ç–æ—Ä—ã–µ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –Ω–∞–ø—Ä—è–º—É—é –∏–∑ –∫–æ–º–∞–Ω–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–∏, –±–µ–∑ –Ω–∞–ø–∏—Å–∞–Ω–∏—è –ø–ª–µ–π–±—É–∫–æ–≤. –í—Å–µ –¥–µ–π—Å—Ç–≤–∏—è –≤ Ansible –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è —Å –ø–æ–º–æ—â—å—é *–º–æ–¥—É–ª–µ–π*.

–ü—Ä–æ—Å—Ç–µ–π—à–∏–π –ø—Ä–∏–º–µ—Ä:

```bash
ansible all -m ping
```

–≠—Ç–∞ –∫–æ–º–∞–Ω–¥–∞ –≥–æ–≤–æ—Ä–∏—Ç Ansible –≤—ã–ø–æ–ª–Ω–∏—Ç—å –Ω–∞ –≤—Å–µ—Ö —Ö–æ—Å—Ç–∞—Ö, —É–∫–∞–∑–∞–Ω–Ω—ã—Ö –≤ inventory-—Ñ–∞–π–ª–µ, –º–æ–¥—É–ª—å `ping`, –∫–æ—Ç–æ—Ä—ã–π –ø—Ä–æ—Å—Ç–æ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –º–∞—à–∏–Ω.

–î–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –ø–æ–¥—Ä–æ–±–Ω–æ–π —Å–ª—É–∂–µ–±–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä `-v` (verbose):

- `-v` ‚Äî –∫—Ä–∞—Ç–∫–∏–π –≤—ã–≤–æ–¥
- `-vv` ‚Äî –ø–æ–¥—Ä–æ–±–Ω—ã–π
- `-vvv` ‚Äî –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –ø–æ–¥—Ä–æ–±–Ω—ã–π

–ü—Ä–∏–º–µ—Ä:

```bash
ansible cluster_servers -m shell -a "ls -lpa /home/developer" -vvv
```

–°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –º–æ–¥—É–ª–µ–π –º–æ–∂–Ω–æ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –∫–æ–º–∞–Ω–¥–æ–π:

```bash
ansible-doc -l
```

---

### –û—Å–Ω–æ–≤–Ω—ã–µ –º–æ–¥—É–ª–∏ Ansible

#### `setup`

–ú–æ–¥—É–ª—å `setup` —Å–æ–±–∏—Ä–∞–µ—Ç —Ñ–∞–∫—Ç—ã –æ —Ü–µ–ª–µ–≤–æ–π —Å–∏—Å—Ç–µ–º–µ:

```bash
ansible master_servers -m setup
```

–û–Ω –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø–æ–¥—Ä–æ–±–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ–± –û–°, –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ, —Å–µ—Ç–µ–≤—ã—Ö –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞—Ö –∏ —Ç.–¥.

---

#### `shell`

–ú–æ–¥—É–ª—å `shell` –ø–æ–∑–≤–æ–ª—è–µ—Ç –∑–∞–ø—É—Å–∫–∞—Ç—å –∫–æ–º–∞–Ω–¥—ã –æ–±–æ–ª–æ—á–∫–∏ (bash/sh):

```bash
ansible all -m shell -a "uptime"
```

–ü—Ä–∏–º–µ—Ä –≤—ã–≤–æ–¥–∞:

```bash
minion1 | CHANGED | rc=0 >>
 13:35:43 up 32 min,  0 users,  load average: 0.02, 0.07, 0.09
```

---

#### `shell` vs `command`

–û–±–∞ –º–æ–¥—É–ª—è –ø–æ–∑–≤–æ–ª—è—é—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å –∫–æ–º–∞–Ω–¥—ã, –Ω–æ —Å –≤–∞–∂–Ω—ã–º –æ—Ç–ª–∏—á–∏–µ–º:

- `shell` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –æ–±–æ–ª–æ—á–∫—É (bash/sh) ‚Äî –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è, `>`, `|`, `&&`, `*` –∏ —Ç.–¥.
- `command` ‚Äî –≤—ã–∑—ã–≤–∞–µ—Ç –∫–æ–º–∞–Ω–¥—ã –Ω–∞–ø—Ä—è–º—É—é, –±–µ–∑ –æ–±–æ–ª–æ—á–∫–∏.

–ü—Ä–∏–º–µ—Ä:

```bash
ansible all -m shell -a "ls /home/developer"
ansible all -m command -a "ls /home/developer"
```

–ú–æ–¥—É–ª—å `shell` –ø—Ä–µ–¥–ø–æ—á—Ç–∏—Ç–µ–ª–µ–Ω –¥–ª—è —Å–ª–æ–∂–Ω—ã—Ö –∫–æ–º–∞–Ω–¥, –Ω–æ –º–µ–Ω–µ–µ –±–µ–∑–æ–ø–∞—Å–µ–Ω ‚Äî –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –µ–≥–æ —Å –Ω–µ–æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–º–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏.

---

#### `copy`

–ú–æ–¥—É–ª—å `copy` –∫–æ–ø–∏—Ä—É–µ—Ç —Ñ–∞–π–ª—ã —Å —É–ø—Ä–∞–≤–ª—è—é—â–µ–≥–æ —Ö–æ—Å—Ç–∞ –Ω–∞ —É–ø—Ä–∞–≤–ª—è–µ–º—ã–µ.

–ü—Ä–∏–º–µ—Ä (–ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ —Å–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `hi.txt` –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞):

```bash
ansible all -m copy -a "src=hi.txt dest=/home/developer mode=0777"
```

–ï—Å–ª–∏ –Ω—É–∂–Ω–æ –≤—ã–ø–æ–ª–Ω–∏—Ç—å –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç –∏–º–µ–Ω–∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ (`sudo`), –¥–æ–±–∞–≤—å—Ç–µ `-b`:

```bash
ansible all -m copy -a "src=hi.txt dest=/home mode=0777" -b
```

–§–ª–∞–≥ `-b` (`--become`) –æ–∑–Ω–∞—á–∞–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –æ—Ç –∏–º–µ–Ω–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å –ø—Ä–∞–≤–∞–º–∏ root.

---

#### `file`

–ú–æ–¥—É–ª—å `file` –ø–æ–∑–≤–æ–ª—è–µ—Ç –∏–∑–º–µ–Ω—è—Ç—å —Å–≤–æ–π—Å—Ç–≤–∞ —Ñ–∞–π–ª–æ–≤ –∏ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π (—Å–æ–∑–¥–∞–≤–∞—Ç—å, —É–¥–∞–ª—è—Ç—å, –∏–∑–º–µ–Ω—è—Ç—å –ø—Ä–∞–≤–∞ –∏ –≤–ª–∞–¥–µ–ª—å—Ü–∞).

–ü—Ä–∏–º–µ—Ä —É–¥–∞–ª–µ–Ω–∏—è —Ñ–∞–π–ª–∞:

```bash
ansible all -m file -a "path=/home/hi.txt state=absent" -b
```

–ü–æ–≤—Ç–æ—Ä–Ω—ã–π –∑–∞–ø—É—Å–∫ —ç—Ç–æ–π –∫–æ–º–∞–Ω–¥—ã –Ω–µ –ø—Ä–∏–≤–µ–¥—ë—Ç –∫ –æ—à–∏–±–∫–µ ‚Äî Ansible —Å–æ–æ–±—â–∏—Ç `"changed": false`, –µ—Å–ª–∏ —Ñ–∞–π–ª —É–∂–µ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç:

```bash
minion1 | SUCCESS => {
    "changed": false,
    "path": "/home/hi.txt",
    "state": "absent"
}
```

---

#### `get_url`

–ü–æ–∑–≤–æ–ª—è–µ—Ç —Å–∫–∞—á–∏–≤–∞—Ç—å —Ñ–∞–π–ª—ã –∏–∑ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞:

```bash
ansible all -m get_url -a "url=https://raw.githubusercontent.com/pprometey/ansible-learning-template/refs/heads/main/README.md dest=/home/developer"
```

–î–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ (–∞ –Ω–µ –ø—Ä–æ—Å—Ç–æ —Å–∫–∞—á–∏–≤–∞–Ω–∏—è —Ñ–∞–π–ª–∞), –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ:

```bash
ansible all -m uri -a "url=https://example.com return_content=yes"
```

---

#### `yum` –∏ `apt`

–î–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–∞–∫–µ—Ç–∞–º–∏ –Ω–∞ —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–∞—Ö –û–°:

**RedHat/AlmaLinux/CentOS:**

```bash
ansible all -m yum -a "name=stress state=present" -b
ansible all -m yum -a "name=stress state=absent" -b
```

**Debian/Ubuntu:**

```bash
ansible all -m apt -a "name=stress state=present update_cache=yes" -b
ansible all -m apt -a "name=stress state=absent" -b
```

–§–ª–∞–≥ `update_cache=yes` —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –ø–µ—Ä–µ–¥ —É—Å—Ç–∞–Ω–æ–≤–∫–æ–π –≤ Debian-—Å–∏—Å—Ç–µ–º–∞—Ö.

---

#### `uri`

–ú–æ–¥—É–ª—å `uri` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è HTTP(S)-–∑–∞–ø—Ä–æ—Å–æ–≤:

```bash
ansible all -m uri -a "url=https://iit.kz"
```

–ß—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ:

```bash
ansible all -m uri -a "url=https://iit.kz return_content=yes"
```

---

#### `service`

–ú–æ–¥—É–ª—å –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–µ—Ä–≤–∏—Å–∞–º–∏ (—Å–ª—É–∂–±–∞–º–∏):

–ó–∞–ø—É—Å–∫ –∏ –≤–∫–ª—é—á–µ–Ω–∏–µ –≤ –∞–≤—Ç–æ–∑–∞–≥—Ä—É–∑–∫—É:

```bash
ansible all -m service -a "name=httpd state=started enabled=yes" -b
```

–û—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å–µ—Ä–≤–∏—Å–∞:

```bash
ansible all -m service -a "name=httpd state=stopped" -b
```

> –û–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ: –º–æ–¥—É–ª—å `service` –Ω–µ —É–¥–∞–ª—è–µ—Ç –ø–∞–∫–µ—Ç—ã, –¥–ª—è —ç—Ç–æ–≥–æ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `apt` –∏–ª–∏ `yum`.

---

–≠—Ç–æ –æ—Å–Ω–æ–≤–Ω—ã–µ ad-hoc –∫–æ–º–∞–Ω–¥—ã –∏ –º–æ–¥—É–ª–∏, —Å –∫–æ—Ç–æ—Ä—ã—Ö –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Ä–∞–±–æ—Ç–∞ –≤ Ansible. –û–Ω–∏ –ø–æ–∑–≤–æ–ª—è—é—Ç –±—ã—Å—Ç—Ä–æ –ø—Ä–æ–≤–µ—Ä—è—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Å–µ—Ä–≤–µ—Ä–æ–≤ –∏ –≤—ã–ø–æ–ª–Ω—è—Ç—å –±–∞–∑–æ–≤—ã–µ –¥–µ–π—Å—Ç–≤–∏—è –±–µ–∑ –Ω–∞–ø–∏—Å–∞–Ω–∏—è –ø–ª–µ–π–±—É–∫–æ–≤.

## –®–∞–≥ 3. Yaml, group_vars, host_vars

### –û—Å–Ω–æ–≤—ã YAML

YAML ‚Äî —ç—Ç–æ —Ç–µ–∫—Å—Ç–æ–≤—ã–π —Ñ–æ—Ä–º–∞—Ç –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö. –§–∞–π–ª—ã YAML –∏–º–µ—é—Ç —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ `.yaml` –∏–ª–∏ `.yml`.

**–û—Å–Ω–æ–≤–Ω—ã–µ –ø—Ä–∞–≤–∏–ª–∞ YAML:**

1. –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –æ—Ç—Å—Ç—É–ø—ã (–ø—Ä–æ–±–µ–ª—ã) –¥–ª—è –æ–±–æ–∑–Ω–∞—á–µ–Ω–∏—è –≤–ª–æ–∂–µ–Ω–Ω–æ—Å—Ç–∏. –ù–∞ –æ–¥–Ω–æ–º —É—Ä–æ–≤–Ω–µ –≤–ª–æ–∂–µ–Ω–Ω–æ—Å—Ç–∏ ‚Äî –æ–¥–∏–Ω–∞–∫–æ–≤–æ–µ —á–∏—Å–ª–æ –ø—Ä–æ–±–µ–ª–æ–≤.
2. –°–ø–∏—Å–∫–∏ –æ—Ñ–æ—Ä–º–ª—è—é—Ç—Å—è —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º —Å–∏–º–≤–æ–ª–∞ `-` –∏ –ø—Ä–æ–±–µ–ª–∞.
3. –ü–∞—Ä—ã "–∫–ª—é—á-–∑–Ω–∞—á–µ–Ω–∏–µ" –∑–∞–ø–∏—Å—ã–≤–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ –¥–≤–æ–µ—Ç–æ—á–∏–µ —Å –ø—Ä–æ–±–µ–ª–æ–º: `–∫–ª—é—á: –∑–Ω–∞—á–µ–Ω–∏–µ`.
4. –ò–º—è –º–æ–∂–Ω–æ —É–∫–∞–∑—ã–≤–∞—Ç—å –∫–∞–∫ –ø–æ–ª–µ (`name: Alexey`) –∏–ª–∏ –∫–∞–∫ –∫–ª—é—á (`Alexey:`).  
   –ï—Å–ª–∏ –∏–º—è —É–∫–∞–∑–∞–Ω–æ –∫–∞–∫ –∫–ª—é—á, –ø–æ—Å–ª–µ –Ω–µ–≥–æ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –¥–≤–æ–µ—Ç–æ—á–∏–µ.
5. –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –∫—Ä–∞—Ç–∫–∞—è –∑–∞–ø–∏—Å—å —á–µ—Ä–µ–∑ —Ñ–∏–≥—É—Ä–Ω—ã–µ —Å–∫–æ–±–∫–∏:  
   `{name: ..., age: ..., skills: [...]}` –∏–ª–∏ `–ò–º—è {age: ..., skills: [...]}`.
6. –î–ª—è –∫—Ä–∞—Ç–∫–æ–π –∑–∞–ø–∏—Å–∏ —Å–ø–∏—Å–∫–æ–≤ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –∫–≤–∞–¥—Ä–∞—Ç–Ω—ã–µ —Å–∫–æ–±–∫–∏: `skills: [Python, C#, YAML]`  
   –≠—Ç–æ —ç–∫–≤–∏–≤–∞–ª–µ–Ω—Ç –º–Ω–æ–≥–æ—Å—Ç—Ä–æ—á–Ω–æ–π –∑–∞–ø–∏—Å–∏ —Å–æ `-`.
7. –ï—Å–ª–∏ –≤ –∑–Ω–∞—á–µ–Ω–∏–∏ –≤—Å—Ç—Ä–µ—á–∞–µ—Ç—Å—è –¥–≤–æ–µ—Ç–æ—á–∏–µ (`:`), —Å—Ç—Ä–æ–∫—É —Å–ª–µ–¥—É–µ—Ç –∑–∞–∫–ª—é—á–∞—Ç—å –≤ –∫–∞–≤—ã—á–∫–∏:  
   `nickname: "Anton: god"` ‚Äî –∏–Ω–∞—á–µ –±—É–¥–µ—Ç —Å–∏–Ω—Ç–∞–∫—Å–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞.

**–ü—Ä–∏–º–µ—Ä:** –≤—Å–µ —á–µ—Ç—ã—Ä–µ –∑–∞–ø–∏—Å–∏ –Ω–∏–∂–µ —ç–∫–≤–∏–≤–∞–ª–µ–Ω—Ç–Ω—ã –∏ –≤–∞–ª–∏–¥–Ω—ã:

```yaml
---
- name: Alexey
  nickname: Alex
  age: 35
  skills:
    - Python
    - C#
    - YAML

- Anton:
    nickname: "Anton: thebest"
    age: 30
    skills:
      - –ü—Ä–æ–¥–∞–∂–∏
      - –ú–∞—Ä–∫–µ—Ç–∏–Ω–≥

- {name: Sasha, age: 60, skills: ['FoxPro', '–†–∞–±–æ—Ç–∞ –ø–æ –¥–µ—Ä–µ–≤—É']}

- Nina { age: 56, skills: ['–ì–æ—Ç–æ–≤–∫–∞', '–°–∞–¥–æ–≤–æ–¥—Å—Ç–≤–æ: –ö–∞–±–∞—á–∫–∏'] }
...
```

**–û–¥–∏–Ω–∞—Ä–Ω—ã–µ –∫–∞–≤—ã—á–∫–∏ `'...'`:**

- –í—Å—ë —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –≤–æ—Å–ø—Ä–∏–Ω–∏–º–∞–µ—Ç—Å—è –±—É–∫–≤–∞–ª—å–Ω–æ, –±–µ–∑ –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏–∏.
- –ß—Ç–æ–±—ã –≤—Å—Ç–∞–≤–∏—Ç—å –æ–¥–∏–Ω–∞—Ä–Ω—É—é –∫–∞–≤—ã—á–∫—É –≤–Ω—É—Ç—Ä—å —Å—Ç—Ä–æ–∫–∏, –µ—ë –Ω—É–∂–Ω–æ —É–¥–≤–æ–∏—Ç—å:  
  `'–≠—Ç–æ ''–ø—Ä–∏–º–µ—Ä'' —Ç–µ–∫—Å—Ç–∞'` -> `–≠—Ç–æ '–ø—Ä–∏–º–µ—Ä' —Ç–µ–∫—Å—Ç–∞`.
- –ü–µ—Ä–µ–Ω–æ—Å—ã —Å—Ç—Ä–æ–∫ –≤–Ω—É—Ç—Ä–∏ —Ç–∞–∫–∏—Ö –∫–∞–≤—ã—á–µ–∫ –∑–∞–ø—Ä–µ—â–µ–Ω—ã.

**–î–≤–æ–π–Ω—ã–µ –∫–∞–≤—ã—á–∫–∏ `"..."`:**

- –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç escape-–ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏:
  - `\n` ‚Äî –ø–µ—Ä–µ–Ω–æ—Å —Å—Ç—Ä–æ–∫–∏
  - `\t` ‚Äî —Ç–∞–±—É–ª—è—Ü–∏—è
  - `\"` ‚Äî –¥–≤–æ–π–Ω–∞—è –∫–∞–≤—ã—á–∫–∞ –≤–Ω—É—Ç—Ä–∏ —Å—Ç—Ä–æ–∫–∏
- –ú–æ–∂–Ω–æ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å –º–Ω–æ–≥–æ—Å—Ç—Ä–æ—á–Ω—ã–µ —Å—Ç—Ä–æ–∫–∏ –ø—Ä–∏ –ø–æ–º–æ—â–∏ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã—Ö –ø—Ä–∏—ë–º–æ–≤.

**–ò—Ç–æ–≥:**

- –û–¥–∏–Ω–∞—Ä–Ω—ã–µ –∫–∞–≤—ã—á–∫–∏ ‚Äî –¥–ª—è –ø—Ä–æ—Å—Ç—ã—Ö —Å—Ç—Ä–æ–∫ –±–µ–∑ —Å–ø–µ—Ü—Å–∏–º–≤–æ–ª–æ–≤.
- –î–≤–æ–π–Ω—ã–µ ‚Äî –µ—Å–ª–∏ –Ω—É–∂–Ω—ã —Å–ø–µ—Ü—Å–∏–º–≤–æ–ª—ã –∏–ª–∏ –ø–µ—Ä–µ–Ω–æ—Å—ã —Å—Ç—Ä–æ–∫.
- –û–±–µ —Ä–∞–∑–Ω–æ–≤–∏–¥–Ω–æ—Å—Ç–∏ –∫–∞–≤—ã—á–µ–∫ –∑–∞—â–∏—â–∞—é—Ç —Å—Ç—Ä–æ–∫—É –æ—Ç –æ—à–∏–±–æ—á–Ω–æ–≥–æ —Å–∏–Ω—Ç–∞–∫—Å–∏—á–µ—Å–∫–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –∏–∑-–∑–∞ –¥–≤–æ–µ—Ç–æ—á–∏–π).

---

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –≤ `group_vars`

–í –∫—Ä—É–ø–Ω—ã—Ö –ø—Ä–æ–µ–∫—Ç–∞—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ, –æ–±—â–∏–µ –¥–ª—è –≥—Ä—É–ø–ø—ã —Ö–æ—Å—Ç–æ–≤, –ø—Ä–∏–Ω—è—Ç–æ —Ö—Ä–∞–Ω–∏—Ç—å –≤ –∫–∞—Ç–∞–ª–æ–≥–µ `group_vars`. –í —ç—Ç–æ–º –∫–∞—Ç–∞–ª–æ–≥–µ —Å–æ–∑–¥–∞—é—Ç—Å—è YAML-—Ñ–∞–π–ª—ã —Å –∏–º–µ–Ω–∞–º–∏ –≥—Ä—É–ø–ø, —É–∫–∞–∑–∞–Ω–Ω—ã—Ö –≤ –∏–Ω–≤–µ–Ω—Ç–æ—Ä–∏-—Ñ–∞–π–ª–µ.

**–ò–∑–Ω–∞—á–∞–ª—å–Ω—ã–π —Ñ–∞–π–ª –∏–Ω–≤–µ–Ω—Ç–∞—Ä–∏–∑–∞—Ü–∏–∏:**

```ini
[master_servers]
minion1

[worker_servers]
minion2

[cluster_servers:children]
master_servers
worker_servers

[cluster_servers:vars]
ansible_username=developer 
ansible_ssh_private_key_file=/home/developer/.ssh/id_rsa
ansible_python_interpreter=/usr/bin/python3
```

**–®–∞–≥–∏:**

1. –°–æ–∑–¥–∞–π –∫–∞—Ç–∞–ª–æ–≥ `group_vars` –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞.
2. –í–Ω—É—Ç—Ä–∏ ‚Äî —Ñ–∞–π–ª `cluster_servers.yml`:

    ```yaml
    ---
    ansible_username: developer 
    ansible_ssh_private_key_file: /home/developer/.ssh/id_rsa
    ansible_python_interpreter: /usr/bin/python3
    ```

3. –£–¥–∞–ª–∏ –±–ª–æ–∫ `[cluster_servers:vars]` –∏–∑ –∏–Ω–≤–µ–Ω—Ç–∞—Ä–∏–∑–∞—Ü–∏–∏ ‚Äî Ansible —Å–∞–º –ø–æ–¥–≥—Ä—É–∑–∏—Ç –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∏–∑ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–≥–æ YAML-—Ñ–∞–π–ª–∞:

    ```ini
    [master_servers]
    minion1

    [worker_servers]
    minion2

    [cluster_servers:children]
    master_servers
    worker_servers
    ```

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –≤ `host_vars`

–ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ `group_vars`, –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö —Ö–æ—Å—Ç–æ–≤ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–∞—Ç–∞–ª–æ–≥ `host_vars`.

Ansible –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–¥–≥—Ä—É–∂–∞–µ—Ç –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∏–∑ —ç—Ç–æ–≥–æ –∫–∞—Ç–∞–ª–æ–≥–∞ –ø—Ä–∏ —Ä–∞–±–æ—Ç–µ —Å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–º–∏ —Ö–æ—Å—Ç–∞–º–∏.

**–®–∞–≥–∏:**

1. –°–æ–∑–¥–∞–π –∫–∞—Ç–∞–ª–æ–≥ `host_vars` –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞.
2. –°–æ–∑–¥–∞–π –≤ –Ω–µ–º —Ñ–∞–π–ª —Å –∏–º–µ–Ω–µ–º —Ö–æ—Å—Ç–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `minion1.yml`).
3. –í —ç—Ç–æ–º —Ñ–∞–π–ª–µ —É–∫–∞–∂–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ, —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –¥–ª—è –¥–∞–Ω–Ω–æ–≥–æ —Ö–æ—Å—Ç–∞ –≤ YAML-—Ñ–æ—Ä–º–∞—Ç–µ:

```yaml
---
some_unique_var: true
custom_port: 2222
```

–¢–∞–∫–æ–π –ø–æ–¥—Ö–æ–¥ –ø–æ–º–æ–≥–∞–µ—Ç –¥–µ—Ä–∂–∞—Ç—å —Ñ–∞–π–ª –∏–Ω–≤–µ–Ω—Ç–∞—Ä–∏–∑–∞—Ü–∏–∏ —á–∏—Å—Ç—ã–º –∏ —É–ø—Ä–æ—â–∞–µ—Ç —Å–æ–ø—Ä–æ–≤–æ–∂–¥–µ–Ω–∏–µ –ø—Ä–∏ —Ä–æ—Å—Ç–µ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã.

## –®–∞–≥ 4. –ü–ª–µ–π–±—É–∫–∏ (Playbooks)

Playbook ‚Äî —ç—Ç–æ YAML-—Ñ–∞–π–ª —Å –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π, –≤ –∫–æ—Ç–æ—Ä–æ–º —É–∫–∞–∑–∞–Ω–æ –Ω–µ—Å–∫–æ–ª—å–∫–æ –∫–æ–º–∞–Ω–¥ Ansible, –≤—ã–ø–æ–ª–Ω—è—é—â–∏—Ö –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—É—é —Ü–µ–ª—å. –ö–∞–∫ –ø—Ä–∞–≤–∏–ª–æ, —Ñ–∞–π–ª—ã —Å –ø–ª–µ–π–±—É–∫–∞–º–∏ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ –∫–∞—Ç–∞–ª–æ–≥–µ `playbooks`, –∫–æ—Ç–æ—Ä—ã–π –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞.

### –ü–µ—Ä–≤—ã–π Playbook

–ù–∞–ø–∏—à–µ–º –ø–µ—Ä–≤—ã–π –ø–ª–µ–π–±—É–∫, –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å —Ö–æ—Å—Ç–∞–º–∏, –≤—ã–ø–æ–ª–Ω–∏–≤ –∫–æ–º–∞–Ω–¥—É `ping`. –î–ª—è —ç—Ç–æ–≥–æ —Å–æ–∑–¥–∞–¥–∏–º –≤ –∫–∞—Ç–∞–ª–æ–≥–µ `playbooks` —Ñ–∞–π–ª `ping.yml` —Å–æ —Å–ª–µ–¥—É—é—â–∏–º —Å–æ–¥–µ—Ä–∂–∏–º—ã–º:

```yaml
---
- name: Test connection to my servers  # –ò–º—è –ø–ª–µ–π–±—É–∫–∞
  hosts: all                           # –ö –∫–∞–∫–∏–º —Ö–æ—Å—Ç–∞–º –ø—Ä–∏–º–µ–Ω—è—Ç—å
  become: yes                          # –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å sudo

  tasks:                               # –ú–∞—Å—Å–∏–≤ –∑–∞–¥–∞—á –ø–ª–µ–π–±—É–∫–∞
    - name: Ping my servers            # –ò–º—è –∑–∞–¥–∞—á–∏
      ping:                            # –ú–æ–¥—É–ª—å, –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–π –≤ –∑–∞–¥–∞—á–µ
```

–ó–∞–ø—É—Å—Ç–∏–º –ø–ª–µ–π–±—É–∫:

```bash
ansible-playbook playbooks/ping.yml
```

–ü—Ä–∏–º–µ—Ä –≤—ã–≤–æ–¥–∞:

```bash
PLAY [Test connection to my servers]

TASK [Gathering Facts]
ok: [minion1]
ok: [minion2]

TASK [Ping my servers]
ok: [minion2]
ok: [minion1]

PLAY RECAP
minion1 : ok=2  changed=0  unreachable=0  failed=0  skipped=0  rescued=0  ignored=0
minion2 : ok=2  changed=0  unreachable=0  failed=0  skipped=0  rescued=0  ignored=0
```

### –í—Ç–æ—Ä–æ–π –ø–ª–µ–π–±—É–∫ - —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤–µ–±-—Å–µ—Ä–≤–µ—Ä–∞ nginx

–¢–µ–ø–µ—Ä—å —Å–æ–∑–¥–∞–¥–∏–º –ø–ª–µ–π–±—É–∫ –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –≤–µ–±-—Å–µ—Ä–≤–µ—Ä–∞ nginx –Ω–∞ —Å–∏—Å—Ç–µ–º—ã, —Å–æ–≤–º–µ—Å—Ç–∏–º—ã–µ —Å Debian. –í –∫–∞—Ç–∞–ª–æ–≥–µ `playbooks` —Å–æ–∑–¥–∞–¥–∏–º —Ñ–∞–π–ª `install_nginx.yml` —Å–æ —Å–ª–µ–¥—É—é—â–∏–º —Å–æ–¥–µ—Ä–∂–∏–º—ã–º:

```yaml
---
- name: Install Nginx on Debian-like systems
  hosts: all
  become: true

  tasks:
    - name: Update apt cache
      apt:
        update_cache: yes  # –û–±–Ω–æ–≤–∏—Ç—å –∫—ç—à –ø–∞–∫–µ—Ç–æ–≤, —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å –∞–∫—Ç—É–∞–ª—å–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é

    - name: Install nginx
      apt:
        name: nginx        # –ò–º—è –ø–∞–∫–µ—Ç–∞
        state: present     # –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –ø–∞–∫–µ—Ç —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω

    - name: Ensure nginx is running and enabled
      service:
        name: nginx        # –ò–º—è —Å–µ—Ä–≤–∏—Å–∞
        state: started     # –°–µ—Ä–≤–∏—Å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∑–∞–ø—É—â–µ–Ω
        enabled: yes       # –í–∫–ª—é—á–∏—Ç—å –∞–≤—Ç–æ–∑–∞–ø—É—Å–∫ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
```

–ó–∞–ø—É—Å–∫–∞–µ–º –ø–ª–µ–π–±—É–∫:

```bash
ansible-playbook playbooks/install_nginx.yml
```

–ü—Ä–∏–º–µ—Ä –≤—ã–≤–æ–¥–∞:

```bash
PLAY [Install Nginx on Debian-like systems]

TASK [Gathering Facts]
ok: [minion2]
ok: [minion1]

TASK [Update apt cache]
changed: [minion2]
changed: [minion1]

TASK [Install nginx]
changed: [minion2]
changed: [minion1]

TASK [Ensure nginx is running and enabled]
changed: [minion1]
changed: [minion2]
```

–ü—Ä–æ–≤–µ—Ä–∏–º —É—Å—Ç–∞–Ω–æ–≤–∫—É, –∑–∞–ø—Ä–æ—Å–∏–≤ –≤–µ–±-—Å—Ç—Ä–∞–Ω–∏—Ü—É —Å —Å–µ—Ä–≤–µ—Ä–∞. –î–ª—è —ç—Ç–æ–≥–æ –≤—ã–ø–æ–ª–Ω–∏–º –∫–æ–º–∞–Ω–¥—É:

```bash
curl minion1
```

–ï—Å–ª–∏ –≤—Å—ë —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ, –≤—ã —É–≤–∏–¥–∏—Ç–µ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—É—é HTML-—Å—Ç—Ä–∞–Ω–∏—Ü—É –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –¥–ª—è –≤–µ–±-—Å–µ—Ä–≤–µ—Ä–∞ nginx:

```html
<!DOCTYPE html>
<html>
<head>
<title>Welcome to nginx!</title>
<style>
html { color-scheme: light dark; }
body { width: 35em; margin: 0 auto;
font-family: Tahoma, Verdana, Arial, sans-serif; }
</style>
</head>
<body>
<h1>Welcome to nginx!</h1>
<p>If you see this page, the nginx web server is successfully installed and
working. Further configuration is required.</p>

<p>For online documentation and support please refer to
<a href="http://nginx.org/">nginx.org</a>.<br/>
Commercial support is available at
<a href="http://nginx.com/">nginx.com</a>.</p>

<p><em>Thank you for using nginx.</em></p>
</body>
</html>
```

### –ò–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å –≤ Ansible

–ò–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å –≤ Ansible –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ –ø–æ–≤—Ç–æ—Ä–Ω—ã–π –∑–∞–ø—É—Å–∫ –ø–ª–µ–π–±—É–∫–∞ –Ω–µ –∏–∑–º–µ–Ω–∏—Ç —Å–∏—Å—Ç–µ–º—É, –µ—Å–ª–∏ –æ–Ω–∞ —É–∂–µ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ –Ω—É–∂–Ω–æ–º —Å–æ—Å—Ç–æ—è–Ω–∏–∏.

–ö–ª—é—á–µ–≤—ã–µ –º–æ–º–µ–Ω—Ç—ã:

- –û–¥–∏–Ω –∏ —Ç–æ—Ç –∂–µ –ø–ª–µ–π–±—É–∫ –º–æ–∂–Ω–æ –∑–∞–ø—É—Å–∫–∞—Ç—å –º–Ω–æ–≥–æ–∫—Ä–∞—Ç–Ω–æ ‚Äî —Ä–µ–∑—É–ª—å—Ç–∞—Ç –æ—Å—Ç–∞–Ω–µ—Ç—Å—è –æ–¥–∏–Ω–∞–∫–æ–≤—ã–º.
- Ansible –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç, –Ω—É–∂–Ω–æ –ª–∏ –ø—Ä–∏–º–µ–Ω—è—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, –Ω–µ –ø–µ—Ä–µ—É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç nginx, –µ—Å–ª–∏ –æ–Ω —É–∂–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω).
- –≠—Ç–æ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –Ω–∞–¥—ë–∂–Ω–æ—Å—Ç—å –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏.

–ù–∞–ø—Ä–∏–º–µ—Ä, –ø—Ä–∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ–º –∑–∞–ø—É—Å–∫–µ –ø–ª–µ–π–±—É–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –≤–µ–±-—Å–µ—Ä–≤–µ—Ä–∞ nginx (`ansible-playbook playbooks/install_nginx.yml`) –º—ã —É–≤–∏–¥–∏–º —Å–ª–µ–¥—É—é—â–∏–π –≤—ã–≤–æ–¥:

```bash
PLAY [Install Nginx on all servers] 

TASK [Gathering Facts] 
ok: [minion2]
ok: [minion1]

TASK [Update apt cache] 
ok: [minion2]
ok: [minion1]

TASK [Install nginx] 
ok: [minion1]
ok: [minion2]

TASK [Ensure nginx is running and enabled] 
ok: [minion2]
ok: [minion1]

PLAY RECAP 
minion1                    : ok=4    changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   
minion2                    : ok=4    changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   
```

–ï—Å–ª–∏ —Å—Ä–∞–≤–Ω–∏—Ç—å —Å –ø–µ—Ä–≤—ã–º –∑–∞–ø—É—Å–∫–æ–º, —Ç–æ –≤ –ª–æ–≥–µ –ø–µ—Ä–≤–æ–≥–æ –∑–∞–ø—É—Å–∫–∞ –∑–∞–¥–∞—á–∏ –æ—Ç–º–µ—á–µ–Ω—ã –∫–∞–∫ –∏–∑–º–µ–Ω—ë–Ω–Ω—ã–µ (`changed`), –Ω–∞–ø—Ä–∏–º–µ—Ä:

```bash
TASK [Update apt cache] 
changed: [minion2]
changed: [minion1]

TASK [Install nginx] 
changed: [minion2]
changed: [minion1]

TASK [Ensure nginx is running and enabled] 
changed: [minion1]
changed: [minion2]
```

–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏:

- –≠–∫–æ–Ω–æ–º–∏—Ç –≤—Ä–µ–º—è ‚Äî Ansible –ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç —É–∂–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏, —É—Å–∫–æ—Ä—è—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –ø–ª–µ–π–±—É–∫–æ–≤.
- –ë–µ–∑–æ–ø–∞—Å–Ω–æ –¥–ª—è –ø—Ä–æ–¥—É–∫—Ç–æ–≤–æ–π —Å—Ä–µ–¥—ã ‚Äî –Ω–µ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ—Ç —Å–µ—Ä–≤–∏—Å—ã –∏–ª–∏ –Ω–µ –≤–Ω–æ—Å–∏—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è –±–µ–∑ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏.
- –û—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ—Å—Ç—å –Ω–∞ –∂–µ–ª–∞–µ–º–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ ‚Äî Ansible –æ–ø–∏—Å—ã–≤–∞–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã, –∞ –Ω–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —à–∞–≥–∏.
- –ü–æ–∑–≤–æ–ª—è–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–ª–µ–π–±—É–∫–∏ –≤ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö –∑–∞–¥–∞–Ω–∏—è—Ö (cron, CI/CD), –Ω–µ –æ–ø–∞—Å–∞—è—Å—å –Ω–µ–∂–µ–ª–∞—Ç–µ–ª—å–Ω—ã—Ö —ç—Ñ—Ñ–µ–∫—Ç–æ–≤.

### –¢—Ä–µ—Ç–∏–π –ø–ª–µ–π–±—É–∫ ‚Äî —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤–µ–±-—Å–µ—Ä–≤–µ—Ä–∞ nginx —Å –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ–º –∫–æ–Ω—Ç–µ–Ω—Ç–∞ —Å–∞–π—Ç–∞

–≠—Ç–æ—Ç –ø–ª–µ–π–±—É–∫ –Ω–µ —Ç–æ–ª—å–∫–æ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç nginx, –Ω–æ –∏ –∑–∞–º–µ–Ω–∏—Ç –¥–µ—Ñ–æ–ª—Ç–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É —Å–∞–π—Ç–∞ –Ω–∞ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—É—é.

1. –í –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞ —Å–æ–∑–¥–∞–¥–∏–º –∫–∞—Ç–∞–ª–æ–≥ `website_content` –∏ —Ñ–∞–π–ª `index.html` —Å–æ —Å–ª–µ–¥—É—é—â–∏–º —Å–æ–¥–µ—Ä–∂–∏–º—ã–º:

    ```html
    <!DOCTYPE html>
    <html lang="ru">
    <head>
    <meta charset="UTF-8">
    <title>Hello World</title>
    </head>
    <body>
    <h1>Hello World</h1>
    </body>
    </html>
    ```

2. –í –∫–∞—Ç–∞–ª–æ–≥–µ `playbooks` —Å–æ–∑–¥–∞–¥–∏–º —Ñ–∞–π–ª `install_nginx_content.yml` —Å–æ —Å–ª–µ–¥—É—é—â–∏–º —Å–æ–¥–µ—Ä–∂–∏–º—ã–º:

    ```yaml
    ---
    - name: Install Nginx with content
    hosts: all
    become: true
    
    vars:
        source_file: "../website_content/index.html"   # –ü—É—Ç—å –∫ –∏—Å—Ö–æ–¥–Ω–æ–º—É —Ñ–∞–π–ª—É index.html –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –∑–∞–ø—É—Å–∫–∞
        dest_file: "/var/www/html/index.html"          # –ü—É—Ç—å –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è –¥–ª—è —Ñ–∞–π–ª–∞ index.html –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

    tasks:
        - name: Update apt cache
        apt:
            update_cache: yes

        - name: Install nginx
        apt:
            name: nginx
            state: present

        - name: Copy custom index.html to Nginx web root
        copy:
            src: "{{ source_file }}"
            dest: "{{ dest_file }}"
            mode: '0644'
        notify: Restart Nginx

        - name: Ensure nginx is running and enabled
        service:
            name: nginx
            state: started
            enabled: yes

    handlers:
        - name: Restart Nginx
        service:
            name: nginx
            state: restarted
    ```

    –í —ç—Ç–æ–º –ø–ª–µ–π–±—É–∫–µ:

    - –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ `source_file` –∏ `dest_file` –¥–ª—è —É–∫–∞–∑–∞–Ω–∏—è –ø—É—Ç–µ–π –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è.
    - –ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Ñ–∞–π–ª–∞ `index.html` –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ `Restart Nginx`, –∫–æ—Ç–æ—Ä—ã–π –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ—Ç –≤–µ–±-—Å–µ—Ä–≤–µ—Ä.
    - –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ (`handlers`) –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –≤—ã–∑–æ–≤–µ —á–µ—Ä–µ–∑ `notify`, —á—Ç–æ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –ª–∏—à–Ω–∏–µ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∏.

3. –ó–∞–ø—É—Å—Ç–∏–º –ø–ª–µ–π–±—É–∫ –∫–æ–º–∞–Ω–¥–æ–π:

    ```bash
    ansible-playbook playbooks/install_nginx_content.yml
    ```

    –ü—Ä–∏–º–µ—Ä –≤—ã–≤–æ–¥–∞:

    ```bash
    PLAY [Install Nginx with content] 

    TASK [Gathering Facts] 
    ok: [minion2]
    ok: [minion1]

    TASK [Update apt cache] 
    ok: [minion1]
    ok: [minion2]

    TASK [Install nginx] 
    ok: [minion1]
    ok: [minion2]

    TASK [Copy custom index.html to Nginx web root] 
    changed: [minion2]
    changed: [minion1]

    TASK [Ensure nginx is running and enabled] 
    ok: [minion2]
    ok: [minion1]

    PLAY RECAP 
    minion1: ok=5    changed=1    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   
    minion2: ok=5    changed=1    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   
    ```

4. –ü—Ä–æ–≤–µ—Ä–∏–º —Å—Ç—Ä–∞–Ω–∏—Ü—É –≤–µ–±-—Å–µ—Ä–≤–µ—Ä–∞:

    ```bash
    curl minion1
    ```

    –û–∂–∏–¥–∞–µ–º—ã–π –æ—Ç–≤–µ—Ç:

    ```html
    <!DOCTYPE html>
    <html lang="ru">
    <head>
    <meta charset="UTF-8">
    <title>Hello World</title>
    </head>
    <body>
    <h1>Hello World</h1>
    </body>
    </html>
    ```

## –®–∞–≥ 5. –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ, Debug, Set_fact, Register

–ü—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö, –∏—Ö –∏–º–µ–Ω–∞ –æ–±—Ä–∞–º–ª—è—é—Ç—Å—è –¥–≤–æ–π–Ω—ã–º–∏ —Ñ–∏–≥—É—Ä–Ω—ã–º–∏ —Å–∫–æ–±–∫–∞–º–∏ `{{ var_name }}`, —á—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç Ansible –ø–æ–Ω—è—Ç—å, —á—Ç–æ —Å—é–¥–∞ –Ω–∞–¥–æ –ø–æ–¥—Å—Ç–∞–≤–∏—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π, —Ä–∞–Ω–µ–µ –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ–π —Å —Ç–∞–∫–∏–º –∏–º–µ–Ω–µ–º.

### –ü–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö

–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –º–æ–∂–Ω–æ –æ–ø—Ä–µ–¥–µ–ª—è—Ç—å –≤ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —á–∞—Å—Ç—è—Ö –ø—Ä–æ–µ–∫—Ç–∞, –≤–∫–ª—é—á–∞—è –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ –æ–¥–Ω–æ–π –∏ —Ç–æ–π –∂–µ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π. –ù–∏–∂–µ –ø–æ–∫–∞–∑–∞–Ω –ø–æ—Ä—è–¥–æ–∫, –≤ –∫–æ—Ç–æ—Ä–æ–º –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö, –µ—Å–ª–∏ –æ–¥–Ω–∞ –∏ —Ç–∞ –∂–µ –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è –∑–∞–¥–∞–Ω–∞ –≤ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –º–µ—Å—Ç–∞—Ö.

```yaml
# roles/myrole/defaults/main.yml
# --------------------------------
# –ó–Ω–∞—á–µ–Ω–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –¥–ª—è —Ä–æ–ª–∏.
# –ù–∞–∏–º–µ–Ω—å—à–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç ‚Äî –ª–µ–≥–∫–æ –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è—é—Ç—Å—è –≤ –ª—é–±–æ–º –¥—Ä—É–≥–æ–º –º–µ—Å—Ç–µ.
myvar: "from_role_defaults"

# roles/myrole/vars/main.yml
# ---------------------------
# –ñ—ë—Å—Ç–∫–æ –∑–∞—à–∏—Ç—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –≤–Ω—É—Ç—Ä–∏ —Ä–æ–ª–∏.
# –ü–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è—é—Ç—Å—è —Ç–æ–ª—å–∫–æ set_fact –∏ extra_vars.
myvar: "from_role_vars"

# vars_files/vars.yml
# --------------------
# –§–∞–π–ª —Å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏, –ø–æ–¥–∫–ª—é—á—ë–Ω–Ω—ã–π —á–µ—Ä–µ–∑ `vars_files` –≤ playbook.
# –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç –≤—ã—à–µ, —á–µ–º —É group_vars –∏ host_vars.
myvar: "from_vars_file"

# gathered facts (gather_facts)
# ------------------------------
# –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–±–∏—Ä–∞–µ–º—ã–µ –¥–∞–Ω–Ω—ã–µ –æ —Ö–æ—Å—Ç–µ.
# –ü—Ä–∏–º–µ—Ä: ansible_distribution, ansible_hostname –∏ –¥—Ä.
myvar: "{{ ansible_distribution }}"  # –Ω–∞–ø—Ä–∏–º–µ—Ä: "Debian"

# inventory file (hosts –∏–ª–∏ inventory.ini)
# ------------------------------------
# –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ, –∑–∞–¥–∞–Ω–Ω—ã–µ –ø—Ä—è–º–æ –≤ –∏–Ω–≤–µ–Ω—Ç–∞—Ä–µ.
# –ß–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –¥–ª—è –∑–∞–¥–∞–Ω–∏—è IP, –ø—É—Ç–µ–π –∏ –∑–Ω–∞—á–µ–Ω–∏–π –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é.
myvar: "from_inventory"

# group_vars/all.yml
# -------------------
# –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ, –ø—Ä–∏–º–µ–Ω—è–µ–º—ã–µ –∫–æ –≤—Å–µ–º —Ö–æ—Å—Ç–∞–º –≥—Ä—É–ø–ø—ã.
# –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç –≤—ã—à–µ, —á–µ–º —É inventory.
myvar: "from_group_vars"

# host_vars/minion1.yml
# -----------------------
# –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ, —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –¥–ª—è –æ–¥–Ω–æ–≥–æ —Ö–æ—Å—Ç–∞.
# –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç –≤—ã—à–µ, —á–µ–º —É group_vars.
myvar: "from_host_vars"

# playbook.yml ‚Äî –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è –≤ —Å–µ–∫—Ü–∏–∏ vars
# ---------------------------------------
# –ó–∞–¥–∞–Ω–æ –ø—Ä—è–º–æ –≤–Ω—É—Ç—Ä–∏ playbook.
# –ü–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –≤—Å—ë –≤—ã—à–µ (–∫—Ä–æ–º–µ register, set_fact, extra_vars).
vars:
  myvar: "from_playbook_vars"

# –í–Ω—É—Ç—Ä–∏ –∑–∞–¥–∞—á–∏ —Å register
# ------------------------
# –°–æ—Ö—Ä–∞–Ω—è–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∫–æ–º–∞–Ω–¥—ã –∏–ª–∏ –º–æ–¥—É–ª—è.
# –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è –∏–º–µ–µ—Ç –±–æ–ª–µ–µ –≤—ã—Å–æ–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç, —á–µ–º playbook vars.
- name: Set via register
  command: echo "from_register"
  register: myvar

# –í–Ω—É—Ç—Ä–∏ –∑–∞–¥–∞—á–∏ —Å set_fact
# ------------------------
# –ó–∞–¥–∞—ë—Ç –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –≤–æ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è.
# –û—á–µ–Ω—å –≤—ã—Å–æ–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç (–ø—Ä–æ–∏–≥—Ä—ã–≤–∞–µ—Ç —Ç–æ–ª—å–∫–æ extra_vars).
- name: Set via set_fact
  set_fact:
    myvar: "from_set_fact"

# CLI (–∞—Ä–≥—É–º–µ–Ω—Ç—ã –∫–æ–º–∞–Ω–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–∏)
# --------------------------------
# –°–∞–º—ã–π –≤—ã—Å–æ–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç.
# –ü–æ–±–µ–∂–¥–∞–µ—Ç –≤—Å—ë, –≤–∫–ª—é—á–∞—è set_fact –∏ register.
ansible-playbook playbook.yml -e "myvar=from_extra_vars"
```

–ù–µ –≤—Å–µ –µ—â–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã Ansible –º—ã –ø–æ–∫–∞ –∏–∑—É—á–∏–ª–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Ä–æ–ª–∏ –∏ register), –Ω–æ —ç—Ç—É —à–ø–∞—Ä–≥–∞–ª–∫—É –ø–æ–ª–µ–∑–Ω–æ –¥–µ—Ä–∂–∞—Ç—å –ø–æ–¥ —Ä—É–∫–æ–π, —á—Ç–æ–±—ã –ø–æ–Ω–∏–º–∞—Ç—å, –≤ –∫–∞–∫–æ–º –ø–æ—Ä—è–¥–∫–µ –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è—é—Ç—Å—è –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ. –≠—Ç–æ –≤–∞–∂–Ω–æ –¥–ª—è –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è –ª–æ–≥–∏–∫–∏ —Ä–∞–±–æ—Ç—ã –ø–ª–µ–π–±—É–∫–æ–≤.

–í –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Ü–µ–ª—è—Ö –¥–æ–±–∞–≤–∏–º –Ω–µ—Å–∫–æ–ª—å–∫–æ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –≤ —Ä–∞–∑–Ω—ã—Ö –º–µ—Å—Ç–∞—Ö.

–í –∏–Ω–≤–µ–Ω—Ç–∞—Ä–Ω–æ–º —Ñ–∞–π–ª–µ `hosts` –¥–æ–±–∞–≤–∏–º —Ö–æ—Å—Ç–∞–º –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é `owner`:

```ini
[master_servers]
minion1 owner="Alex from inventory"

[worker_servers]
minion2 owner="Maxim from inventory"
```

–ü–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–∏–º —ç—Ç—É –∂–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é, –Ω–æ —É–∂–µ –≤ –∫–∞—Ç–∞–ª–æ–≥–µ `host_vars` ‚Äî –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ö–æ—Å—Ç–∞ —Å–≤–æ–π —Ñ–∞–π–ª:

`host_vars/minion1.yml`:

```yaml
owner: "Alex from host_vars"
```

`host_vars/minion2.yml`:

```yaml
owner: "Maxim from host_vars"
```

### –ü—Ä–∏–º–µ—Ä —Ä–∞–±–æ—Ç—ã —Å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏

–î–ª—è –ª—É—á—à–µ–≥–æ –ø–æ–Ω–∏–º–∞–Ω–∏—è —Å–æ–∑–¥–∞–¥–∏–º –Ω–æ–≤—ã–π –ø–ª–µ–π–±—É–∫ `variables.yml` (–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `set_fact` –∏ `register`, –º—ã –ø–æ–¥—Ä–æ–±–Ω–æ —Ä–∞—Å—Å–º–æ—Ç—Ä–∏–º –¥–∞–ª—å—à–µ):

```yaml
---
- name: Playbook demonstrating variables usage
  hosts: all
  become: true

  vars:
    message1: "Hello" # –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ, –∑–∞–¥–∞–Ω–Ω—ã–µ –≤ –ø–ª–µ–π–±—É–∫–µ
    message2: "World"
    my_var1: "The my variable"

  tasks:
    - name: Print value of my_var1 using var
      debug:
        var: my_var1

    - name: Print value of my_var1 using msg
      debug:
        msg: "The value of my_var1 is: {{ my_var1 }}"

    - name: Show owner variable
      debug:
        msg: "Owner of this server: {{ owner }}" # –ó–Ω–∞—á–µ–Ω–∏–µ –∏–∑ inventory –∏ host_vars

    - name: Set new variable using set_fact
      set_fact:
        my_new_variable: "{{ message1 }} {{ message2 }} from {{ owner }}"
      # –°–æ–∑–¥–∞—ë—Ç –Ω–æ–≤—É—é –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é, –¥–æ—Å—Ç—É–ø–Ω—É—é –≤ –ø–æ—Å–ª–µ–¥—É—é—â–∏—Ö —Ç–∞—Å–∫–∞—Ö

    - name: Show my_new_variable
      debug:
        var: my_new_variable

    - name: Show free memory (fact)
      debug:
        var: ansible_memfree_mb  # –ò—Å–ø–æ–ª—å–∑—É–µ–º —Å–æ–±—Ä–∞–Ω–Ω—ã–π —Ñ–∞–∫—Ç

    - name: Get uptime via shell and register result
      shell: uptime
      register: uptime_result

    - name: Show uptime_result
      debug:
        var: uptime_result

    - name: Show uptime_result.stdout
      debug:
        msg: "Uptime of the server is: {{ uptime_result.stdout }}"
```

–ó–∞–ø—É—Å—Ç–∏–º –ø–ª–µ–π–±—É–∫:

```bash
ansible-playbook playbooks/variables.yml
```

–û–∂–∏–¥–∞–µ–º—ã–π –≤—ã–≤–æ–¥:

```bash
PLAY [Playbook demonstrating variables usage]

TASK [Gathering Facts]
ok: [minion2]
ok: [minion1]

TASK [Print value of my_var1 using var]
ok: [minion1] => {
    "my_var1": "The my variable"
}
ok: [minion2] => {
    "my_var1": "The my variable"
}

TASK [Print value of my_var1 using msg]
ok: [minion1] => {
    "msg": "The value of my_var1 is: The my variable"
}
ok: [minion2] => {
    "msg": "The value of my_var1 is: The my variable"
}

TASK [Show owner variable]
ok: [minion1] => {
    "msg": "Owner of this server: Alex from host_vars"
}
ok: [minion2] => {
    "msg": "Owner of this server: Maxim from host_vars"
}

TASK [Set new variable using set_fact]
ok: [minion1]
ok: [minion2]

TASK [Show my_new_variable]
ok: [minion1] => {
    "my_new_variable": "Hello World from Alex from host_vars"
}
ok: [minion2] => {
    "my_new_variable": "Hello World from Maxim from host_vars"
}

TASK [Show free memory (fact)]
ok: [minion1] => {
    "ansible_memfree_mb": 5310
}
ok: [minion2] => {
    "ansible_memfree_mb": 5310
}

TASK [Get uptime via shell and register result]
changed: [minion2]
changed: [minion1]

TASK [Show uptime_result]
ok: [minion1] => {
    "uptime_result": {
        "changed": true,
        "cmd": "uptime",
        "delta": "0:00:00.005227",
        "end": "2025-07-01 22:13:31.333633",
        "failed": false,
        "msg": "",
        "rc": 0,
        "start": "2025-07-01 22:13:31.328406",
        "stderr": "",
        "stderr_lines": [],
        "stdout": " 22:13:31 up  8:39,  0 users,  load average: 0.11, 0.12, 0.10",
        "stdout_lines": [
            " 22:13:31 up  8:39,  0 users,  load average: 0.11, 0.12, 0.10"
        ]
    }
}
ok: [minion2] => {
    "uptime_result": {
        "changed": true,
        "cmd": "uptime",
        "delta": "0:00:00.003344",
        "end": "2025-07-01 22:13:31.333838",
        "failed": false,
        "msg": "",
        "rc": 0,
        "start": "2025-07-01 22:13:31.330494",
        "stderr": "",
        "stderr_lines": [],
        "stdout": " 22:13:31 up  8:39,  0 users,  load average: 0.11, 0.12, 0.10",
        "stdout_lines": [
            " 22:13:31 up  8:39,  0 users,  load average: 0.11, 0.12, 0.10"
        ]
    }
}

TASK [Show uptime_result.stdout]
ok: [minion1] => {
    "msg": "Uptime of the server is:  22:13:31 up  8:39,  0 users,  load average: 0.11, 0.12, 0.10"
}
ok: [minion2] => {
    "msg": "Uptime of the server is:  22:13:31 up  8:39,  0 users,  load average: 0.11, 0.12, 0.10"
}
```

–û–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ, —á—Ç–æ –Ω–µ—Å–º–æ—Ç—Ä—è –Ω–∞ —Ç–æ, —á—Ç–æ –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è `owner` –±—ã–ª–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∞ –≤ –∏–Ω–≤–µ–Ω—Ç–∞—Ä–Ω–æ–º —Ñ–∞–π–ª–µ `hosts`, —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è –≤–∑—è—Ç—ã –∏–∑ –∫–∞—Ç–∞–ª–æ–≥–∞ `host_vars`, —Ç–∞–∫ –∫–∞–∫ —É –Ω–∏—Ö –±–æ–ª–µ–µ –≤—ã—Å–æ–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç:

```bash
ok: [minion1] => {  
    "my_new_variable": "Hello World from Alex from host_vars"  
}  
ok: [minion2] => {  
    "my_new_variable": "Hello World from Maxim from host_vars"  
}  
```

### –ú–æ–¥—É–ª—å `set_fact`

`set_fact` ‚Äî —ç—Ç–æ –º–æ–¥—É–ª—å Ansible, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–∑–≤–æ–ª—è–µ—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –≤–æ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è (runtime). –≠—Ç–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤ —Ç–µ–∫—É—â–µ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ ‚Äî –¥–ª—è —Ç–µ–∫—É—â–µ–≥–æ —Ö–æ—Å—Ç–∞ –∏ —Ç–µ–∫—É—â–µ–≥–æ –ø–ª–µ–π–±—É–∫–∞ ‚Äî –∏ –º–æ–≥—É—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –≤ –ø–æ—Å–ª–µ–¥—É—é—â–∏—Ö –∑–∞–¥–∞—á–∞—Ö.

–ß—Ç–æ –≤–∞–∂–Ω–æ –∑–∞–ø–æ–º–Ω–∏—Ç—å:

- –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è, —Å–æ–∑–¥–∞–Ω–Ω–∞—è —á–µ—Ä–µ–∑ `set_fact`, –¥–æ—Å—Ç—É–ø–Ω–∞ —Ç–æ–ª—å–∫–æ –¥–ª—è —Ç–µ–∫—É—â–µ–≥–æ —Ö–æ—Å—Ç–∞.
- –û–Ω–∞ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –¥–æ –∫–æ–Ω—Ü–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –ø–ª–µ–π–±—É–∫–∞.
- –ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —à–∞–±–ª–æ–Ω—ã Jinja2 –¥–ª—è –≤—ã—á–∏—Å–ª–µ–Ω–∏—è –∑–Ω–∞—á–µ–Ω–∏—è (—ç—Ç—É —Ç–µ–º—É —Ä–∞—Å—Å–º–æ—Ç—Ä–∏–º –ø–æ–∑–∂–µ).
- –í –æ—Ç–ª–∏—á–∏–µ –æ—Ç –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –≤ `vars`, `set_fact` —Å–æ–∑–¥–∞—ë—Ç –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –≤–æ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è.

–í –Ω–∞—à–µ–º –ø—Ä–∏–º–µ—Ä–µ –º—ã –æ–±—ä–µ–¥–∏–Ω–∏–ª–∏ –∑–Ω–∞—á–µ–Ω–∏—è —Ç—Ä—ë—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –≤ –æ–¥–Ω—É —Å—Ç—Ä–æ–∫—É –∏ —Å–æ—Ö—Ä–∞–Ω–∏–ª–∏ –≤ `my_new_variable`.

### –ú–æ–¥—É–ª—å `setup` (—Ñ–∞–∫—Ç—ã)

–ú–æ–¥—É–ª—å `setup` —Å–æ–±–∏—Ä–∞–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ü–µ–ª–µ–≤–æ–º —Ö–æ—Å—Ç–µ: –û–°, —Å–µ—Ç—å, –ø–∞–º—è—Ç—å, CPU, –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –∏ –¥—Ä., –∏ —Å–æ–∑–¥–∞—ë—Ç –º–Ω–æ–∂–µ—Å—Ç–≤–æ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö (–Ω–∞–∑—ã–≤–∞–µ–º—ã—Ö —Ñ–∞–∫—Ç–∞–º–∏), –∫–æ—Ç–æ—Ä—ã–µ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤ –ø–ª–µ–π–±—É–∫–∞—Ö.

–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é Ansible –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø—É—Å–∫–∞–µ—Ç `setup` –ø–µ—Ä–µ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ–º –ø–ª–µ–π–±—É–∫–∞, —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å —Ñ–∞–∫—Ç—ã. –≠—Ç–æ –ø–æ–≤–µ–¥–µ–Ω–∏–µ –º–æ–∂–Ω–æ –æ—Ç–∫–ª—é—á–∏—Ç—å –≤ –ø–ª–µ–π–±—É–∫–µ —Å –ø–æ–º–æ—â—å—é

```yaml
- hosts: all
  gather_facts: no
  tasks:
    - debug:
        msg: "{{ ansible_hostname }}"  # –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è –±—É–¥–µ—Ç –ø—É—Å—Ç–æ–π, –µ—Å–ª–∏ —Ñ–∞–∫—Ç—ã –Ω–µ —Å–æ–±–∏—Ä–∞–ª–∏—Å—å
```

–ï—Å–ª–∏ –Ω—É–∂–Ω–æ, –º–æ–∂–Ω–æ –≤—Ä—É—á–Ω—É—é –≤—ã–∑–≤–∞—Ç—å —Å–±–æ—Ä —Ñ–∞–∫—Ç–æ–≤ –∏ –¥–∞–∂–µ –æ–≥—Ä–∞–Ω–∏—á–∏—Ç—å –∏—Ö —Å –ø–æ–º–æ—â—å—é —Ñ–∏–ª—å—Ç—Ä–∞:

```yaml
- setup:
    filter: "ansible_distribution*"
```

–í —ç—Ç–æ–º —Å–ª—É—á–∞–µ –±—É–¥—É—Ç —Å–æ–±—Ä–∞–Ω—ã —Ç–æ–ª—å–∫–æ —Ñ–∞–∫—Ç—ã, –Ω–∞—á–∏–Ω–∞—é—â–∏–µ—Å—è —Å `ansible_distribution`, –Ω–∞–ø—Ä–∏–º–µ—Ä:

- `ansible_distribution`
- `ansible_distribution_version`
- `ansible_distribution_major_version`

–î—Ä—É–≥–∏–µ —Ñ–∞–∫—Ç—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä, `ansible_hostname` –∏–ª–∏ `ansible_memtotal_mb`) —Å–æ–±—Ä–∞–Ω—ã –Ω–µ –±—É–¥—É—Ç.

C–ø–∏—Å–æ–∫ —á–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö —Ñ–∞–∫—Ç–æ–≤ –∏–∑ –º–æ–¥—É–ª—è setup:

- **–•–æ—Å—Ç / –û–°:**

  - `ansible_hostname` ‚Äî –∏–º—è —Ö–æ—Å—Ç–∞
  - `ansible_fqdn` ‚Äî –ø–æ–ª–Ω–æ–µ –¥–æ–º–µ–Ω–Ω–æ–µ –∏–º—è
  - `ansible_distribution` ‚Äî –¥–∏—Å—Ç—Ä–∏–±—É—Ç–∏–≤ (–Ω–∞–ø—Ä–∏–º–µ—Ä, Ubuntu)
  - `ansible_distribution_version` ‚Äî –≤–µ—Ä—Å–∏—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, 20.04)
  - `ansible_architecture` ‚Äî –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, x86\_64)
  - `ansible_os_family` ‚Äî —Å–µ–º–µ–π—Å—Ç–≤–æ –û–° (Debian, RedHat)

- **–°–µ—Ç—å:**

  - `ansible_default_ipv4.address` ‚Äî –æ—Å–Ω–æ–≤–Ω–æ–π IP-–∞–¥—Ä–µ—Å
  - `ansible_all_ipv4_addresses` ‚Äî –≤—Å–µ IPv4-–∞–¥—Ä–µ—Å–∞
  - `ansible_interfaces` ‚Äî —Å–ø–∏—Å–æ–∫ —Å–µ—Ç–µ–≤—ã—Ö –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤
  - `ansible_eth0.ipv4.address` ‚Äî IP-–∞–¥—Ä–µ—Å –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ eth0

- **–ü—Ä–æ—Ü–µ—Å—Å–æ—Ä / –ü–∞–º—è—Ç—å:**

  - `ansible_processor_cores` ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —è–¥–µ—Ä
  - `ansible_processor` ‚Äî —Å–ø–∏—Å–æ–∫ CPU
  - `ansible_memtotal_mb` ‚Äî –æ–±—â–∏–π –æ–±—ä—ë–º –ø–∞–º—è—Ç–∏ –≤ –ú–ë
  - `ansible_memfree_mb` ‚Äî —Å–≤–æ–±–æ–¥–Ω–∞—è –ø–∞–º—è—Ç—å –≤ –ú–ë

- **–î–∏—Å–∫–∏:**

  - `ansible_mounts` ‚Äî —Å–ø–∏—Å–æ–∫ —Ç–æ—á–µ–∫ –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
  - `ansible_mounts.0.size_total` ‚Äî —Ä–∞–∑–º–µ—Ä –ø–µ—Ä–≤–æ–≥–æ —Ä–∞–∑–¥–µ–ª–∞

–í –Ω–∞—à–µ–º –ø—Ä–∏–º–µ—Ä–µ –º—ã –≤—ã–≤–µ–ª–∏ –Ω–∞ —ç–∫—Ä–∞–Ω –æ–±—ä—ë–º —Å–≤–æ–±–æ–¥–Ω–æ–π –ø–∞–º—è—Ç–∏:

```bash
TASK [Show free memory (fact)]
ok: [minion1] => {
    "ansible_memfree_mb": 5310
}
ok: [minion2] => {
    "ansible_memfree_mb": 5310
}
```

### –î–∏—Ä–µ–∫—Ç–∏–≤–∞ `register`

`register` ‚Äî –¥–∏—Ä–µ–∫—Ç–∏–≤–∞ Ansible, –∫–æ—Ç–æ—Ä–∞—è —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–¥–∞—á–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, shell-–∫–æ–º–∞–Ω–¥—ã) –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é.

–í –ø—Ä–∏–º–µ—Ä–µ –º—ã –≤—ã–ø–æ–ª–Ω–∏–ª–∏ –∫–æ–º–∞–Ω–¥—É `uptime` —á–µ—Ä–µ–∑ –º–æ–¥—É–ª—å `shell` –∏ —Å–æ—Ö—Ä–∞–Ω–∏–ª–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é `uptime_result`:

```yaml
- name: Run uptime and save output
  shell: uptime
  register: uptime_result
```

–ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π `uptime_result` –¥–æ—Å—Ç—É–ø–Ω–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å —Ç–∞–∫–∏–º–∏ –ø–æ–ª—è–º–∏:

- `stdout` ‚Äî —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –≤—ã–≤–æ–¥ –∫–æ–º–∞–Ω–¥—ã
- `stderr` ‚Äî –æ—à–∏–±–∫–∏
- `rc` ‚Äî –∫–æ–¥ –≤–æ–∑–≤—Ä–∞—Ç–∞
- `changed` ‚Äî –±—ã–ª–æ –ª–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–µ
- `stdout_lines` ‚Äî –≤—ã–≤–æ–¥ –∫–æ–º–∞–Ω–¥—ã –ø–æ—Å—Ç—Ä–æ—á–Ω–æ

–¢–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º, `register` –ø–æ–∑–≤–æ–ª—è–µ—Ç —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤—ã–≤–æ–¥ –∫–æ–º–∞–Ω–¥—ã –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –µ–≥–æ –≤ –ø–æ—Å–ª–µ–¥—É—é—â–∏—Ö –∑–∞–¥–∞—á–∞—Ö.

## –®–∞–≥ 6. –£—Å–ª–æ–≤–∏—è (when) –∏ –±–ª–æ–∫–∏ (block)

### –£—Å–ª–æ–≤–∏—è when

–î–æ–±–∞–≤–∏–º –Ω–æ–≤—ã–π —Ö–æ—Å—Ç `minion3`, –∫–æ—Ç–æ—Ä—ã–º –º—ã –±—É–¥–µ–º —É–ø—Ä–∞–≤–ª—è—Ç—å –Ω–∞ –±–∞–∑–µ –¥–∏—Å—Ç—Ä–∏–±—É—Ç–∏–≤–∞ Red Hat (–≤ –Ω–∞—à–µ–º —Å–ª—É—á–∞–µ Rocky Linux), –≤ –∏–Ω–≤–µ–Ω—Ç–æ—Ä–∏ —Ñ–∞–π–ª `hosts`:

```ini
...
[worker_servers]
minion2 owner="Maxim from inventory"
minion3
...
````

–î–∞–ª–µ–µ –Ω–∞–ø–∏—à–µ–º –Ω–æ–≤—ã–π –ø–ª–µ–π–±—É–∫ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ nginx `install_nginx_when.yml`. –ü–æ—Å–∫–æ–ª—å–∫—É `minion3` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –¥—Ä—É–≥–æ–π –¥–∏—Å—Ç—Ä–∏–±—É—Ç–∏–≤ Linux, –ø—Ä–µ–¥—ã–¥—É—â–∏–π –ø–ª–µ–π–±—É–∫ –≤—ã–¥–∞—Å—Ç –æ—à–∏–±–∫—É –ø—Ä–∏ –ø–æ–ø—ã—Ç–∫–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –º–æ–¥—É–ª—å `apt`, –∫–æ—Ç–æ—Ä—ã–π –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ RedHat-like —Å–∏—Å—Ç–µ–º–∞—Ö. –ó–¥–µ—Å—å –ø–æ–º–æ–∂–µ—Ç –¥–∏—Ä–µ–∫—Ç–∏–≤–∞ `when`, –∫–æ—Ç–æ—Ä–∞—è –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —É—Å–ª–æ–≤–Ω–æ–≥–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–¥–∞—á, —Ö–µ–Ω–¥–ª–µ—Ä–æ–≤ –∏–ª–∏ —Ä–æ–ª–µ–π.

```yaml
- name: Install Nginx with content on RedHat-like and Debian-like systems
  hosts: all
  become: true
  
  vars:
    source_file: "../website_content/index.html" 
    dest_file_debian: "/var/www/html" # –ü—É—Ç—å –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è –¥–ª—è —Ñ–∞–π–ª–∞ index.html –Ω–∞ Debian-–ø–æ–¥–æ–±–Ω—ã—Ö —Å–∏—Å—Ç–µ–º–∞—Ö
    dest_file_redhat: "/usr/share/nginx/html" # –ü—É—Ç—å –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è –¥–ª—è —Ñ–∞–π–ª–∞ index.html –Ω–∞ RedHat-–ø–æ–¥–æ–±–Ω—ã—Ö —Å–∏—Å—Ç–µ–º–∞—Ö

  tasks:
    - name: Update apt cache
      apt:
        update_cache: yes
      when: ansible_os_family == "Debian"

    - name: Install nginx on Debian-like systems
      apt:
        name: nginx
        state: present
      when: ansible_os_family == "Debian"

    - name: Install EPEL repository on RedHat-like systems
      dnf:
        name: epel-release
        state: present
      when: ansible_os_family == "RedHat"

    - name: Install nginx on RedHat-like systems
      dnf:
        name: nginx
        state: present
      when: ansible_os_family == "RedHat"

    - name: Copy custom index.html to Nginx web root on Debian-like systems
      copy:
        src: "{{ source_file }}"
        dest: "{{ dest_file_debian }}"
        mode: '0644'
      when: ansible_os_family == "Debian"

    - name: Copy custom index.html to Nginx web root on RedHat-like systems
      copy:
        src: "{{ source_file }}"
        dest: "{{ dest_file_redhat }}"
        mode: '0644'
      when: ansible_os_family == "RedHat"

    - name: Ensure nginx is running and enabled
      service:
        name: nginx
        state: started
        enabled: yes
```

–ó–∞–ø—É—Å—Ç–∏–º –ø–ª–µ–π–±—É–∫ `ansible-playbook playbooks/install_nginx_when.yml`. –í –≤—ã–≤–æ–¥–µ –±—É–¥–µ—Ç –≤–∏–¥–Ω–æ, —á—Ç–æ –±–ª–∞–≥–æ–¥–∞—Ä—è –¥–∏—Ä–µ–∫—Ç–∏–≤–µ `when` –∑–∞–¥–∞—á–∏ –¥–ª—è —Å–∏—Å—Ç–µ–º –Ω–∞ –±–∞–∑–µ Debian –ø—Ä–æ–ø—É—Å–∫–∞—é—Ç—Å—è –Ω–∞ —Ö–æ—Å—Ç–∞—Ö —Å –¥–∏—Å—Ç—Ä–∏–±—É—Ç–∏–≤–∞–º–∏ Red Hat, –∏ –Ω–∞–æ–±–æ—Ä–æ—Ç

```bash
TASK [Update apt cache] 
skipping: [minion3]
ok: [minion1]
ok: [minion2]

...
TASK [Install EPEL repository] 
skipping: [minion1]
skipping: [minion2]
ok: [minion3]
```

### –î–∏—Ä–µ–∫—Ç–∏–≤–∞ block

–ü–ª–µ–π–±—É–∫ —Å–æ–¥–µ—Ä–∂–∏—Ç –º–Ω–æ–≥–æ –ø–æ–≤—Ç–æ—Ä—è—é—â–µ–≥–æ—Å—è –∫–æ–¥–∞, –∫–æ—Ç–æ—Ä—ã–π –º–æ–∂–Ω–æ —Å–æ–∫—Ä–∞—Ç–∏—Ç—å –∏ —Å–¥–µ–ª–∞—Ç—å –±–æ–ª–µ–µ –≤—ã—Ä–∞–∑–∏—Ç–µ–ª—å–Ω—ã–º —Å –ø–æ–º–æ—â—å—é –¥–∏—Ä–µ–∫—Ç–∏–≤—ã `block`. –û–Ω–∞ –≥—Ä—É–ø–ø–∏—Ä—É–µ—Ç –∑–∞–¥–∞—á–∏ –≤ –µ–¥–∏–Ω—ã–π –±–ª–æ–∫, –∫ –∫–æ—Ç–æ—Ä–æ–º—É –º–æ–∂–Ω–æ –ø—Ä–∏–º–µ–Ω–∏—Ç—å —É—Å–ª–æ–≤–∏—è, –ø—Ä–∞–≤–∞, —Ç–µ–≥–∏ –∏ –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫ —á–µ—Ä–µ–∑ `rescue` –∏ `always`.

```yaml
- name: –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è block/rescue/always
  block:
    - name: –ó–∞–¥–∞—á–∞ 1
      command: /bin/true
    - name: –ó–∞–¥–∞—á–∞ 2
      command: /bin/false
  rescue:
    - name: –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–∫–∏
      debug:
        msg: "–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞"
  always:
    - name: –ó–∞–¥–∞—á–∞, –≤—ã–ø–æ–ª–Ω—è—é—â–∞—è—Å—è –≤—Å–µ–≥–¥–∞
      debug:
        msg: "–ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ –±–ª–æ–∫–∞"
```

–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ –≤–ª–æ–∂–µ–Ω–Ω–æ—Å—Ç–∏ –±–ª–æ–∫–æ–≤:

- –ó–∞–¥–∞—á–∏ –≤–Ω—É—Ç—Ä–∏ –±–ª–æ–∫–∞ —è–≤–ª—è—é—Ç—Å—è –µ–≥–æ –¥–æ—á–µ—Ä–Ω–∏–º–∏.
- –ü–∞—Ä–∞–º–µ—Ç—Ä—ã, –ø—Ä–∏–º–µ–Ω—ë–Ω–Ω—ã–µ –∫ –≤–Ω–µ—à–Ω–µ–º—É –±–ª–æ–∫—É (–Ω–∞–ø—Ä–∏–º–µ—Ä, `when`), –≤–ª–∏—è—é—Ç –Ω–∞ –≤—Å–µ –≤–ª–æ–∂–µ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏ –∏ –±–ª–æ–∫–∏, –µ—Å–ª–∏ –≤–Ω—É—Ç—Ä–∏ –Ω–∏—Ö –Ω–µ –∑–∞–¥–∞–Ω—ã —Å–≤–æ–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã.
- –ü—Ä–∏ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –≤–Ω—É—Ç—Ä–∏ –≤–ª–æ–∂–µ–Ω–Ω—ã—Ö –±–ª–æ–∫–æ–≤ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç —É –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏—Ö.
- –°–µ–∫—Ü–∏–∏ `rescue` –∏ `always` –æ—Ç–Ω–æ—Å—è—Ç—Å—è –∫ –±–ª–∏–∂–∞–π—à–µ–º—É —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–º—É –±–ª–æ–∫—É. –û—à–∏–±–∫–∞ –≤–Ω—É—Ç—Ä–∏ –≤–ª–æ–∂–µ–Ω–Ω–æ–≥–æ –±–ª–æ–∫–∞ –≤—ã–∑—ã–≤–∞–µ—Ç –µ–≥–æ `rescue`, –∏–ª–∏ ¬´–ø–æ–¥–Ω–∏–º–∞–µ—Ç—Å—è¬ª –≤—ã—à–µ, –µ—Å–ª–∏ —Ç–∞–∫–æ–≤–æ–π –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç.

–ü–µ—Ä–µ–ø–∏—à–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–π –ø–ª–µ–π–±—É–∫ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º `block`. –°–æ–∑–¥–∞–¥–∏–º —Ñ–∞–π–ª `install_nginx_block.yml`:

```yaml
- name: Install Nginx with content on RedHat-like and Debian-like systems
  hosts: all
  become: true
  
  vars:
    source_file: "../website_content/index.html" 
    dest_file_debian: "/var/www/html"
    dest_file_redhat: "/usr/share/nginx/html"

  tasks:
    - block:
        - name: Update apt cache
          apt:
            update_cache: yes

        - name: Install nginx on Debian-like systems
          apt:
            name: nginx
            state: present

        - name: Copy custom index.html to Nginx web root on Debian-like systems
          copy:
            src: "{{ source_file }}"
            dest: "{{ dest_file_debian }}"
            mode: '0644'
      when: ansible_os_family == "Debian"

    - block:
        - name: Install EPEL repository on RedHat-like systems
          dnf:
            name: epel-release
            state: present

        - name: Install nginx on RedHat-like systems
          dnf:
            name: nginx
            state: present

        - name: Copy custom index.html to Nginx web root on RedHat-like systems
          copy:
            src: "{{ source_file }}"
            dest: "{{ dest_file_redhat }}"
            mode: '0644'
      when: ansible_os_family == "RedHat"

    - name: Ensure nginx is running and enabled
      service:
        name: nginx
        state: started
        enabled: yes
```

–≠—Ç–æ—Ç –≤–∞—Ä–∏–∞–Ω—Ç –ø–ª–µ–π–±—É–∫–∞ –∫–æ–º–ø–∞–∫—Ç–Ω–µ–µ –∏ —É–¥–æ–±–Ω–µ–µ –¥–ª—è —Å–æ–ø—Ä–æ–≤–æ–∂–¥–µ–Ω–∏—è.

## –®–∞–≥ 7. –¶–∏–∫–ª—ã Loop, Until, With_*

–¶–∏–∫–ª—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è, —á—Ç–æ–±—ã –ø–æ–≤—Ç–æ—Ä–∏—Ç—å –∫–∞–∫–æ–µ-–ª–∏–±–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑. –í Ansible –µ—Å—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–ø–æ—Å–æ–±–æ–≤, –∫–∞–∫ –æ—Ä–≥–∞–Ω–∏–∑–æ–≤–∞—Ç—å —Ü–∏–∫–ª.

### –¶–∏–∫–ª loop (with_items)

–°–æ–∑–¥–∞–¥–∏–º –Ω–æ–≤—ã–π –ø–ª–µ–π–±—É–∫ `playbook/loop.yaml`:

```yaml
---
- name: Loops Playbook
  hosts: minion1  # –æ–≥—Ä–∞–Ω–∏—á–∏–º –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –æ–¥–Ω–∏–º —Ö–æ—Å—Ç–æ–º
  become: yes

  tasks:
    - name: Say Hello
      debug:
        msg: "Hello {{ item }}"  # —Ä–∞—Å–ø–µ—á–∞—Ç—ã–≤–∞–µ–º —ç–ª–µ–º–µ–Ω—Ç—ã —Ü–∏–∫–ª–∞, –ø—Ä–µ–¥–æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ–µ –∏–º—è –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π —Ü–∏–∫–ª–∞ ‚Äî item
      # with_items: # –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª—Å—è –¥–æ –≤–µ—Ä—Å–∏–∏ Ansible 2.5
      loop:  # –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ü–∏–∫–ª–∞
        - "Alex"  # —ç–ª–µ–º–µ–Ω—Ç —Ü–∏–∫–ª–∞
        - "Max"
        - "Katya"
        - "Mery"
````

–ó–∞–ø—É—Å—Ç–∏–º –∏ –ø–æ—Å–º–æ—Ç—Ä–∏–º –≤—ã–≤–æ–¥:

```sh
TASK [Say Hello]
ok: [minion1] => (item=Alex) => {
    "msg": "Hello Alex"
}
ok: [minion1] => (item=Max) => {
    "msg": "Hello Max"
}
ok: [minion1] => (item=Katya) => {
    "msg": "Hello Katya"
}
ok: [minion1] => (item=Mery) => {
    "msg": "Hello Mery"
}
```

–ö–∞–∫ –∏ –æ–∂–∏–¥–∞–ª–æ—Å—å, –¥–∏—Ä–µ–∫—Ç–∏–≤–∞ `debug: msg="Hello {{ item }}"` –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞ —Ü–∏–∫–ª–∞, –∑–∞–¥–∞–Ω–Ω–æ–≥–æ —Å –ø–æ–º–æ—â—å—é `loop`.

–í–æ—Ç –ø—Ä–∏–º–µ—Ä –±–æ–ª–µ–µ –ø–æ–ª–µ–∑–Ω–æ–≥–æ –∏ —Ä–µ–∞–ª—å–Ω–æ–≥–æ –∫–µ–π—Å–∞ –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π —á–µ—Ä–µ–∑ —Ü–∏–∫–ª `loop`. –í–º–µ—Å—Ç–æ —Å–ø–µ—Ü–∏—Ñ–∏—á–µ—Å–∫–∏—Ö –º–æ–¥—É–ª–µ–π Ansible –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –ø–∞–∫–µ—Ç–æ–≤ (`apt`, `dnf`), –∏—Å–ø–æ–ª—å–∑—É–µ–º —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π –º–æ–¥—É–ª—å `package`, –∫–æ—Ç–æ—Ä—ã–π —Ä–∞–±–æ—Ç–∞–µ—Ç —Å —Ä–∞–∑–ª–∏—á–Ω—ã–º–∏ –º–µ–Ω–µ–¥–∂–µ—Ä–∞–º–∏ –ø–∞–∫–µ—Ç–æ–≤ (apt, yum/dnf, pacman –∏ –¥—Ä.). Ansible —Å–∞–º –æ–ø—Ä–µ–¥–µ–ª–∏—Ç, –∫–∞–∫–æ–π –º–µ–Ω–µ–¥–∂–µ—Ä –ø–∞–∫–µ—Ç–æ–≤ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –Ω–∞ —Ü–µ–ª–µ–≤–æ–º —Å–µ—Ä–≤–µ—Ä–µ, –∏ –≤—ã–ø–æ–ª–Ω–∏—Ç —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â—É—é –∫–æ–º–∞–Ω–¥—É.

–°–æ–∑–¥–∞–¥–∏–º –Ω–æ–≤—ã–π –ø–ª–µ–π–±—É–∫ `install_packages.yml`:

```yaml
---
- name: Install packages via loop playbook
  hosts: all
  become: yes

  tasks:
    # –û–±–Ω–æ–≤–ª—è–µ–º –∫–µ—à –ø–∞–∫–µ—Ç–æ–≤ –æ–¥–∏–Ω —Ä–∞–∑, —á—Ç–æ–±—ã –Ω–µ –≤—ã–ø–æ–ª–Ω—è—Ç—å –ø—Ä–∏ –∫–∞–∂–¥–æ–º —à–∞–≥–µ —Ü–∏–∫–ª–∞
    - name: Update package cache on Debian-based systems
      apt:
        update_cache: yes
      when: ansible_os_family == "Debian"

    - name: Update package cache on RedHat-based systems
      yum:
        update_cache: yes
      when: ansible_os_family == "RedHat"

    # –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø–∞–∫–µ—Ç—ã –≤ —Ü–∏–∫–ª–µ
    - name: Install many packages
      package:
        name: "{{ item }}"
        state: present
        update_cache: no
      loop:
        - tree
        - tmux
        - tcpdump
        - dnsutils
        - nmap
```

–ó–∞–ø—É—Å–∫–∞–µ–º –ø–ª–µ–π–±—É–∫ –∏ –º–æ–∂–µ–º —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –Ω–∞ –≤—Å–µ—Ö —Å–µ—Ä–≤–µ—Ä–∞—Ö —É–∫–∞–∑–∞–Ω–Ω—ã–µ –ø–∞–∫–µ—Ç—ã —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã.

### –¶–∏–∫–ª until

–¶–∏–∫–ª `until` –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –¥–æ —Ç–µ—Ö –ø–æ—Ä, –ø–æ–∫–∞ –Ω–µ –≤—ã–ø–æ–ª–Ω–∏—Ç—Å—è –∑–∞–¥–∞–Ω–Ω–æ–µ —É—Å–ª–æ–≤–∏–µ. –ö–ª—é—á–µ–≤—ã–µ –º–æ–º–µ–Ω—Ç—ã:

- –í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –º–∏–Ω–∏–º—É–º –æ–¥–∏–Ω —Ä–∞–∑.
- –ï—Å–ª–∏ —É—Å–ª–æ–≤–∏–µ –Ω–µ –∏—Å—Ç–∏–Ω–Ω–æ, –ø–æ–≤—Ç–æ—Ä—è–µ—Ç—Å—è –¥–æ `retries` —Ä–∞–∑.
- –ú–µ–∂–¥—É –ø–æ–ø—ã—Ç–∫–∞–º–∏ –ø–∞—É–∑–∞ `delay` —Å–µ–∫—É–Ω–¥.
- –£—Å–ª–æ–≤–∏–µ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –ø–æ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π (–¥–∏—Ä–µ–∫—Ç–∏–≤–∞ `register`).
- –ï—Å–ª–∏ —É—Å–ª–æ–≤–∏–µ –Ω–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ –ø–æ—Å–ª–µ –≤—Å–µ—Ö –ø–æ–ø—ã—Ç–æ–∫ ‚Äî –∑–∞–¥–∞—á–∞ —Å—á–∏—Ç–∞–µ—Ç—Å—è –Ω–µ—É–¥–∞—á–Ω–æ–π.

–°–æ–∑–¥–∞–¥–∏–º –ø–ª–µ–π–±—É–∫ `playbook/until.yaml`:

```yaml
---
- name: Until Playbook
  hosts: minion1
  become: yes

  tasks:
    - name: until loop example
      shell: echo -n A >> until_demo.txt && cat until_demo.txt  # –î–æ–±–∞–≤–ª—è–µ—Ç 'A' –±–µ–∑ –ø–µ—Ä–µ—Ö–æ–¥–∞ —Å—Ç—Ä–æ–∫–∏ –∏ –≤—ã–≤–æ–¥–∏—Ç —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–∞–π–ª–∞
      register: result                                         # –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
      retries: 10                                              # –î–æ 10 –ø–æ–≤—Ç–æ—Ä–æ–≤
      delay: 1                                                 # –ü–∞—É–∑–∞ 1 —Å–µ–∫—É–Ω–¥–∞
      until: "'AAAAA' in result.stdout"                        # –ü–æ–≤—Ç–æ—Ä—è—Ç—å, –ø–æ–∫–∞ –≤ –≤—ã–≤–æ–¥–µ –Ω–µ—Ç 'AAAAA'

    - name: Show current counter value  # –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –∫–æ–Ω–µ—á–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç
      debug:
        msg: "Current value: {{ result.stdout }}"
```

–ó–¥–µ—Å—å –ª–æ–≥–∏–∫–∞ —Ç–∞–∫–æ–≤–∞: –≤ —Ñ–∞–π–ª –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –±—É–∫–≤–∞ "–ê" –∏ –≤—ã–≤–æ–¥–∏—Ç—Å—è —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ. –†–µ–∑—É–ª—å—Ç–∞—Ç —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é `result`. –¶–∏–∫–ª –ø–æ–≤—Ç–æ—Ä—è–µ—Ç—Å—è, –ø–æ–∫–∞ –≤ `result.stdout` –Ω–µ –ø–æ—è–≤–∏—Ç—Å—è —Å—Ç—Ä–æ–∫–∞ `'AAAAA'`, –º–∞–∫—Å–∏–º—É–º 10 —Ä–∞–∑ —Å –∑–∞–¥–µ—Ä–∂–∫–æ–π –≤ 1 —Å–µ–∫—É–Ω–¥—É –º–µ–∂–¥—É –ø–æ–ø—ã—Ç–∫–∞–º–∏.

–ï—Å–∏–ª –±—ã –º—ã –∏—Å–∫–∞–ª–∏ –Ω–µ 5 –±—É–∫–≤ –ê (–ê–ê–ê–ê–ê), –∞ –∫ –ø—Ä–∏–º–µ—Ä—É 100, —Ç–æ —Ü–∏–∫–ª –±—ã –≤—ã–ø–æ–ª–Ω–∏–ª—Å—è 11 —Ä–∞–∑ (–ø–µ—Ä—ã–π, –∏ –µ—â–µ 10 –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–π), –∏ –∑–∞–¥–∞—á–∞ –∑–∞–≤–µ—Ä—à–∏–ª–∞—Å—å –±—ã –Ω–µ—É–¥–∞—á–µ–π.

–ó–∞–ø—É—Å—Ç–∏–º –ø–ª–µ–π–±—É–∫ —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–º -v (–≥–æ–≤–æ—Ä–∏—Ç –∞–Ω—Å–∏–±–ª –¥–µ–ª–∞—Ç—å –±–æ–ª–µ–µ –ø–æ–¥—Ä–æ–±–Ω—ã–π –≤—ã–≤–æ–¥ —Ö–æ–¥–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è), —á—Ç–æ–±—ã –æ—Ç–æ–±—Ä–∞–∑–∏—Ç—å –≤—Å–µ –ø–æ–≤—Ç–æ—Ä—ã —Ü–∏–∫–ª–∞ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é, –±–µ–∑ -v, —á—Ç–æ–±—ã –Ω–µ –ø–µ—Ä–µ–≥—Ä—É–∞—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –≤—ã–≤–æ–¥, Ansible –ø–æ–∫–∞–µ—Ç —Ç–æ–ª—å–∫–æ –ø–µ—Ä–≤—ã–µ 2 —Å—Ç—Ä–æ–∫–∏) `ansible-playbook playbooks/until.yml -v`

–ü—Ä–∏–º–µ—Ä –≤—ã–≤–æ–¥–∞:

```sh
TASK [until loop example]
FAILED - RETRYING: [minion1]: until loop example (10 retries left).
FAILED - RETRYING: [minion1]: until loop example (9 retries left).
FAILED - RETRYING: [minion1]: until loop example (8 retries left).
FAILED - RETRYING: [minion1]: until loop example (7 retries left).
changed: [minion1] => {
  "attempts": 5,
  "changed": true,
  "cmd": "echo -n A >> until_demo.txt && cat until_demo.txt",
  "stdout": "AAAAA"
}

TASK [Show current counter value]
ok: [minion1] => {
    "msg": "Current value: AAAAA"
}
```

–¶–∏–∫–ª `until` –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è, –∫–æ–≥–¥–∞ –Ω—É–∂–Ω–æ –∂–¥–∞—Ç—å, –ø–æ–∫–∞ —á—Ç–æ-—Ç–æ –∏–∑–º–µ–Ω–∏—Ç—Å—è –∏–ª–∏ —Å—Ç–∞–Ω–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ, —Å –∫–æ–Ω—Ç—Ä–æ–ª–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –ø–æ–ø—ã—Ç–æ–∫ –∏ –∏–Ω—Ç–µ—Ä–≤–∞–ª–æ–º.

–ù–∞–ø—Ä–∏–º–µ—Ä, –∑–∞–¥–∞—á–∞, –∫–æ—Ç–æ—Ä–∞—è –∂–¥–µ—Ç 50 —Å–µ–∫—É–Ω–¥ (10 –ø–æ–ø—ã—Ç–æ–∫ —Å –ø–∞—É–∑–æ–π 5 —Å–µ–∫—É–Ω–¥), –ø–æ–∫–∞ —Ö–æ—Å—Ç –Ω–µ –Ω–∞—á–Ω–µ—Ç –æ—Ç–≤–µ—á–∞—Ç—å –Ω–∞ ping:

```yaml
- name: Wait until 192.168.1.100 responds to ping
  shell: ping -c 1 -W 1 192.168.1.100  # –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –æ–¥–∏–Ω ping (—Ç–∞–π–º–∞—É—Ç 1 —Å–µ–∫—É–Ω–¥–∞)
  register: ping_result                # –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
  ignore_errors: yes                   # –ù–µ –ø—Ä–µ—Ä—ã–≤–∞—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –ø—Ä–∏ –æ—à–∏–±–∫–µ
  retries: 10                         # –ü–æ–≤—Ç–æ—Ä–∏—Ç—å –¥–æ 10 —Ä–∞–∑
  delay: 5                           # –ü–∞—É–∑–∞ 5 —Å–µ–∫—É–Ω–¥ –º–µ–∂–¥—É –ø–æ–ø—ã—Ç–∫–∞–º–∏
  until: ping_result.rc == 0          # –£—Å–ª–æ–≤–∏–µ: —É—Å–ø–µ—à–Ω—ã–π –∫–æ–¥ –≤–æ–∑–≤—Ä–∞—Ç–∞
```

–ü—Ä–∏–º–µ—Ä –≤—ã–≤–æ–¥–∞:

```sh
TASK [Wait until 192.168.1.100 responds to ping]
FAILED - RETRYING: Wait until 192.168.1.100 responds to ping (9 retries left).
FAILED - RETRYING: Wait until 192.168.1.100 responds to ping (8 retries left).
ok: [localhost]
```

---

### –¶–∏–∫–ª `with_fileglob` –∏ `glob`

–î–ª—è –¥–∞–ª—å–Ω–µ–π—à–µ–≥–æ –∏–∑—É—á–µ–Ω–∏—è –¥–æ–±–∞–≤–∏–º –ø–∞–ø–∫—É `website_content2`, –≤ –∫–æ—Ç–æ—Ä–æ–π –ª–µ–∂–∞—Ç –¥–≤–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è (`image1.jpeg` –∏ `image2.png`) –∏ –æ–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–π `index.html`, –ø–æ–∫–∞–∑—ã–≤–∞—é—â–∏–π —ç—Ç–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è. –≠—Ç–∏ —Ñ–∞–π–ª—ã –±—É–¥–µ–º –∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å –ø–æ–º–æ—â—å—é —Ü–∏–∫–ª–∞.

–°–æ–∑–¥–∞–¥–∏–º –ø–ª–µ–π–±—É–∫ `install_nginx_loop.yml`:

```yaml
- name: Install Nginx with content and loop on RedHat-like and Debian-like systems
  hosts: all
  become: true

  vars:
    source_folder: "../website_content2"  # –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –¥–ª—è –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è
    dest_folder_debian: "/var/www/html"   # –∫–∞—Ç–∞–ª–æ–≥ –Ω–∞ Debian-–ø–æ–¥–æ–±–Ω—ã—Ö —Å–∏—Å—Ç–µ–º–∞—Ö
    dest_folder_redhat: "/usr/share/nginx/html" # –∫–∞—Ç–∞–ª–æ–≥ –Ω–∞ RedHat-–ø–æ–¥–æ–±–Ω—ã—Ö —Å–∏—Å—Ç–µ–º–∞—Ö
    web_files:  # —Å–ø–∏—Å–æ–∫ —Ñ–∞–π–ª–æ–≤ –¥–ª—è –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è
      - index.html
      - image1.jpeg
      - image2.png

  tasks:
    - name: Ensure the Nginx package is installed
      package:
        name: nginx
        state: present
        update_cache: yes

    - name: Copy files to Nginx web root on Debian-like systems
      copy:
        src: "{{ source_folder }}/{{ item }}"  # –æ—Ç–∫—É–¥–∞ –±—Ä–∞—Ç—å —Ñ–∞–π–ª
        dest: "{{ dest_folder_debian }}"        # –∫—É–¥–∞ –∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å
        mode: '0644'
      loop: "{{ web_files }}"  # —Ñ–∞–π–ª—ã –¥–ª—è –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è
      when: ansible_os_family == "Debian"

    - name: Copy files to Nginx web root on RedHat-like systems
      copy:
        src: "{{ source_folder }}/{{ item }}"
        dest: "{{ dest_folder_redhat }}"
        mode: '0644'
      loop: "{{ web_files }}"
      when: ansible_os_family == "RedHat"

    - name: Ensure nginx is running and enabled
      service:
        name: nginx
        state: started
        enabled: yes
```

–ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ –ø–ª–µ–π–±—É–∫–∞ –º–æ–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ —Å—Ç—Ä–∞–Ω–∏—Ü–∞ —Å –∫–∞—Ä—Ç–∏–Ω–∫–∞–º–∏ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –ø–æ –∞–¥—Ä–µ—Å–∞–º <http://localhost:8081> –¥–ª—è minion1, <http://localhost:8082> –¥–ª—è minion2, –∏ <http://localhost:8083> –¥–ª—è minion3.

–ï—Å–ª–∏ —Ñ–∞–π–ª–æ–≤ –º–Ω–æ–≥–æ, —É–∫–∞–∑—ã–≤–∞—Ç—å –∏—Ö –≤ —Å–ø–∏—Å–∫–µ –Ω–µ—É–¥–æ–±–Ω–æ. –î–ª—è —ç—Ç–æ–≥–æ –µ—Å—Ç—å —Ü–∏–∫–ª `with_fileglob`.

`with_fileglob` ‚Äî —Ü–∏–∫–ª, –∫–æ—Ç–æ—Ä—ã–π –ø–µ—Ä–µ–±–∏—Ä–∞–µ—Ç —Ñ–∞–π–ª—ã –ø–æ —à–∞–±–ª–æ–Ω—É (–≥–ª–æ–±—É) –Ω–∞ –ª–æ–∫–∞–ª—å–Ω–æ–π –º–∞—à–∏–Ω–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è (–∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–µ).

–ü–µ—Ä–µ–ø–∏—à–µ–º –ø–ª–µ–π–±—É–∫ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º `with_fileglob` (–≤–µ—Ä—Å–∏—è —Å `loop` –∑–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∞):

```yaml
- name: Install Nginx with content and with_fileglob on RedHat-like and Debian-like systems
  hosts: all
  become: true

  vars:
    source_folder: "../website_content2"
    dest_folder_debian: "/var/www/html"
    dest_folder_redhat: "/usr/share/nginx/html"
    # web_files:  # —Å–ø–∏—Å–æ–∫ —Ñ–∞–π–ª–æ–≤ –¥–ª—è loop-–≤–µ—Ä—Å–∏–∏
    #  - index.html
    #  - image1.jpeg
    #  - image2.png

  tasks:
    - name: Ensure the Nginx package is installed
      package:
        name: nginx
        state: present
        update_cache: yes

    - name: Copy files to Nginx web root on Debian-like systems
      copy:
        # src: "{{ source_folder }}/{{ item }}"  # loop-–≤–µ—Ä—Å–∏—è
        src: "{{ item }}"  # with_fileglob –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø–æ–ª–Ω—ã–π –ø—É—Ç—å
        dest: "{{ dest_folder_debian }}"
        mode: '0644'
      # loop: "{{ web_files }}"  # loop-–≤–µ—Ä—Å–∏—è
      with_fileglob: "{{ source_folder }}/*.*"  # –ø–µ—Ä–µ–±–∏—Ä–∞–µ–º –≤—Å–µ —Ñ–∞–π–ª—ã –≤ –∫–∞—Ç–∞–ª–æ–≥–µ
      when: ansible_os_family == "Debian"

    - name: Copy files to Nginx web root on RedHat-like systems
      copy:
        # src: "{{ source_folder }}/{{ item }}"  # loop-–≤–µ—Ä—Å–∏—è
        src: "{{ item }}"
        dest: "{{ dest_folder_redhat }}"
        mode: '0644'
      # loop: "{{ web_files }}"  # loop-–≤–µ—Ä—Å–∏—è
      with_fileglob: "{{ source_folder }}/*.*"
      when: ansible_os_family == "RedHat"

    - name: Ensure nginx is running and enabled
      service:
        name: nginx
        state: started
        enabled: yes
```

–û–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ, —á—Ç–æ  `src: "{{ source_folder }}/{{ item }}"` –≤ `copy` –∑–∞–º–µ–Ω–µ–Ω –Ω–∞ `src: "{{ item }}`, —Ç–∞–∫ –∫–∞–∫ `with_fileglob` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø–æ–ª–Ω—ã–π –ø—É—Ç—å –∫ —Ñ–∞–π–ª—É.

#### Glob (—à–∞–±–ª–æ–Ω—ã)

–ì–ª–æ–± (glob) ‚Äî —ç—Ç–æ —à–∞–±–ª–æ–Ω –¥–ª—è –ø–æ–∏—Å–∫–∞ —Ñ–∞–π–ª–æ–≤ –ø–æ –º–∞—Å–∫–µ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã—Ö —Å–∏–º–≤–æ–ª–æ–≤.

–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ –º–∞—Å–∫–∏:

–ú–∞—Å–∫–∞ | –ó–Ω–∞—á–µ–Ω–∏–µ
--- | ---
`*` | –õ—é–±–∞—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Å–∏–º–≤–æ–ª–æ–≤ (–≤ —Ç–æ–º —á–∏—Å–ª–µ –ø—É—Å—Ç–∞—è)
`?` | –û–¥–∏–Ω –ª—é–±–æ–π —Å–∏–º–≤–æ–ª
`[abc]` | –û–¥–∏–Ω —Å–∏–º–≤–æ–ª –∏–∑ –ø–µ—Ä–µ—á–∏—Å–ª–µ–Ω–Ω—ã—Ö (–Ω–∞–ø—Ä–∏–º–µ—Ä, `a`, `b` –∏–ª–∏ `c`)
`[a-z]` | –û–¥–∏–Ω —Å–∏–º–≤–æ–ª –∏–∑ –¥–∏–∞–ø–∞–∑–æ–Ω–∞
`**` | –†–µ–∫—É—Ä—Å–∏–≤–Ω—ã–π –ø–æ–∏—Å–∫ –≤ –ø–æ–¥–∫–∞—Ç–∞–ª–æ–≥–∞—Ö

–ü—Ä–∏–º–µ—Ä—ã:

–®–∞–±–ª–æ–Ω | –ß—Ç–æ –Ω–∞–π–¥—ë—Ç
 --- | ---
`*.txt` | –í—Å–µ `.txt` —Ñ–∞–π–ª—ã –≤ –∫–∞—Ç–∞–ª–æ–≥–µ
`file?.log` | `file1.log`, `fileA.log`, –Ω–æ –Ω–µ `file12.log`
`config[12].yml`| `config1.yml`, `config2.yml`
`**/*.conf` | –í—Å–µ `.conf` –≤–æ –≤—Å–µ—Ö –ø–æ–¥–∫–∞—Ç–∞–ª–æ–≥–∞—Ö

---

### –¶–∏–∫–ª—ã `with_*` –∏ –∏—Ö —ç–∫–≤–∏–≤–∞–ª–µ–Ω—Ç—ã —Å `loop`

–í Ansible –µ—Å—Ç—å –¥–∏—Ä–µ–∫—Ç–∏–≤—ã –≤–∏–¥–∞ `with_*`, –∫–æ—Ç–æ—Ä—ã–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –¥–ª—è —Ü–∏–∫–ª–æ–≤ –≤ —Ä–∞–∑–Ω—ã—Ö —Å–ª—É—á–∞—è—Ö. –ú—ã —É–∂–µ —Ä–∞—Å—Å–º–æ—Ç—Ä–µ–ª–∏ `with_items` –∏ `with_fileglob`, –Ω–æ –∏—Ö –≥–æ—Ä–∞–∑–¥–æ –±–æ–ª—å—à–µ.

#### –û—Å–Ω–æ–≤–Ω—ã–µ `with_*` –∫–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏

–î–∏—Ä–µ–∫—Ç–∏–≤–∞ | –ß—Ç–æ –¥–µ–ª–∞–µ—Ç | –ü—Ä–∏–º–µ—Ä –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è
--- | --- | ---
`with_items` | –ü–µ—Ä–µ–±–æ—Ä –ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω–æ–≥–æ —Å–ø–∏—Å–∫–∞ | –ü—Ä–æ–π—Ç–∏ –ø–æ —Å–ø–∏—Å–∫—É –∏–º—ë–Ω –∏–ª–∏ —á–∏—Å–µ–ª
`with_fileglob` | –ü–µ—Ä–µ–±–æ—Ä —Ñ–∞–π–ª–æ–≤ –ø–æ –º–∞—Å–∫–µ (–≥–ª–æ–±) –Ω–∞ **–∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–µ** | –ù–∞–π—Ç–∏ –≤—Å–µ `.conf` —Ñ–∞–π–ª—ã –≤ –ø–∞–ø–∫–µ
`with_file` | –ü–µ—Ä–µ–±–æ—Ä —Ñ–∞–π–ª–æ–≤, –Ω–æ –Ω–µ –∏–º–µ–Ω, –∞ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –∫–∞–∂–¥–æ–≥–æ —Ñ–∞–π–ª–∞ —á–∏—Ç–∞–µ—Ç—Å—è –∏ –ø–µ—Ä–µ–¥–∞—ë—Ç—Å—è –∫–∞–∫ –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è | –ß—Ç–µ–Ω–∏–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ —Ñ–∞–π–ª–æ–≤ –≤ —Ü–∏–∫–ª–µ
`with_sequence` | –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —á–∏—Å–ª–æ–≤–æ–π –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ | –°–æ–∑–¥–∞—Ç—å —Å–ø–∏—Å–æ–∫ —á–∏—Å–µ–ª –æ—Ç 1 –¥–æ 10
`with_dict` | –ü–µ—Ä–µ–±–æ—Ä —Å–ª–æ–≤–∞—Ä—è | –ü—Ä–æ–π—Ç–∏ –ø–æ –∫–ª—é—á–∞–º –∏ –∑–Ω–∞—á–µ–Ω–∏—è–º —Å–ª–æ–≤–∞—Ä—è `item.key + item.value`
`with_together` | –û–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π –ø–µ—Ä–µ–±–æ—Ä **–¥–≤—É—Ö —Å–ø–∏—Å–∫–æ–≤** –ø–æ –∏–Ω–¥–µ–∫—Å–∞–º | –°–æ–ø–æ—Å—Ç–∞–≤–∏—Ç—å –∏–º–µ–Ω–∞ –∏ IP-–∞–¥—Ä–µ—Å–∞ –ø–æ –∏–Ω–¥–µ–∫—Å–∞–º `name[i] + ip[i]`
`with_nested` | –ü–µ—Ä–µ–±–æ—Ä –≤—Å–µ—Ö –∫–æ–º–±–∏–Ω–∞—Ü–∏–π –∏–∑ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Å–ø–∏—Å–∫–æ–≤ | –î–µ–∫–∞—Ä—Ç–æ–≤–æ –ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ. –ï—Å–ª–∏ –≤ –æ–¥–Ω–æ–º —Å–ø–∏—Å–∫–µ —Ü–≤–µ—Ç–∞ [–∫—Ä–∞—Å–Ω—ã–π, —Å–∏–Ω–∏–π], –∞ –≤ –¥—Ä—É–≥–æ–º —Ä–∞–∑–º–µ—Ä—ã [S,M], –ø–µ—Ä–µ–±–µ—Ä–µ—Ç –≤—Å–µ –∏—Ö –≤–æ–∑–º–æ–∂–Ω—ã–µ –∫–æ–º–±–∏–Ω–∞—Ü–∏–∏ - –∫—Ä–∞—Å–Ω—ã–π S, –∫—Ä–∞—Å–Ω—ã–π M, —Å–∏–Ω–∏–π S, —Å–∏–Ω–∏–π M –∏ —Ç.–¥.  
`with_subelements` | –î–ª—è –≤–ª–æ–∂–µ–Ω–Ω—ã—Ö —Å—Ç—Ä—É–∫—Ç—É—Ä (—Å–ø–∏—Å–∫–∏ –≤ –æ–±—ä–µ–∫—Ç–∞—Ö) | –ü–µ—Ä–µ–±—Ä–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏ –∏—Ö –∞–¥—Ä–µ—Å–∞
`with_lines` | –ü–µ—Ä–µ–±–æ—Ä —Å—Ç—Ä–æ–∫ –∏–∑ –≤—ã–≤–æ–¥–∞ –∫–æ–º–∞–Ω–¥—ã –∏–ª–∏ —Ñ–∞–π–ª–∞ | –ü–µ—Ä–µ–±—Ä–∞—Ç—å —Å—Ç—Ä–æ–∫–∏ –≤—ã–≤–æ–¥–∞ `ls`
`with_random_choice` | –í—ã–±–æ—Ä –æ–¥–Ω–æ–≥–æ —Å–ª—É—á–∞–π–Ω–æ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞ –∏–∑ —Å–ø–∏—Å–∫–∞ | –í—ã–±—Ä–∞—Ç—å —Å–ª—É—á–∞–π–Ω–æ–µ –∏–º—è –∏–∑ —Å–ø–∏—Å–∫–∞

–ù–µ –±—É–¥–µ–º –≤ —Ä–∞–º–∫–∞—Ö –≤–≤–æ–¥–Ω–æ–≥–æ –∫—É—Ä—Å–∞ –ø–æ–¥—Ä–æ–±–Ω–æ –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å—Å—è –Ω–∞ –ø—Ä–∏–º–µ—Ä–∞—Ö –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∫–∞–∂–¥–æ–π –∫–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏, –∏—Ö –º–æ–∂–Ω–æ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –≤ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏.

> –í–∞–∂–Ω–æ –∑–Ω–∞—Ç—å, —á—Ç–æ `with_*` - –Ω–∞—á–∏–Ω–∞—è —Å Ansible 2.5 —ç—Ç–æ —É—Å—Ç–∞—Ä–µ–≤—à–∏–π —Å—Ç–∏–ª—å, –∏ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∞–Ω—Å–∏–±–ª —Ä–µ–∫–æ–º–µ–Ω–¥—É—é—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `loop` + `lookup()` –≤–º–µ—Å—Ç–æ `with_*`. –ù–æ `with_*` –≤—Å—ë –µ—â—ë —à–∏—Ä–æ–∫–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∏ –≤–∞–∂–Ω–æ –∑–Ω–∞—Ç—å —ç—Ç–æ—Ç —Å–∏–Ω—Ç–∞–∫—Å–∏—Å.

#### Lookup

`lookup` ‚Äî —Ñ—É–Ω–∫—Ü–∏—è Ansible –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –∏–∑ –≤–Ω–µ—à–Ω–∏—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ –Ω–∞ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–µ (–ª–æ–∫–∞–ª—å–Ω–æ), –¥–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–¥–∞—á–∏.

`lookup` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç **–ø–ª–∞–≥–∏–Ω—ã**, –∫–æ—Ç–æ—Ä—ã–µ –æ–ø—Ä–µ–¥–µ–ª—è—é—Ç –≤–Ω–µ—à–Ω–∏–π –∏—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö. –ù–∞–ø—Ä–∏–º–µ—Ä —Å –ø–æ–º–æ—â—å—é –ø–ª–∞–≥–∏–Ω–∞ `pipe` –º–æ–∂–Ω–æ –≤—ã–ø–æ–ª–Ω–∏—Ç—å –∫–æ–º–∞–Ω–¥—É –Ω–∞ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–µ: `lookup('pipe', 'date +%Y')` - –≤—ã–≤–µ–¥–µ—Ç —Ç–µ–∫—É—â–∏–π –≥–æ–¥ —Å –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞.

–ò—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö | –ü—Ä–∏–º–µ—Ä lookup
--- | ---
—Ñ–∞–π–ª | `lookup('file', 'path/to/file.txt')`
—Å–ø–∏—Å–æ–∫ —Ñ–∞–π–ª–æ–≤ | `lookup('fileglob', '*.conf', wantlist=True)`
–≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∫–æ–º–∞–Ω–¥—ã | `lookup('pipe', 'whoami')`
–ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è –ø–æ –∏–º–µ–Ω–∏ | `lookup('vars', 'var_name')`
—Å–ª—É—á–∞–π–Ω—ã–π —ç–ª–µ–º–µ–Ω—Ç | `lookup('random_choice', ['a', 'b', 'c'])`

#### –≠–∫–≤–∏–≤–∞–ª–µ–Ω—Ç—ã `with_*` -> `loop + lookup`

with_* | –≠–∫–≤–∏–≤–∞–ª–µ–Ω—Ç loop
--- | ---
`with_items: [...]` | `loop: [...]`
`with_fileglob: '*.conf'` | `loop: "{{ lookup('fileglob', '*.conf', wantlist=True) }}"`
`with_file: [...]` | `loop: "{{ lookup('file', [...], wantlist=True) }}"`
`with_sequence: start=1 end=5` | `loop: "{{ range(1, 6) }}"`
`with_dict: {a: 1, b: 2}` | `loop: "{{ dict2items(my_dict) }}"`
`with_together: [list1, list2]` | `loop: "{{ zip(list1, list2) }}"`
`with_nested: [[1, 2], ['a', 'b']]` | `loop: "{{ product([ [1, 2], ['a', 'b'] ]) }}"`
`with_subelements` | `loop: "{{ lookup('subelements', ...) }}"`
`with_lines: some command` | `loop: "{{ lookup('pipe', 'some command') \| splitlines }}"`
`with_random_choice: [...]` | `loop: "{{ [ lookup('random_choice', [...]) ] }}"`

## –®–∞–≥ 8. –®–∞–±–ª–æ–Ω–∏–∑–∞—Ç–æ—Ä Jinja2 –∏ –º–æ–¥—É–ª—å template –≤ Ansible

### –®–∞–±–ª–æ–Ω–∏–∑–∞—Ç–æ—Ä *Jinja2*

*Jinja2* ‚Äî —ç—Ç–æ —à–∞–±–ª–æ–Ω–∏–∑–∞—Ç–æ—Ä, –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–π –≤ Ansible –¥–ª—è –≤–Ω–µ–¥—Ä–µ–Ω–∏—è –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö, —É—Å–ª–æ–≤–∏–π –∏ —Ü–∏–∫–ª–æ–≤ –≤ —à–∞–±–ª–æ–Ω—ã, –ø—Ä–∏–º–µ–Ω—è–µ–º—ã–µ –≤ YAML –∏–ª–∏ –¥—Ä—É–≥–∏—Ö —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö —Ñ–∞–π–ª–∞—Ö. –û–Ω –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è:

- –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö:
  - `{{ variable_name }}`
- –ü—Ä–∏–º–µ–Ω–µ–Ω–∏—è —Ñ–∏–ª—å—Ç—Ä–æ–≤:
  - `{{ list | length }}` ‚Äî –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –¥–ª–∏–Ω—É —Å–ø–∏—Å–∫–∞ `list`
  - `{{ name | upper }}` ‚Äî –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å—Ç—Ä–æ–∫—É `name` –≤ –≤–µ—Ä—Ö–Ω–µ–º —Ä–µ–≥–∏—Å—Ç—Ä–µ
- –£—Å–ª–æ–≤–Ω—ã—Ö –∫–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏–π:
  - `{% if var == "value" %}` ... `{% endif %}` ‚Äî –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –±–ª–æ–∫, –µ—Å–ª–∏ —É—Å–ª–æ–≤–∏–µ –∏—Å—Ç–∏–Ω–Ω–æ
- –¶–∏–∫–ª–æ–≤:
  - `{% for item in list %}` ... `{% endfor %}` ‚Äî –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –±–ª–æ–∫ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞ –≤ —Å–ø–∏—Å–∫–µ
- –¢–µ—Å—Ç–æ–≤:
  - `{{ var is defined }}` ‚Äî –ø—Ä–æ–≤–µ—Ä—è–µ—Ç, —á—Ç–æ –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è `var` —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
  - `{{ var is not none }}` ‚Äî –ø—Ä–æ–≤–µ—Ä—è–µ—Ç, —á—Ç–æ –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è `var` –Ω–µ –ø—É—Å—Ç–∞

Jinja2-–≤—ã—Ä–∞–∂–µ–Ω–∏—è –ø–∏—à—É—Ç—Å—è –≤–Ω—É—Ç—Ä–∏ `{{ ... }}` (–¥–ª—è –≤—ã–≤–æ–¥–∞ –∑–Ω–∞—á–µ–Ω–∏—è) –∏–ª–∏ `{% ... %}` (–¥–ª—è —É–ø—Ä–∞–≤–ª—è—é—â–∏—Ö –∫–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏–π).

#### –û–ø–µ—Ä–∞—Ç–æ—Ä—ã Jinja2

–°–ø–∏—Å–æ–∫ –Ω–∞–∏–±–æ–ª–µ–µ —á–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–≤

–¢–∏–ø | –û–ø–µ—Ä–∞—Ç–æ—Ä | –ü—Ä–∏–º–µ—Ä | –ó–Ω–∞—á–µ–Ω–∏–µ
--- | --- | --- | ---
–ê—Ä–∏—Ñ–º–µ—Ç–∏–∫–∞ | `+` `-` `*` `/` `//` `%` | `5 + 2`, `10 // 3` | –°–ª–æ–∂–µ–Ω–∏–µ, –¥–µ–ª–µ–Ω–∏–µ –∏ —Ç.–¥.
–°—Ä–∞–≤–Ω–µ–Ω–∏–µ | `==` `!=` `<` `>` `<=` `>=` | `x == 10`, `a != b` | –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –∑–Ω–∞—á–µ–Ω–∏–π
–õ–æ–≥–∏–∫–∞ | `and` `or` `not` | `a and b`, `not x` | –ë—É–ª–µ–≤–∞ –ª–æ–≥–∏–∫–∞
–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∏–ø–∞ | `is` `is not` | `x is none`, `y is string` | –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –ø–æ —Ç–∏–ø—É/–∑–Ω–∞—á–µ–Ω–∏—é
–í—Ö–æ–∂–¥–µ–Ω–∏–µ | `in` `not in` | `'a' in list`, `'b' not in str` | –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è
–§–∏–ª—å—Ç—Ä—ã | `\|` | `value \| default('N/A')` | –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ —Ñ–∏–ª—å—Ç—Ä
–¢–µ—Ä–Ω–∞—Ä–Ω—ã–π | `condition \| ternary(a, b)` | `x > 5 \| ternary('yes', 'no')` | –£—Å–ª–æ–≤–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
–û–ø–µ—Ä–∞—Ç–æ—Ä `if` | –≤–Ω—É—Ç—Ä–∏ —à–∞–±–ª–æ–Ω–æ–≤ | `{% if x %} ok {% endif %}` | –£—Å–ª–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞
–û–ø–µ—Ä–∞—Ç–æ—Ä `~` | –ö–æ–Ω–∫–∞—Ç–µ–Ω–∞—Ü–∏—è —Å—Ç—Ä–æ–∫ | `'user-' ~ id` | –°–∫–ª–µ–∏–≤–∞–Ω–∏–µ —Å—Ç—Ä–æ–∫
–î–æ—Å—Ç—É–ø –∫ –ø–æ–ª—è–º | `.` –∏ `[]` | `item.name`, `item['name']` | –î–æ—Å—Ç—É–ø –∫ –∑–Ω–∞—á–µ–Ω–∏—é –ø–æ –∫–ª—é—á—É

#### –§–∏–ª—å—Ç—Ä—ã Jinja2

–°–ø–∏—Å–æ–∫ –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö Jinja2-—Ñ–∏–ª—å—Ç—Ä–æ–≤ —Å –∫—Ä–∞—Ç–∫–∏–º–∏ –ø—Ä–∏–º–µ—Ä–∞–º–∏:

–§–∏–ª—å—Ç—Ä | –û–ø–∏—Å–∞–Ω–∏–µ –∏ –ø—Ä–∏–º–µ—Ä
--- | ---
`length` | –ö–æ–ª-–≤–æ —ç–ª–µ–º–µ–Ω—Ç–æ–≤. `['a', 'b'] \| length` -> `2`
`upper` | –í –≤–µ—Ä—Ö–Ω–∏–π —Ä–µ–≥–∏—Å—Ç—Ä. `'abc' \| upper` -> `'ABC'`
`lower` | –í –Ω–∏–∂–Ω–∏–π —Ä–µ–≥–∏—Å—Ç—Ä. `'ABC' \| lower` -> `'abc'`
`replace('a','o')` | –ó–∞–º–µ–Ω–∞ —Å–∏–º–≤–æ–ª–æ–≤. `'data' \| replace('a','o')` -> `'doto'`
`default('x')` | –ó–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é. `none_var \| default('x')` -> `'x'`
`join(', ')` | –û–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞. `['a','b'] \| join(', ')` -> `'a, b'`
`split(',')` | –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ —Å—Ç—Ä–æ–∫–∏. `'a,b,c' \| split(',')` -> `['a','b','c']`
`sort` | –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞. `[3,1,2] \| sort` -> `[1,2,3]`
`unique` | –£–Ω–∏–∫–∞–ª—å–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã. `[1,2,2] \| unique` -> `[1,2]`
`reverse` | –û–±—Ä–∞—Ç–Ω—ã–π –ø–æ—Ä—è–¥–æ–∫. `[1,2,3] \| reverse` -> `[3,2,1]`
`int` | –í —Ü–µ–ª–æ–µ —á–∏—Å–ª–æ. `'42' \| int` -> `42`
`float` | –í –≤–µ—â–µ—Å—Ç–≤–µ–Ω–Ω–æ–µ —á–∏—Å–ª–æ. `'3.14' \| float` -> `3.14`
`trim` | –£–¥–∞–ª–µ–Ω–∏–µ –ø—Ä–æ–±–µ–ª–æ–≤. `'  abc  ' \| trim` -> `'abc'`
`capitalize` | –ü–µ—Ä–≤—ã–π —Å–∏–º–≤–æ–ª –∑–∞–≥–ª–∞–≤–Ω—ã–π, –æ—Å—Ç–∞–ª—å–Ω—ã–µ ‚Äî —Å—Ç—Ä–æ—á–Ω—ã–µ. `'HELLO' \| capitalize` -> `'Hello'`

–§–∏–ª—å—Ç—Ä—ã –º–æ–∂–Ω–æ –∫–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞—Ç—å:  
`' HELLO world ' | trim | lower | replace('world', 'there') | capitalize` -> `Hello there`

---

### –ú–æ–¥—É–ª—å `template`

–ú–æ–¥—É–ª—å `template` –≤ Ansible –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Ñ–∞–π–ª–æ–≤ –Ω–∞ –æ—Å–Ω–æ–≤–µ Jinja2-—à–∞–±–ª–æ–Ω–æ–≤ (–æ–±—ã—á–Ω–æ —Å —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ–º `.j2`). –û–Ω –±–µ—Ä—ë—Ç —à–∞–±–ª–æ–Ω–Ω—ã–π —Ñ–∞–π–ª, –ø–æ–¥—Å—Ç–∞–≤–ª—è–µ—Ç –∑–Ω–∞—á–µ–Ω–∏—è –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ —É–∫–∞–∑–∞–Ω–Ω—ã–π –ø—É—Ç—å –Ω–∞ —Ü–µ–ª–µ–≤–æ–π –º–∞—à–∏–Ω–µ.

**–ö–ª—é—á–µ–≤—ã–µ –º–æ–º–µ–Ω—Ç—ã:**

- –ò—Å—Ç–æ—á–Ω–∏–∫: `src` - –ø—É—Ç—å –∫ —à–∞–±–ª–æ–Ω—É.
- –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ: `dest` - –∫—É–¥–∞ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ñ–∞–π–ª.
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø–æ–¥—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –∏–∑ –æ–∫—Ä—É–∂–µ–Ω–∏—è –∏–ª–∏ playbook.
- –ú–æ–∂–Ω–æ –∑–∞–¥–∞–≤–∞—Ç—å –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ (`mode`), –≤–ª–∞–¥–µ–ª—å—Ü–∞ (`owner`) –∏ –≥—Ä—É–ø–ø—É (`group`).
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –∫–æ–Ω—Ñ–∏–≥–æ–≤, —Å–∫—Ä–∏–ø—Ç–æ–≤ –∏ –ª—é–±—ã—Ö —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö —Ñ–∞–π–ª–æ–≤ —Å –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–º —Å–æ–¥–µ—Ä–∂–∏–º

–ü—Ä–æ—Å—Ç–æ–π –ø—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:

```yaml
- name: Render config file
  template:
    src: config.j2
    dest: /etc/myapp/config.conf
    mode: '0644'
```

–î–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏:

- –ö–æ–ø–∏—Ä—É–µ–º —Ñ–∞–π–ª—ã –∏–∑ `website_content2` –≤ `website_content3`
- –ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤—ã–≤–∞–µ–º `index.html` –≤ `index.j2`
- –î–æ–±–∞–≤–∏–º –ø–æ—Å–ª–µ —Å—Ç—Ä–æ–∫–∏ `<h1>Hello World</h1>` —Å–ª–µ–¥—É—é—â–∏–π —Ñ—Ä–∞–≥–º–µ–Ω—Ç:

```html
...
  <h1>Hello World</h1>
  <p>Server owner: {{ owner }}</p>
  <p>Server hostname: {{ ansible_hostname }}</p>
  <p>Server OS family: {{ ansible_os_family }}</p>
  <p>Server uptime: {{ (ansible_uptime_seconds // 3600) }} h {{ (ansible_uptime_seconds % 3600) // 60 }} min</p>
...
```

–í–æ –≤—Ä–µ–º—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –º–æ–¥—É–ª—å `template` –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–¥—Å—Ç–∞–≤–∏—Ç –∑–Ω–∞—á–µ–Ω–∏—è –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –≤ —à–∞–±–ª–æ–Ω.

–°–æ–∑–¥–∞–¥–∏–º –Ω–æ–≤—ã–π –ø–ª–µ–π–±—É–∫ ‚Äî `install_nginx_template.yml`, –≤ –∫–æ—Ç–æ—Ä–æ–º:

- –£—Å—Ç–∞–Ω–æ–≤–∏–º `nginx`
- –û–ø—Ä–µ–¥–µ–ª–∏–º –ø—É—Ç—å –∫ —à–∞–±–ª–æ–Ω—É –∏ —Å–æ–∑–¥–∞–¥–∏–º —Ñ–∞–π–ª `index.html` –∏–∑ `index.j2`
- –°–∫–æ–ø–∏—Ä—É–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
- –£–±–µ–¥–∏–º—Å—è, —á—Ç–æ `nginx` –∑–∞–ø—É—â–µ–Ω

```yaml
- name: Install Nginx with content uses template on RedHat-like and Debian-like systems
  hosts: all
  become: true

  vars:
    source_dir: "../website_content3" # –∫–∞—Ç–∞–ª–æ–≥ —Å —à–∞–±–ª–æ–Ω–æ–º –∏ —Ñ–∞–π–ª–∞–º–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
    dest_file_debian: "/var/www/html"
    dest_file_redhat: "/usr/share/nginx/html"

  tasks:
    - name: Ensure nginx is installed and index + files are in place
      block:
        - name: Install nginx # —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º nginx
          package:
            name: nginx
            state: present
            update_cache: yes

        - name: Set nginx web root path 
          set_fact:  
            nginx_web_root: "{{ (ansible_os_family == 'Debian') | ternary(dest_file_debian, dest_file_redhat) }}" 
            # –∑–∞–ø–∏—Å—ã–≤–∞–µ–º –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é nginx_web_root –ø—É—Ç—å –∫ –∫–∞—Ç–∞–ª–æ–≥—É —Å –¥–µ—Ñ–æ–ª—Ç–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ–π –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –∏—Å–ø–æ–ª—å–∑—É–µ–º–æ–≥–æ –¥–∏—Å—Ç—Ä–∏–±—É—Ç–∏–≤–∞
            # –µ—Å–ª–∏ Debian –∑–Ω–∞—á–∏—Ç –±–µ—Ä–µ–º –∑–∞–Ω—á–µ–Ω–∏—è –∏–∑ dest_file_debian, –∏–Ω–∞—á–µ –∏–∑ dest_file_redhat

        - name: Generate index.html
          template:
            src: "{{ source_file }}/index.j2" # –æ—Ç–∫—É–¥–∞ –±–µ—Ä–µ–º —à–∞–±–ª–æ–Ω, –≤ –Ω–∞—à–µ–º —Å–ª—É—á–∞–µ "../website_content3/index.j2"
            dest: "{{ nginx_web_root }}/index.html" # –∫—É–¥–∞ –∏ —Å –∫–∞–∫–∏–º –∏–º–µ–Ω–µ–Ω–º —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å —Ñ–∞–π–ª –ø–æ —à–∞–±–ª–æ–Ω—É
            mode: '0644'

        - name: Copy image files to nginx web root # –∫–æ–ø–∏—Ä—É–µ–º —Ñ–∞–π–ª—ã –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
          copy: 
            src: "{{ item }}"
            dest: "{{ nginx_web_root }}/"
            mode: '0644'
          loop: "{{ lookup('fileglob', '{{ source_file }}/image*.*', wantlist=True) }}"

        - name: Ensure nginx is running and enabled 
          service: name=nginx state=started enabled=yes

      when: ansible_os_family in ['Debian', 'RedHat']
```

–ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞:

```bash
ansible-playbook playbooks/install_nginx_template.yml
```

–í —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ –æ—Ç–∫—Ä–æ–µ—Ç—Å—è –Ω–æ–≤–∞—è HTML-—Å—Ç—Ä–∞–Ω–∏—Ü–∞ —Å–æ —Å–≤–µ–¥–µ–Ω–∏—è–º–∏ –æ —Å–µ—Ä–≤–µ—Ä–µ:

```txt
Hello World
Server owner: Alex from host_vars
Server hostname: c342ef95bc19
Server OS family: Debian
Server uptime: 12 h 20 min
```

## –®–∞–≥ 9. –†–æ–ª–∏ –∏ Ansible Galaxy

–û—Å–Ω–æ–≤–Ω–æ–π —Å—Ü–µ–Ω–∞—Ä–∏–π –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è Ansible ‚Äî –Ω–∞–ø–∏—Å–∞–Ω–∏–µ –ø–ª–µ–π–±—É–∫–∞, –∫–æ—Ç–æ—Ä—ã–π —Ä–µ—à–∞–µ—Ç –∫–∞–∫—É—é-—Ç–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—É—é –±–∏–∑–Ω–µ—Å-–∑–∞–¥–∞—á—É: —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ –∫–ª–∞—Å—Ç–µ—Ä–∞, –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–µ—Ä–≤–µ—Ä–æ–≤, –∏—Ö –¥–æ–Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –∏ —Ç.–¥. –ù–æ –ø—Ä–∏ –±–æ–ª—å—à–æ–º –æ–±—ä–µ–º–µ –∑–∞–¥–∞—á–∏ –∫–æ–¥ –≤ –ø–ª–µ–π–±—É–∫–µ –º–æ–∂–µ—Ç —Å–∏–ª—å–Ω–æ —Ä–∞–∑—Ä–∞—Å—Ç–∞—Ç—å—Å—è, –∞ —Å–∞–º–∏ –ø–ª–µ–π–±—É–∫–∏ —Å—Ç–∞–Ω–æ–≤—è—Ç—Å—è —Å–ª–æ–∂–Ω—ã–º–∏ –¥–ª—è –ø–æ–Ω–∏–º–∞–Ω–∏—è –∏ –ø–µ—Ä–µ–≥—Ä—É–∂–µ–Ω–Ω—ã–º–∏ –∫–æ–¥–æ–º. –ö —Ç–æ–º—É –∂–µ –æ–¥–Ω–∏ –∏ —Ç–µ –∂–µ —á–∞—Å—Ç–∏ –∫–æ–¥–∞ –º–æ–≥—É—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –≤ —Ä–∞–∑–Ω—ã—Ö –ø–ª–µ–π–±—É–∫–∞—Ö.  
–î–ª—è —Ä–µ—à–µ–Ω–∏—è —ç—Ç–æ–π –ø—Ä–æ–±–ª–µ–º—ã –≤ Ansible –ø—Ä–µ–¥—É—Å–º–æ—Ç—Ä–µ–Ω—ã *–†–æ–ª–∏*, –∫–æ—Ç–æ—Ä—ã–µ –¥–∞—é—Ç –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞—Ç—å –∫–æ–¥ Ansible –≤ –æ—Ç–¥–µ–ª—å–Ω—ã–π, –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∏ –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç.

### Ansible Galaxy

–í Ansible –ø—Ä–µ–¥—É—Å–º–æ—Ç—Ä–µ–Ω —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π —Ä–æ–ª–µ–π –∏ –∫–æ–ª–ª–µ–∫—Ü–∏–π ‚Äî *Galaxy*. –° –µ–≥–æ –ø–æ–º–æ—â—å—é –º–æ–∂–Ω–æ –∏—Å–∫–∞—Ç—å, —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å –∏ –ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å —Ä–æ–ª–∏ –∏ –∫–æ–ª–ª–µ–∫—Ü–∏–∏. Galaxy –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω –¥–ª—è –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —á—É–∂–∏—Ö —Ä–æ–ª–µ–π –∏ –∫–æ–ª–ª–µ–∫—Ü–∏–π, –∞ —Ç–∞–∫–∂–µ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã—Ö, —Å–æ–≤–º–µ—Å—Ç–∏–º—ã—Ö —Å Galaxy.

–û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:

```sh
ansible-galaxy init <—Ä–æ–ª—å>                  # –°–æ–∑–¥–∞–Ω–∏–µ —à–∞–±–ª–æ–Ω–∞ —Ä–æ–ª–∏
ansible-galaxy install <–∏–º—è>                # –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ä–æ–ª–∏
ansible-galaxy collection install <–∏–º—è>     # –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∫–æ–ª–ª–µ–∫—Ü–∏–∏
ansible-galaxy list                         # –°–ø–∏—Å–æ–∫ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã—Ö —Ä–æ–ª–µ–π
ansible-galaxy role remove <–∏–º—è>            # –£–¥–∞–ª–µ–Ω–∏–µ —Ä–æ–ª–∏
```

–†–æ–ª—å –≤ Ansible –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –ø—Ä–æ—Å—Ç–æ–π, –ø–æ–Ω—è—Ç–Ω–æ–π, —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–æ–π –∏ –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º–æ–π: –∏–º–µ—Ç—å —á—ë—Ç–∫—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É, –≤—Å—ë –¥–µ–ª–∞—Ç—å —á–µ—Ä–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ, –±–µ–∑ –∂—ë—Å—Ç–∫–∏—Ö –ø—Ä–∏–≤—è–∑–æ–∫ –∫ –æ–∫—Ä—É–∂–µ–Ω–∏—é, –±—ã—Ç—å *–∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ–π* (–ø–æ–≤—Ç–æ—Ä–Ω—ã–π –∑–∞–ø—É—Å–∫ —Ä–æ–ª–∏ –Ω–µ –¥–æ–ª–∂–µ–Ω –ø—Ä–∏–≤–æ–¥–∏—Ç—å –∫ –∏–∑–º–µ–Ω–µ–Ω–∏—é —Å–æ—Å—Ç–æ—è–Ω–∏—è, –µ—Å–ª–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–π –Ω–µ—Ç), —Å –∫—Ä–∞—Ç–∫–æ–π –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–µ–π, –æ–±—ä—è—Å–Ω—è—é—â–µ–π, —á—Ç–æ –æ–Ω–∞ –¥–µ–ª–∞–µ—Ç –∏ –∫–∞–∫ –µ—ë –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å.

### –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–π —Ä–æ–ª–∏

–ü–µ—Ä–µ–π–¥—ë–º –∫ –ø—Ä–∞–∫—Ç–∏–∫–µ. –°–Ω–∞—á–∞–ª–∞ —Å–æ–∑–¥–∞–¥–∏–º –∫–∞—Ç–∞–ª–æ–≥ –¥–ª—è —Ä–æ–ª–µ–π –∏ –ø–µ—Ä–µ–π–¥—ë–º –≤ –Ω–µ–≥–æ:

```sh
mkdir -p roles && cd roles
```

–í —É—á–µ–±–Ω—ã—Ö —Ü–µ–ª—è—Ö —Å–æ–∑–¥–∞–¥–∏–º —Ä–æ–ª—å, –Ω–∞ –æ—Å–Ω–æ–≤–∞–Ω–∏–∏ –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ –ø—Ä–∏–º–µ—Ä–∞, –∫–æ—Ç–æ—Ä–∞—è –±—É–¥–µ—Ç —Ä–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞—Ç—å nginx –∏ –∑–∞–º–µ–Ω—è—Ç—å –¥–µ—Ñ–æ–ª—Ç–Ω—É—é –≤–µ–±-—Å—Ç—Ä–∞–Ω–∏—Ü—É.

–í—ã–ø–æ–ª–Ω–∏–º –∫–æ–º–∞–Ω–¥—É:

```sh
ansible-galaxy init deploy_nginx_with_content
```

–≠—Ç–∞ –∫–æ–º–∞–Ω–¥–∞ —Å–æ–∑–¥–∞—Å—Ç –Ω–∞–º –ø—É—Å—Ç–æ–π —Å–∫–µ–ª–µ—Ç —Ä–æ–ª–∏ —Å –∏–º–µ–Ω–µ–º `deploy_nginx_with_content`:

```plaintext
roles # –ö–∞—Ç–∞–ª–æ–≥ —Å —Ä–æ–ª—è–º–∏
‚îî‚îÄ‚îÄ deploy_nginx_with_content  # –ö–∞—Ç–∞–ª–æ–≥ —Å —Ä–æ–ª—å—é
    ‚îú‚îÄ‚îÄ defaults
    ‚îÇ   ‚îî‚îÄ‚îÄ main.yml           # –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
    ‚îú‚îÄ‚îÄ files                  # –°—Ç–∞—Ç–∏—á–Ω—ã–µ —Ñ–∞–π–ª—ã –¥–ª—è –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–∞ —Ö–æ—Å—Ç—ã
    ‚îú‚îÄ‚îÄ handlers
    ‚îÇ   ‚îî‚îÄ‚îÄ main.yml           # –•–µ–Ω–¥–ª–µ—Ä—ã
    ‚îú‚îÄ‚îÄ meta
    ‚îÇ   ‚îî‚îÄ‚îÄ main.yml           # –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ —Ä–æ–ª–∏, –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏, –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –ø–ª–∞—Ç—Ñ–æ—Ä–º
    ‚îú‚îÄ‚îÄ README.md              # –û–ø–∏—Å–∞–Ω–∏–µ —Ä–æ–ª–∏, –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é
    ‚îú‚îÄ‚îÄ tasks
    ‚îÇ   ‚îî‚îÄ‚îÄ main.yml           # –û—Å–Ω–æ–≤–Ω—ã–µ —Ç–∞—Å–∫–∏ —Ä–æ–ª–∏ (–º–∏–Ω–∏–º–∞–ª—å–Ω–æ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π —Ñ–∞–π–ª)
    ‚îú‚îÄ‚îÄ templates              # –®–∞–±–ª–æ–Ω—ã —Ñ–∞–π–ª–æ–≤ —Å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏ (Jinja2)
    ‚îú‚îÄ‚îÄ tests                  # –¢–µ—Å—Ç–æ–≤—ã–µ –ø–ª–µ–π–±—É–∫–∏ –∏ –∏–Ω–≤–µ–Ω—Ç–æ—Ä–∏ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–æ–ª–∏
    ‚îÇ   ‚îú‚îÄ‚îÄ inventory
    ‚îÇ   ‚îî‚îÄ‚îÄ test.yml
    ‚îî‚îÄ‚îÄ vars
        ‚îî‚îÄ‚îÄ main.yml           # –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ —Å –≤—ã—Å–æ–∫–∏–º –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–º (–Ω–µ –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è—é—Ç—Å—è –∏–∑ –ø–ª–µ–π–±—É–∫–∞)
```

–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä —Å–æ–∑–¥–∞–ª –ø–æ–ª–Ω—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É —Ä–æ–ª–∏, —Å–æ–≤–º–µ—Å—Ç–∏–º—É—é —Å Galaxy (–≤ Ansible –¥–ª—è —Ç–æ–≥–æ, —á—Ç–æ–±—ã —Ä–æ–ª—å —Å—á–∏—Ç–∞–ª–∞—Å—å –≤–∞–ª–∏–¥–Ω–æ–π, –Ω–µ–æ–±—Ö–æ–¥—ã–π –º–∏–Ω–∏–º—É–º - –Ω–∞–ª–∏—á–∏–µ —Ñ–∞–π–ª–∞ `tasks/main.yml`).

–í –ø–µ—Ä–≤—É—é –æ—á–µ—Ä–µ–¥—å –¥–æ–±–∞–≤–∏–º –≤ —Ñ–∞–π–ª –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ `ansible.cfg` –ø—É—Ç—å –∫ –Ω–∞—à–µ–º—É –∫–∞—Ç–∞–ª–æ–≥—É —Å —Ä–æ–ª—è–º–∏:

```ini
[defaults]
host_key_checking   = false
inventory           = ./hosts
roles_path          = ./roles  # –î–æ–±–∞–≤–∏–º –ø—É—Ç—å –∫ –∫–∞—Ç–∞–ª–æ–≥—É —Å —Ä–æ–ª—è–º–∏
```

–ú—ã –¥–µ–ª–∞–µ–º —ç—Ç–æ, —á—Ç–æ–±—ã Ansible –º–æ–≥ –Ω–∞—Ö–æ–¥–∏—Ç—å –∫–∞—Ç–∞–ª–æ–≥ —Å —ç—Ç–æ–π —Ä–æ–ª—å—é. –ü–æ—Å–∫–æ–ª—å–∫—É –º—ã –∑–∞–ø—É—Å–∫–∞–µ–º –ø–ª–µ–π–±—É–∫ –∏–∑ –ø–æ–¥–∫–∞—Ç–∞–ª–æ–≥–∞ `playbooks`, –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é Ansible –±—É–¥–µ—Ç –∏—Å–∫–∞—Ç—å —Ä–æ–ª–∏ –≤ `playbooks/roles`. –í –Ω–∞—à–µ–º —Å–ª—É—á–∞–µ —Ä–æ–ª–∏ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ –∫–æ—Ä–Ω–µ–≤–æ–º –∫–∞—Ç–∞–ª–æ–≥–µ `roles`, —á—Ç–æ –∏ —É–∫–∞–∑–∞–Ω–æ –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏.

–î–∞–ª–µ–µ —Å–∫–æ–ø–∏—Ä—É–µ–º —Ñ–∞–π–ª—ã –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –∏–∑ –∫–∞—Ç–∞–ª–æ–≥–∞ `website_content2` –≤ –∫–∞—Ç–∞–ª–æ–≥ `roles/deploy_nginx_with_content/files/`. –ó–∞—Ç–µ–º —Å–∫–æ–ø–∏—Ä—É–µ–º —Ñ–∞–π–ª —à–∞–±–ª–æ–Ω–∞ –¥–µ—Ñ–æ–ª—Ç–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã `index.j2` –∏–∑ –∫–∞—Ç–∞–ª–æ–≥–∞ `website_content3` –≤ –∫–∞—Ç–∞–ª–æ–≥ `roles/deploy_nginx_with_content/templates/` –∏ –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º –µ–≥–æ, –¥–æ–±–∞–≤–∏–≤ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π:

```html
...
  <h1>Hello World</h1>

  <p>Server owner: {{ owner }}</p>
  <p>Server hostname: {{ ansible_hostname }}</p>
  <p>Server OS family: {{ ansible_os_family }}</p>
  <p>Server uptime: {{ (ansible_uptime_seconds // 3600) }} h {{ (ansible_uptime_seconds % 3600) // 60 }} min</p>

  <img width="300" src="image1.jpeg" alt="Example Image">
  <br />
  <img width="300" src="image2.png" alt="Example Image 2">
...
```

–ó–∞—Ç–µ–º –≤ `roles/deploy_nginx_with_content/vars/main.yml` –¥–æ–±–∞–≤–∏–º –¥–≤–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ —Å –ø—É—Ç—è–º–∏ –∫ –∫–∞—Ç–∞–ª–æ–≥—É —Å –¥–µ—Ñ–æ–ª—Ç–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ–π nginx –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –û–°:

```yaml
dest_file_debian: "/var/www/html"
dest_file_redhat: "/usr/share/nginx/html"
```

–ú—ã —Ä–∞–∑–º–µ—Å—Ç–∏–ª–∏ —ç—Ç–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –≤ –ø–∞–ø–∫–µ `vars`, –ø–æ—Å–∫–æ–ª—å–∫—É –∑–Ω–∞—á–µ–Ω–∏—è —ç—Ç–∏—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—Ç —Å–æ–∑–¥–∞—Ç–µ–ª–∏ –¥–∏—Å—Ç—Ä–∏–±—É—Ç–∏–≤–æ–≤ –∏ –æ–Ω–∏ –ø–æ —Å—É—Ç–∏ —è–≤–ª—è—é—Ç—Å—è –∫–æ–Ω—Å—Ç–∞–Ω—Ç–∞–º–∏, –∫–æ—Ç–æ—Ä—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –º–µ–Ω—è—Ç—å –Ω–µ –Ω—É–∂–Ω–æ. –ï—Å–ª–∏ –±—ã –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –±—ã–ª–∏ –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω—ã –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º, –∏—Ö —Å–ª–µ–¥–æ–≤–∞–ª–æ –±—ã –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –≤ `defaults/main.yml`.

–¢–µ–ø–µ—Ä—å –≤ `tasks/main.yml` –æ–ø—Ä–µ–¥–µ–ª–∏–º –∑–∞–¥–∞—á–∏, –∫–æ—Ç–æ—Ä—ã–µ –±—É–¥–µ—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å —Ä–æ–ª—å:

```yaml
- name: Ensure nginx is installed and index + files are in place
  block:
    - name: Install nginx
      package:
        name: nginx
        state: present
        update_cache: yes

    - name: Set nginx web root path
      set_fact:
        nginx_web_root: "{{ (ansible_os_family == 'Debian') | ternary(dest_file_debian, dest_file_redhat) }}"

    - name: Generate index.html
      template:
        src: index.j2
        dest: "{{ nginx_web_root }}/index.html"
        mode: '0644'

    - name: Copy files to nginx web root
      copy:
        src: "{{ item }}"
        dest: "{{ nginx_web_root }}/"
        mode: '0644'
      loop: "{{ lookup('fileglob', 'image*.*', wantlist=True) }}"

    - name: Ensure nginx is running and enabled
      service:
        name: nginx
        state: started
        enabled: yes

  when: ansible_os_family in ['Debian', 'RedHat']
```

–û–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ, —á—Ç–æ –ø—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ —Ä–æ–ª–µ–π –Ω–∞–º –Ω–µ –Ω—É–∂–Ω–æ —É–∫–∞–∑—ã–≤–∞—Ç—å –ø–æ–ª–Ω—ã–µ –ø—É—Ç–∏ –∫ –∫–∞—Ç–∞–ª–æ–≥–∞–º —Å —à–∞–±–ª–æ–Ω–∞–º–∏ –∏–ª–∏ —Ñ–∞–π–ª–∞–º–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π. –ó–¥–µ—Å—å –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —É–∫–∞–∑–∞—Ç—å –∏–º—è —Ñ–∞–π–ª–∞ —à–∞–±–ª–æ–Ω–∞ `src: index.j2`, –∏ Ansible –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –±—É–¥–µ—Ç –∏—Å–∫–∞—Ç—å –µ–≥–æ –≤ –∫–∞—Ç–∞–ª–æ–≥–µ `templates` —Ä–æ–ª–∏. –ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ, –ø—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏

```yaml
loop: "{{ lookup('fileglob', 'image*.*', wantlist=True) }}"
```

–ø–æ–∏—Å–∫ —Ñ–∞–π–ª–æ–≤ —Å –∏–º–µ–Ω–∞–º–∏, –Ω–∞—á–∏–Ω–∞—é—â–∏–º–∏—Å—è —Å `image`, –±—É–¥–µ—Ç –æ—Å—É—â–µ—Å—Ç–≤–ª—è—Ç—å—Å—è –≤ –∫–∞—Ç–∞–ª–æ–≥–µ `files` —Ä–æ–ª–∏.

–†–æ–ª—å —Å–æ–∑–¥–∞–Ω–∞, —Ç–µ–ø–µ—Ä—å –µ—ë –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å.

–ü–æ—Å–ª–µ–¥–Ω–∏–º —à–∞–≥–æ–º —Å–æ–∑–¥–∞–¥–∏–º –Ω–æ–≤—ã–π –ø–ª–µ–π–±—É–∫ `install_nginx_role.yml`, –≤ –∫–æ—Ç–æ—Ä–æ–º –≤—ã–∑–æ–≤–µ–º —Ä–æ–ª—å, –æ–≥—Ä–∞–Ω–∏—á–∏–≤ –µ—ë –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º–∞–º–∏ –Ω–∞ –±–∞–∑–µ Linux:

```yaml
---
- name: Install Nginx using a Role on RedHat- and Debian-based Systems
  hosts: all
  become: true

  roles:
    - role: deploy_nginx_with_content
      when: ansible_system == 'Linux'
```

–ó–∞–ø—É—Å–∫–∞–µ–º –ø–ª–µ–π–±—É–∫ –∏ —É–±–µ–∂–¥–∞–µ–º—Å—è, —á—Ç–æ –≤—Å—ë —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ.

### –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ä–æ–ª–∏ —Å GitHub

–¢–µ–ø–µ—Ä—å —É—Å—Ç–∞–Ω–æ–≤–∏–º –∏ –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ä–æ–ª—å —Å GitHub. –†–∞—Å—Å–º–æ—Ç—Ä–∏–º —Ä–æ–ª—å `robertdebock.users`, –¥–æ—Å—Ç—É–ø–Ω—É—é —Å —Ñ–æ—Ä–∫–∞ –ø–æ –∞–¥—Ä–µ—Å—É <https://github.com/pprometey/ansible-role-users>. –° –µ—ë –ø–æ–º–æ—â—å—é –º—ã —Å–æ–∑–¥–∞–¥–∏–º –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–∞ –∫–∞–∂–¥–æ–π —É–ø—Ä–∞–≤–ª—è–µ–º–æ–π –º–∞—à–∏–Ω–µ (–≤ –Ω–∞—à–µ–º —Å–ª—É—á–∞–µ –≤ –¥–æ–∫–µ—Ä-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ).

–£—Å—Ç–∞–Ω–æ–≤–∏–º —Ä–æ–ª—å, –≤—ã–ø–æ–ª–Ω–∏–≤ –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞ –Ω–∞ —É–ø—Ä–∞–≤–ª—è—é—â–µ–π –º–∞—à–∏–Ω–µ:

```sh
ansible-galaxy install git+https://github.com/pprometey/ansible-role-users,master --roles-path ./roles
```

- `--roles-path ./roles` ‚Äî —Ä–æ–ª—å –±—É–¥–µ—Ç —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ –≤ –∫–∞—Ç–∞–ª–æ–≥ `./roles/`.
  –ò–º—è —Ä–æ–ª–∏ –±—É–¥–µ—Ç —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–æ–≤–∞—Ç—å –Ω–∞–∑–≤–∞–Ω–∏—é git-—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è. –ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –ø–æ—è–≤–∏—Ç—Å—è –Ω–æ–≤–∞—è —Ä–æ–ª—å:

```plaintext
.
‚îî‚îÄ‚îÄ roles/
    ‚îî‚îÄ‚îÄ ansible-role-users/
```

–°–æ–∑–¥–∞–¥–∏–º –Ω–æ–≤—ã–π –ø–ª–µ–π–±—É–∫ `playbooks/role_add_user.yml`, –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —ç—Ç—É —Ä–æ–ª—å –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:

```yaml
- name: Adding a user via a role
  hosts: all
  become: true

  vars:
    sudo_group: "{{ 'wheel' if ansible_os_family == 'RedHat' else 'sudo' }}"
    # –í —Å–∏—Å—Ç–µ–º–∞—Ö RedHat –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å sudo –ø—Ä–∞–≤–∞–º–∏ –¥–æ–ª–∂–µ–Ω –≤—Ö–æ–¥–∏—Ç—å –≤ –≥—Ä—É–ø–ø—É "wheel",
    # –∞ –≤ Debian ‚Äî –≤ –≥—Ä—É–ø–ø—É "sudo"
    users:
      - name: testuser
        groups:
          - "{{ sudo_group }}"
        shell: /bin/bash
        create_home: true
        authorized_keys:
          - "{{ lookup('file', '~/.ssh/id_rsa.pub') }}"
        state: present

  roles:
    - ansible-role-users
```

–ü–æ–¥—Ä–æ–±–Ω–µ–µ –æ–± –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ —Ä–æ–ª–∏ `robertdebock.users` –º–æ–∂–Ω–æ –ø—Ä–æ—á–∏—Ç–∞—Ç—å –≤ `roles/ansible-role-users/README.md`.

–ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –ø–ª–µ–π–±—É–∫–∞ –ø—Ä–æ–≤–µ—Ä–∏–º —É—Å–ø–µ—à–Ω–æ—Å—Ç—å, –ø–æ–¥–∫–ª—é—á–∏–≤—à–∏—Å—å –ø–æ ssh –∫ —É–ø—Ä–∞–≤–ª—è–µ–º–æ–π –º–∞—à–∏–Ω–µ –ø–æ–¥ –Ω–æ–≤—ã–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º:

```sh
(.venv) developer@1985aaebee00:~/ansible-learning-template$ ssh testuser@minion1
...
testuser@66733d05fda0:~$ exit
logout
Connection to minion1 closed.
```

–í–∏–¥–∏–º, —á—Ç–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –ø–æ ssh –ø—Ä–æ—à–ª–æ —É—Å–ø–µ—à–Ω–æ, –∏ –º—ã —Ä–∞–±–æ—Ç–∞–µ–º –ø–æ–¥ –Ω–æ–≤—ã–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º –Ω–∞ —É–ø—Ä–∞–≤–ª—è–µ–º–æ–π –º–∞—à–∏–Ω–µ.

### –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ä–æ–ª–∏ —Å Ansible Galaxy

–≠—Ç—É –∂–µ —Ä–æ–ª—å –º–æ–∂–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∏–∑ [—Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–≥–æ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è —Ä–æ–ª–µ–π Ansible Galaxy](https://galaxy.ansible.com/ui/standalone/roles/), –≤—ã–ø–æ–ª–Ω–∏–≤ –∫–æ–º–∞–Ω–¥—É:

```sh
ansible-galaxy role install robertdebock.users --roles-path ./roles
```

–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ä–æ–ª–∏ –Ω–µ –æ—Ç–ª–∏—á–∞–µ—Ç—Å—è –æ—Ç –≤–∞—Ä–∏–∞–Ω—Ç–∞ —Å GitHub, –∑–∞ –∏—Å–∫–ª—é—á–µ–Ω–∏–µ–º —Ç–æ–≥–æ, —á—Ç–æ –≤ —ç—Ç–æ–º —Å–ª—É—á–∞–µ –º—ã –∏—Å–ø–æ–ª—å–∑—É–µ–º –∏–º—è —Ä–æ–ª–∏, —É–∫–∞–∑–∞–Ω–Ω–æ–µ –≤ `meta/main.yml` —Ä–æ–ª–∏.

---

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ requirements.yml

`requirements.yml` –≤ Ansible ‚Äî —ç—Ç–æ —Ñ–∞–π–ª, –≤ –∫–æ—Ç–æ—Ä–æ–º –ø–µ—Ä–µ—á–∏—Å–ª–µ–Ω—ã –≤–Ω–µ—à–Ω–∏–µ —Ä–æ–ª–∏ –∏–ª–∏ –∫–æ–ª–ª–µ–∫—Ü–∏–∏, –∫–æ—Ç–æ—Ä—ã–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø–µ—Ä–µ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ–º –ø–ª–µ–π–±—É–∫–∞, –æ—Ç –∫–æ—Ç–æ—Ä—ã—Ö –æ–Ω –∑–∞–≤–∏—Å–∏—Ç. –≠—Ç–æ —É–¥–æ–±–Ω–æ, –∫–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–æ–ª–µ–π, —á—Ç–æ–±—ã –Ω–µ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å –∏—Ö –ø–æ –æ—Ç–¥–µ–ª—å–Ω–æ—Å—Ç–∏, –∞ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –æ–¥–Ω–æ–π –∫–æ–º–∞–Ω–¥–æ–π.

–í –Ω–∞—à–µ–º —Å–ª—É—á–∞–µ –±—É–¥–µ–º —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å —Ç—É –∂–µ —Ä–æ–ª—å `robertdebock.users`, –Ω–æ —á–µ—Ä–µ–∑ —Ñ–∞–π–ª `requirements.yml`. –°–æ–∑–¥–∞–¥–∏–º –µ–≥–æ –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞ –∏ —É–∫–∞–∂–µ–º —Ä–æ–ª—å, –∫–æ—Ç–æ—Ä—É—é —Å–æ–±–∏—Ä–∞–µ–º—Å—è —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å:

```yaml
roles:
  - name: robertdebock.users_requirements
    src: robertdebock.users
    version: 6.1.5
```

–í —Ñ–∞–π–ª–µ `requirements.yml` –≤ –ø–æ–ª–µ `name:` –º–æ–∂–Ω–æ —É–∫–∞–∑–∞—Ç—å –ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω–æ–µ –ª–æ–∫–∞–ª—å–Ω–æ–µ –∏–º—è —Ä–æ–ª–∏ ‚Äî –≤ –Ω–∞—à–µ–º —Å–ª—É—á–∞–µ –º—ã –µ—ë –Ω–∞–∑–≤–∞–ª–∏ `robertdebock.users_requirements`, –∞ –≤ `src` —É–∫–∞–∑—ã–≤–∞–µ–º —É–Ω–∏–∫–∞–ª—å–Ω–æ–µ –∏–º—è —Ä–æ–ª–∏ –≤ Galaxy.

–£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å –ø–æ–º–æ—â—å—é `requirements.yml`:

```sh
ansible-galaxy role install -r requirements.yml --roles-path ./roles
```

–¢–∞–∫–∂–µ –º–æ–∂–Ω–æ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å —Ä–æ–ª–∏ —Å git-—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è, –∏—Å–ø–æ–ª—å–∑—É—è —Ñ–∞–π–ª `requirements.yml`:

```yaml
roles:
  - name: robertdebock.users_requirements_git  # –õ–æ–∫–∞–ª—å–Ω–æ–µ –∏–º—è —Ä–æ–ª–∏ (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ, –µ—Å–ª–∏ src ‚Äî —ç—Ç–æ URL)
    src: https://github.com/pprometey/ansible-role-users.git  # URL —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
    scm: git       # –£–∫–∞–∑—ã–≤–∞–µ—Ç, —á—Ç–æ –∏—Å—Ç–æ—á–Ω–∏–∫ ‚Äî Git-—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
    version: master  # –í–µ—Ç–∫–∞, —Ç–µ–≥ –∏–ª–∏ –∫–æ–º–º–∏—Ç
```

> [!tip]
> –í Ansible —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –º–Ω–æ–∂–µ—Å—Ç–≤–æ –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã—Ö –º–æ–¥—É–ª–µ–π –∏ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã—Ö —Ä–æ–ª–µ–π, –ø–æ–∫—Ä—ã–≤–∞—é—â–∏—Ö –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ –±–∞–∑–æ–≤—ã—Ö –∑–∞–¥–∞—á. –ü—Ä–µ–∂–¥–µ —á–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å—Ç–æ—Ä–æ–Ω–Ω—é—é —Ä–æ–ª—å –∏–ª–∏ –∫–æ–ª–ª–µ–∫—Ü–∏—é, –ø—Ä–æ–≤–µ—Ä—å—Ç–µ ‚Äî –≤–æ–∑–º–æ–∂–Ω–æ, –Ω–µ–æ–±—Ö–æ–¥–∏–º–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å —É–∂–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ —Å—Ä–µ–¥—Å—Ç–≤–∞–º–∏ Ansible. –ù–∞–ø—Ä–∏–º–µ—Ä, –≤–º–µ—Å—Ç–æ —Ä–æ–ª–∏ `robertdebock.users`, –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω–Ω–æ–π –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –º–Ω–æ–∂–µ—Å—Ç–≤–æ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, –≤ –ø—Ä–æ—Å—Ç—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏—è—Ö ‚Äî —Ç–∞–∫–∏—Ö –∫–∞–∫ –ø—Ä–∏–µ–¥–µ–Ω–Ω—ã–π –≤—ã—à–µ –ø—Ä–∏–º–µ—Ä ‚Äî –ø—Ä–µ–¥–ø–æ—á—Ç–∏—Ç–µ–ª—å–Ω–µ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π –º–æ–¥—É–ª—å `ansible.builtin.user`. –û–Ω –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –ø–æ–ª–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å –Ω–∞–¥ –æ—Ç–¥–µ–ª—å–Ω—ã–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º –∏ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞–º–∏ Ansible.

## –®–∞–≥ 10. –î–∏—Ä–µ–∫—Ç–∏–≤—ã `import_*` –∏ `include_*`

–í –¥–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –∫ –º–µ—Ö–∞–Ω–∏–∑–º—É **roles**, Ansible –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –¥–∏—Ä–µ–∫—Ç–∏–≤—ã `import_*` –∏ `include_*` –¥–ª—è –±–æ–ª–µ–µ –≥–∏–±–∫–æ–π –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ –∫–æ–¥–∞. –û–Ω–∏ –ø–æ–∑–≤–æ–ª—è—é—Ç –ø–æ–¥–∫–ª—é—á–∞—Ç—å –≤–Ω–µ—à–Ω–∏–µ –∑–∞–¥–∞—á–∏, –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∏ —Ä–æ–ª–∏ –ø—Ä—è–º–æ –≤–Ω—É—Ç—Ä–∏ –±–ª–æ–∫–æ–≤ **tasks**, –∫–∞–∫ –≤ –æ—Å–Ω–æ–≤–Ω–æ–º playbook, —Ç–∞–∫ –∏ –≤–Ω—É—Ç—Ä–∏ —Ä–æ–ª–µ–π.

–ù–∞–∑–≤–∞–Ω–∏–µ | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ
--- | ---
`import_tasks` | –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏ –∏–º–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç —Ñ–∞–π–ª —Å –∑–∞–¥–∞—á–∞–º–∏
`include_tasks` | –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –≤–∫–ª—é—á–∞–µ—Ç —Ñ–∞–π–ª —Å –∑–∞–¥–∞—á–∞–º–∏
`include_vars` | –ó–∞–≥—Ä—É–∂–∞–µ—Ç –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∏–∑ —Ñ–∞–π–ª–∞ –∏–ª–∏ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
`import_role` | –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏ –∏–º–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç —Ä–æ–ª—å
`include_role` | –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –≤–∫–ª—é—á–∞–µ—Ç —Ä–æ–ª—å

–†–∞–∑–Ω–∏—Ü–∞ –º–µ–∂–¥—É –Ω–∏–º–∏ –∑–∞–∫–ª—é—á–∞–µ—Ç—Å—è –≤ –º–æ–º–µ–Ω—Ç–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:

- `import_*` (–Ω–∞–ø—Ä–∏–º–µ—Ä, `import_tasks`, `import_role`) ‚Äî —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ –¥–∏—Ä–µ–∫—Ç–∏–≤—ã, –∫–æ—Ç–æ—Ä—ã–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –Ω–∞ —ç—Ç–∞–ø–µ —Ä–∞–∑–±–æ—Ä–∞ –ø–ª–µ–π–±—É–∫–∞ (playbook parsing), –¥–æ –Ω–∞—á–∞–ª–∞ –µ–≥–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è. –ü—Ä–∏ —ç—Ç–æ–º –ª—é–±—ã–µ —É—Å–ª–æ–≤–∏—è `when` –∏–≥–Ω–æ—Ä–∏—Ä—É—é—Ç—Å—è –∏ –Ω–µ –≤–ª–∏—è—é—Ç –Ω–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –±–ª–æ–∫–∞.
- `include_*` (–Ω–∞–ø—Ä–∏–º–µ—Ä, `include_tasks`, `include_role`, `include_vars`) ‚Äî –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ –¥–∏—Ä–µ–∫—Ç–∏–≤—ã, –∫–æ—Ç–æ—Ä—ã–µ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –≤–æ –≤—Ä–µ–º—è –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è –ø–ª–µ–π–±—É–∫–∞ (runtime). –≠—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ —É—Å–ª–æ–≤–∏–µ `when` –º–æ–∂–µ—Ç –æ—Ç–∫–ª—é—á–∏—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –≤—Å–µ–≥–æ –±–ª–æ–∫–∞, –µ—Å–ª–∏ —É—Å–ª–æ–≤–∏–µ –ª–æ–∂–Ω–æ.

–° –ø–æ–º–æ—â—å—é —ç—Ç–∏—Ö –¥–∏—Ä–µ–∫—Ç–∏–≤ –º–æ–∂–Ω–æ:

- –î–µ–ª–∏—Ç—å –∑–∞–¥–∞—á–∏ –Ω–∞ –ª–æ–≥–∏—á–µ—Å–∫–∏–µ –±–ª–æ–∫–∏ –∏ –≤—ã–Ω–æ—Å–∏—Ç—å –∏—Ö –≤ –æ—Ç–¥–µ–ª—å–Ω—ã–µ —Ñ–∞–π–ª—ã.
- –ó–∞–≥—Ä—É–∂–∞—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∏–ª–∏ –∏—Ö –Ω–∞–±–æ—Ä—ã –ø–æ —É—Å–ª–æ–≤–∏—è–º.
- –ü–æ–¥–∫–ª—é—á–∞—Ç—å —Ä–æ–ª–∏ —Ç–æ—á–µ—á–Ω–æ, —Å –ø–µ—Ä–µ–¥–∞—á–µ–π –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –∏ —É—Å–ª–æ–≤–∏–π.

–¢–∞–∫–æ–π –ø–æ–¥—Ö–æ–¥ –ø–æ–≤—ã—à–∞–µ—Ç —á–∏—Ç–∞–µ–º–æ—Å—Ç—å –∏ –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º–æ—Å—Ç—å –∫–æ–¥–∞ –±–µ–∑ –∏–∑–±—ã—Ç–æ—á–Ω–æ–π –≤–ª–æ–∂–µ–Ω–Ω–æ—Å—Ç–∏.

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è `import_*`:**

- Ansible –∑–∞—Ä–∞–Ω–µ–µ –∑–Ω–∞–µ—Ç –≤–µ—Å—å –Ω–∞–±–æ—Ä –∑–∞–¥–∞—á, —á—Ç–æ –≤–∞–∂–Ω–æ –¥–ª—è —Å—Ç–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞ (`ansible-lint`), —Ä–µ–∂–∏–º–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π (`--check`) –∏ —Ä–∞–±–æ—Ç—ã —Å —Ç–µ–≥–∞–º–∏ (`tags`).
- –û—à–∏–±–∫–∏, –Ω–∞–ø—Ä–∏–º–µ—Ä, –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —Ñ–∞–π–ª–∞ –ø—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ `import_tasks`, –±—É–¥—É—Ç –æ–±–Ω–∞—Ä—É–∂–µ–Ω—ã –Ω–∞ —ç—Ç–∞–ø–µ —Ä–∞–∑–±–æ—Ä–∞ –ø–ª–µ–π–±—É–∫–∞ –∏ –ø—Ä–µ—Ä–≤—É—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –¥–æ –Ω–∞—á–∞–ª–∞ –∑–∞–ø—É—Å–∫–∞.
- –í —Å–ª—É—á–∞–µ `include_tasks` –æ—à–∏–±–∫–∏ –±—É–¥—É—Ç –≤—ã—è–≤–ª–µ–Ω—ã —Ç–æ–ª—å–∫–æ –≤–æ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è, –∏ —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –¥–æ–π–¥–µ—Ç –¥–æ —ç—Ç–æ–π –∑–∞–¥–∞—á–∏.

**–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `include_*`:**

- –ö–æ–≥–¥–∞ –Ω—É–∂–Ω–æ –ø–æ–¥–∫–ª—é—á–∞—Ç—å –±–ª–æ–∫–∏ –ø–æ —É—Å–ª–æ–≤–∏—é `when`, –Ω–∞–ø—Ä–∏–º–µ—Ä, –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –∑–Ω–∞—á–µ–Ω–∏—è –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –∏–ª–∏ —Ñ–ª–∞–≥–∞.
- –ö–æ–≥–¥–∞ –ø—É—Ç—å –∫ —Ñ–∞–π–ª—É –∏–ª–∏ —Ä–æ–ª–∏ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π (–Ω–∞–ø—Ä–∏–º–µ—Ä, `"{{ var }}.yml"`), —Ç–∞–∫ –∫–∞–∫ `import_*` –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —à–∞–±–ª–æ–Ω—ã.
- –î–ª—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–π –∑–∞–≥—Ä—É–∑–∫–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö —Å –ø–æ–º–æ—â—å—é `include_vars`.

**–í—ã–≤–æ–¥:**  
`import_*` –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è **–∂–µ—Å—Ç–∫–æ —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä—ã** –∏ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞, –∞ `include_*` ‚Äî –¥–ª—è **–≥–∏–±–∫–æ—Å—Ç–∏ –∏ —É—Å–ª–æ–≤–∏–π –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è**.

–î–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è `import_tasks` –∏ `include_tasks` —Ä–∞—Å—Å–º–æ—Ç—Ä–∏–º –ø—Ä–æ—Å—Ç–æ–π –ø–ª–µ–π–±—É–∫ `playbooks/import.yml`, –∫–æ—Ç–æ—Ä—ã–π —Å–æ–∑–¥–∞—ë—Ç –¥–≤–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –∏ –¥–≤–∞ —Ñ–∞–π–ª–∞:

```yaml
---
- name: Demo import and include
  hosts: localhost
  gather_facts: no
  become: no

  vars:
    my_var: "Hello, Ansible!"
    create_files_flag: true

  tasks:
    - name: Create folder 1
      file:
        path: /tmp/demo/folder1
        state: directory
        mode: '0755'

    - name: Create folder 2
      file:
        path: /tmp/demo/folder2
        state: directory
        mode: '0755'  

    - block:
        - name: Create file 1
          copy:
            dest: /tmp/demo/file1.txt
            content: "{{ my_var }} - File 1"
            mode: '0644'  

        - name: Create file 2
          copy:
            dest: /tmp/demo/file2.txt
            content: "{{ my_var }} - File 2"
            mode: '0644'  
      when: create_files_flag
```

–¢–µ–ø–µ—Ä—å –≤—ã–Ω–µ—Å–µ–º –ª–æ–≥–∏–∫—É —Å–æ–∑–¥–∞–Ω–∏—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π –≤ –æ—Ç–¥–µ–ª—å–Ω—ã–π —Ñ–∞–π–ª `create_folders.yml` –∏ —Ä–∞–∑–º–µ—Å—Ç–∏–º –µ–≥–æ –≤ –ø–æ–¥–∫–∞—Ç–∞–ª–æ–≥–µ `subtasks`:

```yaml
- name: Create folder 1
  file:
    path: /tmp/demo/folder1
    state: directory
    mode: '0755'

- name: Create folder 2
  file:
    path: /tmp/demo/folder2
    state: directory
    mode: '0755'  
```

–õ–æ–≥–∏–∫—É —Å–æ–∑–¥–∞–Ω–∏—è —Ñ–∞–π–ª–æ–≤ –≤—ã–Ω–µ—Å–µ–º –≤ –æ—Ç–¥–µ–ª—å–Ω—ã–π —Ñ–∞–π–ª `subtasks/create_files.yml`:

```yaml
- name: Create file 1
  copy:
    dest: /tmp/demo/file1.txt
    content: "{{ my_var }} - File 1"
    mode: '0644'

- name: Create file 2
  copy:
    dest: /tmp/demo/file2.txt
    content: "{{ my_var }} - File 2"
    mode: '0644'
```

–ò–∑–º–µ–Ω–∏–º –ø–ª–µ–π–±—É–∫ `import.yml`, —É–¥–∞–ª–∏–≤ —Ä–∞–Ω–µ–µ –Ω–∞–ø–∏—Å–∞–Ω–Ω—ã–π –∫–æ–¥ –∏ –ø–æ–¥–∫–ª—é—á–∏–≤ –∑–∞–¥–∞—á–∏ —á–µ—Ä–µ–∑ –¥–∏—Ä–µ–∫—Ç–∏–≤—ã `import_tasks` –∏ `include_tasks`:

```yaml
---
- name: Demo import and include
  hosts: localhost
  gather_facts: no
  become: no

  vars:
    my_var: "Hello, Ansible!"
    create_files_flag: true

  tasks:
    - name: Create folders (imported statically)
      import_tasks: subtasks/create_folders.yml

    - name: Conditionally create files (included dynamically)
      include_tasks: subtasks/create_files.yml
      when: create_files_flag
      vars:
        my_var: "{{ my_var }} - overridden in include"
```

- `import_tasks` –ø–æ–¥—Ç—è–≥–∏–≤–∞–µ—Ç –∑–∞–¥–∞—á–∏ –∏–∑ `create_folders.yml` –Ω–∞ —ç—Ç–∞–ø–µ —Ä–∞–∑–±–æ—Ä–∞ –ø–ª–µ–π–±—É–∫–∞.
- `include_tasks` –ø–æ–¥—Ç—è–≥–∏–≤–∞–µ—Ç –∑–∞–¥–∞—á–∏ –∏–∑ `create_files.yml` –≤–æ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è, —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ `create_files_flag` —Ä–∞–≤–Ω–æ `true`. –ï—Å–ª–∏ –∏–∑–º–µ–Ω–∏—Ç—å `create_files_flag` –Ω–∞ `false`, –∑–∞–¥–∞—á–∏ —Å–æ–∑–¥–∞–Ω–∏—è —Ñ–∞–π–ª–æ–≤ –Ω–µ –±—É–¥—É—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω—ã –∏ –¥–∞–∂–µ –Ω–µ –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã.
- –í `include_tasks` –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è `my_var` –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–æ –≤–Ω—É—Ç—Ä–∏ –±–ª–æ–∫–∞, –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–∏—Ç—Å—è –∏ –Ω–∞ –≤—Å–µ –∑–∞–¥–∞—á–∏ –≤ –ø–æ–¥–∫–ª—é—á–∞–µ–º–æ–º —Ñ–∞–π–ª–µ.

## –®–∞–≥ 11. –î–∏—Ä–µ–∫—Ç–∏–≤—ã `delegate_to` –∏ `run_once`

### –î–∏—Ä–µ–∫—Ç–∏–≤–∞ `delegate_to`

`delegate_to` ‚Äî –¥–∏—Ä–µ–∫—Ç–∏–≤–∞ Ansible, –∫–æ—Ç–æ—Ä–∞—è –ø–æ–∑–≤–æ–ª—è–µ—Ç –≤—ã–ø–æ–ª–Ω–∏—Ç—å –∑–∞–¥–∞—á—É –Ω–µ –Ω–∞ —Ç–æ–º —Ö–æ—Å—Ç–µ, –∫ –∫–æ—Ç–æ—Ä–æ–º—É –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è Ansible, –∞ –Ω–∞ –¥—Ä—É–≥–æ–º. –ù–∞–ø—Ä–∏–º–µ—Ä, –º–æ–∂–Ω–æ –≤—ã–ø–æ–ª–Ω–∏—Ç—å –∑–∞–¥–∞—á—É –Ω–∞ —É–ø—Ä–∞–≤–ª—è—é—â–µ–º —Ö–æ—Å—Ç–µ (`localhost`), –ø—Ä–∏ —ç—Ç–æ–º –∏—Å–ø–æ–ª—å–∑—É—è –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç —Ü–µ–ª–µ–≤–æ–≥–æ —Ö–æ—Å—Ç–∞.

–î–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏ —Å–æ–∑–¥–∞–¥–∏–º –ø–ª–µ–π–±—É–∫ `playbooks/delegate.yml`:

```yaml
---
- name: Get IP and log on control node
  hosts: all
  gather_facts: no

  tasks:
    - name: Get IP address using hostname -I
      command: hostname -I
      register: ip_cmd

    - name: Set IP fact
      set_fact:
        node_ip: "{{ ip_cmd.stdout.split()[0] }}"  # –±–µ—Ä–µ–º –ø–µ—Ä–≤—ã–π IP –∏–∑ —Å–ø–∏—Å–∫–∞

    - name: Log IP on control node
      lineinfile:
        path: /tmp/ips.log  
        line: "{{ inventory_hostname }} -> {{ node_ip }}"
        create: yes
      delegate_to: localhost
```

–ó–∞–ø—É—Å—Ç–∏–≤ —ç—Ç–æ—Ç –ø–ª–µ–π–±—É–∫, –≤ —Ñ–∞–π–ª–µ `/tmp/ips.log` –Ω–∞ —É–ø—Ä–∞–≤–ª—è—é—â–µ–π –º–∞—à–∏–Ω–µ –±—É–¥–µ—Ç –∑–∞–ø–∏—Å–∞–Ω —Å–ø–∏—Å–æ–∫ IP-–∞–¥—Ä–µ—Å–æ–≤ –≤—Å–µ—Ö —Ü–µ–ª–µ–≤—ã—Ö —Ö–æ—Å—Ç–æ–≤:

```sh
cat /tmp/ips.log
minion2 -> 172.18.0.3
minion1 -> 172.18.0.4
minion3 -> 172.18.0.2
```

–ó–¥–µ—Å—å –Ω–∞ —Ü–µ–ª–µ–≤—ã—Ö —Ö–æ—Å—Ç–∞—Ö –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ –∫–æ–º–∞–Ω–¥–∞ `hostname -I`, –≤–æ–∑–≤—Ä–∞—â–∞—é—â–∞—è IP-–∞–¥—Ä–µ—Å. –ó–∞—Ç–µ–º —Å –ø–æ–º–æ—â—å—é `set_fact` –∑–Ω–∞—á–µ–Ω–∏–µ IP —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é `node_ip`. –ó–∞–¥–∞—á–∞ –∑–∞–ø–∏—Å–∏ —Å—Ç—Ä–æ–∫–∏ —Å –∏–º–µ–Ω–µ–º —Ö–æ—Å—Ç–∞ –∏ IP-–∞–¥—Ä–µ—Å–æ–º –¥–µ–ª–µ–≥–∏—Ä–æ–≤–∞–Ω–∞ –Ω–∞ —É–ø—Ä–∞–≤–ª—è—é—â–∏–π —É–∑–µ–ª —Å –ø–æ–º–æ—â—å—é `delegate_to: localhost`.

–í —Ä–∞–Ω–Ω–∏—Ö –≤–µ—Ä—Å–∏—è—Ö Ansible –æ–¥–Ω–∏–º –∏–∑ —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω—ë–Ω–Ω—ã—Ö –∫–µ–π—Å–æ–≤ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è `delegate_to` –±—ã–ª–æ –æ–∂–∏–¥–∞–Ω–∏–µ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ —Ü–µ–ª–µ–≤—ã—Ö —Ö–æ—Å—Ç–æ–≤ –ø–æ—Å–ª–µ –∏—Ö —É–¥–∞–ª—ë–Ω–Ω–æ–π –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏. –≠—Ç–æ –≤—ã–≥–ª—è–¥–µ–ª–æ –ø—Ä–∏–º–µ—Ä–Ω–æ —Ç–∞–∫:

```yaml
- name: Demo remote reboot server and wait 
  hosts: all
  gather_facts: yes
  become: yes

  tasks:
    - name: Reboot servers
      shell: sleep 3 && reboot now  # –í—ã–ø–æ–ª–Ω–∏—Ç—å –∫–æ–º–∞–Ω–¥—É –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏ —Å –∑–∞–¥–µ—Ä–∂–∫–æ–π 3 —Å–µ–∫—É–Ω–¥—ã
      async: 1                     # –†–∞–∑—Ä–µ—à–∏—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∫–æ–º–∞–Ω–¥—ã –≤ —Ñ–æ–Ω–µ (1 —Å–µ–∫—É–Ω–¥–∞ –¥–æ "–æ—Ç—Ä—ã–≤–∞")
      poll: 0                      # –ù–µ –∂–¥–∞—Ç—å –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è, –æ—Ç–ø—É—Å—Ç–∏—Ç—å –∑–∞–¥–∞—á—É –≤ —Ñ–æ–Ω

    - name: Wait for host to come back online
      wait_for:
        host: "{{ inventory_hostname }}"  # –•–æ—Å—Ç, –∫ –∫–æ—Ç–æ—Ä–æ–º—É –ø—ã—Ç–∞–µ–º—Å—è –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è (–∏–∑ inventory)
        state: started                    # –ñ–¥—ë–º, –ø–æ–∫–∞ –æ–Ω —Å—Ç–∞–Ω–µ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ TCP
        delay: 5                         # –ü–æ–¥–æ–∂–¥–∞—Ç—å 5 —Å–µ–∫—É–Ω–¥ –ø–µ—Ä–µ–¥ –ø–µ—Ä–≤–æ–π –ø—Ä–æ–≤–µ—Ä–∫–æ–π
        timeout: 60                      # –ú–∞–∫—Å–∏–º—É–º 60 —Å–µ–∫—É–Ω–¥ –Ω–∞ –æ–∂–∏–¥–∞–Ω–∏–µ
      delegate_to: localhost              # –í—ã–ø–æ–ª–Ω—è–µ–º –æ–∂–∏–¥–∞–Ω–∏–µ —Å –ª–æ–∫–∞–ª—å–Ω–æ–π –º–∞—à–∏–Ω—ã (–Ω–µ –Ω–∞ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º–æ–º —Ö–æ—Å—Ç–µ)
```

–û–¥–Ω–∞–∫–æ, –Ω–∞—á–∏–Ω–∞—è —Å –≤–µ—Ä—Å–∏–∏ Ansible 2.7 –∏ –≤—ã—à–µ, –¥–ª—è —ç—Ç–∏—Ö —Ü–µ–ª–µ–π —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π –º–æ–¥—É–ª—å `reboot`, –∫–æ—Ç–æ—Ä—ã–π –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –ø—Ä–æ—Ü–µ—Å—Å –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏ –∏ –æ–∂–∏–¥–∞–Ω–∏—è:

```yaml
- reboot:
    reboot_timeout: 120  # –í—Ä–µ–º—è –æ–∂–∏–¥–∞–Ω–∏—è –≤ —Å–µ–∫—É–Ω–¥–∞—Ö, –ø–æ–∫–∞ —Å–µ—Ä–≤–µ—Ä –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—Å—è –∏ —Å—Ç–∞–Ω–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã–º –ø–æ SSH.
```

### –î–∏—Ä–µ–∫—Ç–∏–≤–∞ `run_once`

–ï—Å–ª–∏ –ø–ª–µ–π–±—É–∫ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –Ω–∞ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Ö–æ—Å—Ç–∞—Ö, –Ω–æ –∑–∞–¥–∞—á—É –Ω—É–∂–Ω–æ –≤—ã–ø–æ–ª–Ω–∏—Ç—å —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —Ä–∞–∑ –Ω–∞ –æ–¥–Ω–æ–º –∏–∑ –Ω–∏—Ö, –∏—Å–ø–æ–ª—å–∑—É—é—Ç –¥–∏—Ä–µ–∫—Ç–∏–≤—É `run_once: true`. –û–Ω–∞ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç, —á—Ç–æ –∑–∞–¥–∞—á–∞ –±—É–¥–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ —Ä–æ–≤–Ω–æ –æ–¥–∏–Ω —Ä–∞–∑, –Ω–∞ –ø–µ—Ä–≤–æ–º —Ö–æ—Å—Ç–µ –∏–∑ —Å–ø–∏—Å–∫–∞, –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ–≥–æ –≤ inventory.

–ï—Å–ª–∏ —Ç—Ä–µ–±—É–µ—Ç—Å—è –≤—ã–ø–æ–ª–Ω–∏—Ç—å –∑–∞–¥–∞—á—É –Ω–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º —Ö–æ—Å—Ç–µ, —Å–ª–µ–¥—É–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–æ–º–±–∏–Ω–∞—Ü–∏—é `run_once: true` –∏ `delegate_to: –∏–º—è_—Ö–æ—Å—Ç–∞`.

–¢–∏–ø–∏—á–Ω—ã–µ —Å–ª—É—á–∞–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è `run_once`:

- –°–æ–∑–¥–∞–Ω–∏–µ –∏ —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –∫–ª—é—á–µ–π, –Ω–∞–ø—Ä–∏–º–µ—Ä, –¥–ª—è nginx –∏–ª–∏ HAProxy.
- –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ–±—â–∏—Ö –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π –¥–ª—è –∫–ª–∞—Å—Ç–µ—Ä–Ω—ã—Ö —Å–µ—Ä–≤–∏—Å–æ–≤.
- –ü–æ–ª—É—á–µ–Ω–∏–µ –µ–¥–∏–Ω–æ–≥–æ —Ç–æ–∫–µ–Ω–∞ –∏–ª–∏ API-–∫–ª—é—á–∞, –∫–æ—Ç–æ—Ä—ã–π –Ω–µ–æ–±—Ö–æ–¥–∏–º –≤—Å–µ–º —Ö–æ—Å—Ç–∞–º.

–ü—Ä–∏–º–µ—Ä –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∫–ª—é—á–∞ –∏ —Å–∞–º–æ–ø–æ–¥–ø–∏—Å–∞–Ω–Ω–æ–≥–æ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞ –æ–¥–∏–Ω —Ä–∞–∑ —Å –ø–æ—Å–ª–µ–¥—É—é—â–µ–π —Ä–∞—Å—Å—ã–ª–∫–æ–π –≤—Å–µ–º —Ö–æ—Å—Ç–∞–º:

```yaml
- name: Generate and distribute SSL cert
  hosts: webservers
  become: yes

  tasks:
    - name: Generate private key
      community.crypto.openssl_privatekey:
        path: /tmp/server.key
      run_once: true
      delegate_to: localhost

    - name: Generate self-signed certificate
      community.crypto.openssl_certificate:
        path: /tmp/server.crt
        privatekey_path: /tmp/server.key
        common_name: "example.local"
        provider: selfsigned
      run_once: true
      delegate_to: localhost

    - name: Copy cert and key to all servers
      copy:
        src: "/tmp/{{ item }}"
        dest: "/etc/ssl/{{ item }}"
        mode: "0600"
      loop:
        - server.key
        - server.crt
```

–í —ç—Ç–æ–º –ø—Ä–∏–º–µ—Ä–µ –∫–ª—é—á –∏ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –≥–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —Ä–∞–∑ –Ω–∞ —É–ø—Ä–∞–≤–ª—è—é—â–µ–º —Ö–æ—Å—Ç–µ (`localhost`), –∞ –∑–∞—Ç–µ–º —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω—è—é—Ç—Å—è –Ω–∞ –≤—Å–µ —Ü–µ–ª–µ–≤—ã–µ —Å–µ—Ä–≤–µ—Ä—ã.

## –®–∞–≥ 12. –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –≤ Ansible

–ò—Å–ø–æ–ª—å–∑—É—è Ansible –Ω–∞ –ø—Ä–∞–∫—Ç–∏–∫–µ, –≤–∞–∂–Ω–æ –ø–æ–Ω–∏–º–∞—Ç—å, –∫–∞–∫ –∏ –≤ –∫–∞–∫–æ–π –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –æ–Ω –∑–∞–ø—É—Å–∫–∞–µ—Ç –∑–∞–¥–∞—á–∏ –≤ –ø–ª–µ–π–±—É–∫–µ.  

–†–∞—Å—Å–º–æ—Ç—Ä–∏–º —Å–∏—Ç—É–∞—Ü–∏—é —Å —É–ø—Ä–∞–≤–ª—è—é—â–∏–º —Å–µ—Ä–≤–µ—Ä–æ–º (Ansible Master) –∏ —Ç—Ä–µ–º—è —Ü–µ–ª–µ–≤—ã–º–∏ —Ö–æ—Å—Ç–∞–º–∏ (minion1, minion2, minion3). –í –ø–ª–µ–π–±—É–∫–µ 4 –∑–∞–¥–∞—á–∏. –ü—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ –≤—Ç–æ—Ä–æ–π –∑–∞–¥–∞—á–∏ –Ω–∞ `minion2` –ø—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞.  

–û—Ç—Ä–∞–∑–∏–º —ç—Ç—É —Å–∏—Ç—É–∞—Ü–∏—é –≤ –≤–∏–¥–µ –¥–∏–∞–≥—Ä–∞–º–º—ã –ø–æ—Ç–æ–∫–æ–≤:

```mermaid
flowchart TD
    Master[Ansible Master]:::master

    Minion1[Minion1]:::node
    Minion2[Minion2]:::node
    Minion3[Minion3]:::node

    Master --> Minion1
    Master --> Minion2
    Master --> Minion3

    Minion1 --> T1m1[Task 1: OK]:::ok --> T2m1[Task 2: OK]:::ok --> T3m1[Task 3: OK]:::ok --> T4m1[Task 4: OK]:::ok
    Minion2 --> T1m2[Task 1: OK]:::ok --> T2m2[Task 2: FAILED]:::fail --> T3m2[Task 3: SKIPPED]:::skip --> T4m2[Task 4: SKIPPED]:::skip
    Minion3 --> T1m3[Task 1: OK]:::ok --> T2m3[Task 2: OK]:::ok --> T3m3[Task 3: OK]:::ok --> T4m3[Task 4: OK]:::ok

    classDef master fill:#dbeafe,stroke:#2563eb,color:#1e3a8a;
    classDef node fill:#f0f9ff,stroke:#0284c7,color:#075985;
    classDef ok fill:#d4f4dd,stroke:#2f8132,color:#2f8132;
    classDef fail fill:#f8d7da,stroke:#a71d2a,color:#a71d2a;
    classDef skip fill:#e2e3e5,stroke:#6c757d,color:#6c757d;
````

Ansible –∑–∞–ø—É—Å–∫–∞–µ—Ç –∑–∞–¥–∞—á–∏ –ø–æ –ø–æ—Ä—è–¥–∫—É, –∫–∞–∫ –æ–Ω–∏ —É–∫–∞–∑–∞–Ω—ã –≤ –ø–ª–µ–π–±—É–∫–µ, –ø—Ä–æ—Ö–æ–¥—è –ø–æ –≤—Å–µ–º —Ö–æ—Å—Ç–∞–º –≤ –ø–æ—Ä—è–¥–∫–µ, –∑–∞–¥–∞–Ω–Ω–æ–º –≤ –∏–Ω–≤–µ–Ω—Ç–∞—Ä–µ, –∏ –≤—ã–ø–æ–ª–Ω—è–µ—Ç –æ–¥–Ω—É –∑–∞–¥–∞—á—É –∑–∞ —Ä–∞–∑. –î–ª—è –∫–∞–∂–¥–æ–π –∑–∞–¥–∞—á–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø—É–ª –≤–æ—Ä–∫–µ—Ä–æ–≤ (forks, –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –∏—Ö 5), –ø–æ—ç—Ç–æ–º—É –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ, –Ω–æ —Ç–æ–ª—å–∫–æ –≤ —Ä–∞–º–∫–∞—Ö —Ç–µ–∫—É—â–µ–π –∑–∞–¥–∞—á–∏.

- Task 1 –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –Ω–∞ –≤—Å–µ—Ö —Ö–æ—Å—Ç–∞—Ö –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ.
- –ö–æ–≥–¥–∞ Task 1 –∑–∞–≤–µ—Ä—à—ë–Ω –Ω–∞ –≤—Å–µ—Ö —Ö–æ—Å—Ç–∞—Ö, - —Ç–æ–ª—å–∫–æ —Ç–æ–≥–¥–∞ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è Task 2.

–ï—Å–ª–∏ –Ω–∞ —Ö–æ—Å—Ç–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –æ—à–∏–±–∫–∞ –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ –∑–∞–¥–∞—á–∏, Ansible –ø–æ–º–µ—á–∞–µ—Ç —ç—Ç–æ—Ç —Ö–æ—Å—Ç –∫–∞–∫ "failed", –∏ –æ–Ω –∏—Å–∫–ª—é—á–∞–µ—Ç—Å—è –∏–∑ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –≤—Å–µ—Ö –ø–æ—Å–ª–µ–¥—É—é—â–∏—Ö –∑–∞–¥–∞—á –≤ –ø–ª–µ–π–±—É–∫–µ.

–ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –≤ –≤–∏–¥–µ –¥–∏–∞–≥—Ä–∞–º–º—ã:

```mermaid
sequenceDiagram
    participant master
    participant minion1
    participant minion2
    participant minion3

    Note over master: Task 1 start (parallel)

    par minion1
        master->>minion1: Execute Task 1
        minion1-->>master: OK
    and minion2
        master->>minion2: Execute Task 1
        minion2-->>master: OK
    and minion3
        master->>minion3: Execute Task 1
        minion3-->>master: OK
    end

    Note over master: Task 2 start (parallel)

    par minion1
        master->>minion1: Execute Task 2
        minion1-->>master: OK
    and minion2
        master->>minion2: Execute Task 2
        minion2-->>master: FAILED
    and minion3
        master->>minion3: Execute Task 2
        minion3-->>master: OK
    end

    Note over master: Task 3 start (parallel)

    par minion1
        master->>minion1: Execute Task 3
        minion1-->>master: OK
    and minion3
        master->>minion3: Execute Task 3
        minion3-->>master: OK
    end

    Note over minion2: Task 3 skipped due to failure

    Note over master: Task 4 start (parallel)

    par minion1
        master->>minion1: Execute Task 4
        minion1-->>master: OK
    and minion3
        master->>minion3: Execute Task 4
        minion3-->>master: OK
    end

    Note over minion2: Task 4 skipped due to failure
```

### `any_errors_fatal`

–ï—Å–ª–∏ —Ç—Ä–µ–±—É–µ—Ç—Å—è, —á—Ç–æ–±—ã –ø—Ä–∏ –æ—à–∏–±–∫–µ –Ω–∞ –ª—é–±–æ–º —Ö–æ—Å—Ç–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –ø–ª–µ–π–±—É–∫–∞ –ø—Ä–µ—Ä—ã–≤–∞–ª–æ—Å—å –ø–æ–ª–Ω–æ—Å—Ç—å—é, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–∏—Ä–µ–∫—Ç–∏–≤–∞:

```yaml
any_errors_fatal: true
```

–ü—Ä–∏–º–µ—Ä –ø–ª–µ–π–±—É–∫–∞ `playbooks/error_handling.yml`,  –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç –ø–µ—Ä–≤–æ–π –∑–∞–¥–∞—á–µ–π –æ–±–Ω–æ–≤–ª—è—Ç—å –∫–µ—à –º–µ–Ω–µ–¥–∂–µ—Ä–∞ –ø–∞–∫–µ—Ç–æ–≤ `apt`, –∞ –≤—Ç–æ—Ä–æ–π –∏ —Ç—Ä–µ—Ç—å–µ–π –∑–∞–¥–∞—á–µ–π –≤—ã–ø–æ–ª–Ω—è—Ç—å –∫–æ–º–∞–Ω–¥—É `echo`. –ü–æ—Å–∫–æ–ª—å–∫—É `minion3` –æ—Å–Ω–æ–≤–∞–Ω –Ω–∞ –¥–∏—Å—Ç—Ä–∏–±—É—Ç–∏–≤–µ `Red Hat`, —ç—Ç–æ—Ç —Ö–æ—Å—Ç –≤—ã–¥–∞—Å—Ç –æ—à–∏–±–∫—É, —Ç–∞–∫ –∫–∞–∫ –≤ –Ω—ë–º –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –º–µ–Ω–µ–¥–∂–µ—Ä –ø–∞–∫–µ—Ç–æ–≤ `dnf`.

```yaml
---
- name: Ansible error handling playbook
  hosts: all
  any_errors_fatal: true
  become: yes

  tasks:
    - name: Task 1 update apt cache
      apt:
        update_cache: yes

    - name: Task2
      shell: echo Task2

    - name: Task3
      shell: echo Task3
```

–ó–∞–ø—É—Å—Ç–∏–≤ –ø–ª–µ–π–±—É–∫, —Å–º–æ–∂–µ–º —É–±–µ–¥–∏—Ç—Å—è, —á—Ç–æ –ø–æ—Å–ª–µ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏—è –æ—à–∏–±–∫–∏, Ansible –æ—Å—Ç–∞–Ω–æ–≤–∏–ª –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –ø–ª–µ–π–±—É–∫–∞, –∏ –Ω–µ —Å—Ç–∞–ª –≤—ã–ø–æ–ª–Ω—è—Ç—å –∑–∞–¥–∞—á–∏ 2 –∏ 3 –Ω–∞ –¥—Ä—É–≥–∏—Ö —Ö–æ—Å—Ç–∞—Ö.

```sh
ansible-playbook playbooks/error_handling.yml

PLAY [Ansible error handling playbook] 

TASK [Gathering Facts] 
ok: [minion3]
ok: [minion2]
ok: [minion1]

TASK [Task 1 update apt cache] 
fatal: [minion3]: FAILED! => {"changed": false, "cmd": "update", "msg": "[Errno 2] No such file or directory: b'update'", "rc": 2, "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
ok: [minion1]
ok: [minion2]

PLAY RECAP 
minion1 : ok=2    changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   
minion2 : ok=2    changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   
minion3 : ok=1    changed=0    unreachable=0    failed=1    skipped=0    rescued=0    ignored=0   
```

–†–µ–∑—É–ª—å—Ç–∞—Ç: –ø—Ä–∏ –æ—à–∏–±–∫–µ –Ω–∞ –æ–¥–Ω–æ–º –∏–∑ —Ö–æ—Å—Ç–æ–≤ (`minion3` —Å RedHat –∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ–º `apt`) –¥–∞–ª—å–Ω–µ–π—à–∏–µ –∑–∞–¥–∞—á–∏ –Ω–µ –∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è –Ω–∞ –¥—Ä—É–≥–∏—Ö —Ö–æ—Å—Ç–∞—Ö.

–ï—Å–ª–∏ —É–±—Ä–∞—Ç—å `any_errors_fatal` –∏–ª–∏ –≤—ã—Å—Ç–∞–≤–∏—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ –∞—Ç—Ä–∏–±—É—Ç–∞ –≤ `false`, —Ç–æ–≥–¥–∞ –æ—Å—Ç–∞–ª—å–Ω—ã–µ —Ö–æ—Å—Ç—ã –ø—Ä–æ–¥–æ–ª–∂–∞—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ, –∫–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –≤ Ansible. –ó–∞–ø—É—Å—Ç–∏–º –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π –ø–ª–µ–π–±—É–∫, –∏ —É–±–µ–¥–∏–º—Å—è –≤ —ç—Ç–æ–º:

```sh
ansible-playbook playbooks/error_handling.yml

PLAY [Ansible error handling playbook] 

TASK [Gathering Facts] 
ok: [minion2]
ok: [minion1]
ok: [minion3]

TASK [Task 1 update apt cache] 
fatal: [minion3]: FAILED! => {"changed": false, "cmd": "update", "msg": "[Errno 2] No such file or directory: b'update'", "rc": 2, "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
ok: [minion1]
ok: [minion2]

TASK [Task2] 
changed: [minion1]
changed: [minion2]

TASK [Task3] 
changed: [minion1]
changed: [minion2]

PLAY RECAP 
minion1 : ok=4    changed=2    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   
minion2 : ok=4    changed=2    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   
minion3 : ok=1    changed=0    unreachable=0    failed=1    skipped=0    rescued=0    ignored=0   

```

### `ignore_errors`

–ï—Å–ª–∏ –º—ã —Ö–æ—Ç–∏–º, —á—Ç–æ–±—ã Ansible –∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–ª –æ—à–∏–±–∫—É –∏ –ø—Ä–æ–¥–æ–ª–∂–∞–ª –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —Å–ª–µ–¥—É—é—â–∏—Ö –∑–∞–¥–∞—á –Ω–∞ —Ö–æ—Å—Ç–µ, –≥–¥–µ –æ–Ω–∞ –≤–æ–∑–Ω–∏–∫–ª–∞, –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –≤ –∑–∞–¥–∞—á–µ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä `ignore_errors: yes` (–∏–ª–∏ `true`, —á—Ç–æ –≤ Ansible —ç–∫–≤–∏–≤–∞–ª–µ–Ω—Ç–Ω–æ).

```yaml
ignore_errors: yes
```

–ü—Ä–∏–º–µ—Ä:

```yaml
- name: Task 1 update apt cache
  apt:
    update_cache: yes
  ignore_errors: yes
```

–í —ç—Ç–æ–º —Å–ª—É—á–∞–µ, –¥–∞–∂–µ –µ—Å–ª–∏ –∑–∞–¥–∞—á–∞ –∑–∞–≤–µ—Ä—à–∏—Ç—Å—è –æ—à–∏–±–∫–æ–π –Ω–∞ –æ–¥–Ω–æ–º –∏–∑ —Ö–æ—Å—Ç–æ–≤, –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —Å–ª–µ–¥—É—é—â–∏—Ö –∑–∞–¥–∞—á –Ω–∞ —ç—Ç–æ–º –∂–µ —Ö–æ—Å—Ç–µ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—Å—è.

–ó–∞–ø—É—Å—Ç–∏–º –ø–ª–µ–π–±—É–∫, –∏ —É–±–µ–¥–∏–º—Å—è, —á—Ç–æ –Ω–µ—Å–º–æ—Ç—Ä—è –Ω–∞ —Ç–æ —á—Ç–æ –ø—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞, –∑–∞–¥–∞—á–∏ 2 –∏ 3 –≤—ã–ø–æ–ª–Ω–∏–ª–∏—Å—å –Ω–∞ minion3:

```sh
ansible-playbook playbooks/error_handling.yml

PLAY [Ansible error handling playbook] 

TASK [Gathering Facts] 
ok: [minion2]
ok: [minion1]
ok: [minion3]

TASK [Task 1 update apt cache] 
[WARNING]: Updating cache and auto-installing missing dependency: python3-apt
fatal: [minion3]: FAILED! => {"changed": false, "cmd": "update", "msg": "[Errno 2] No such file or directory: b'update'", "rc": 2, "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
...ignoring
ok: [minion1]
ok: [minion2]

TASK [Task2] 
changed: [minion2]
changed: [minion1]
changed: [minion3]

TASK [Task3] 
changed: [minion1]
changed: [minion2]
changed: [minion3]

PLAY RECAP 
minion1 : ok=4    changed=2    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   
minion2 : ok=4    changed=2    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   
minion3 : ok=4    changed=2    unreachable=0    failed=0    skipped=0    rescued=0    ignored=1  
```

### `failed_when`

**Ansible** —Å—á–∏—Ç–∞–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∑–∞–¥–∞—á–∏ **–Ω–µ—É–¥–∞—á–Ω—ã–º**, –µ—Å–ª–∏ –∫–æ–º–∞–Ω–¥–∞ –∏–ª–∏ –º–æ–¥—É–ª—å –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç **–Ω–µ–Ω—É–ª–µ–≤–æ–π –∫–æ–¥ –≤–æ–∑–≤—Ä–∞—Ç–∞** (`non-zero exit code`). –ï—Å–ª–∏ –∫–æ–¥ –≤–æ–∑–≤—Ä–∞—Ç–∞ —Ä–∞–≤–µ–Ω **0**, –∑–∞–¥–∞—á–∞ —Å—á–∏—Ç–∞–µ—Ç—Å—è —É—Å–ø–µ—à–Ω–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω–æ–π.
–ü–∞—Ä–∞–º–µ—Ç—Ä **`failed_when`** –ø–æ–∑–≤–æ–ª—è–µ—Ç –∏–∑–º–µ–Ω–∏—Ç—å —ç—Ç–æ –ø—Ä–∞–≤–∏–ª–æ –∏ –∑–∞–¥–∞—Ç—å **—Å–≤–æ—ë —É—Å–ª–æ–≤–∏–µ –¥–ª—è –≤—ã–∑–æ–≤–∞ –æ—à–∏–±–∫–∏**, –Ω–∞–ø—Ä–∏–º–µ—Ä, –Ω–∞ –æ—Å–Ω–æ–≤–µ –≤—ã–≤–æ–¥–∞ –∫–æ–º–∞–Ω–¥—ã –∏–ª–∏ –¥—Ä—É–≥–∏—Ö —Ñ–∞–∫—Ç–æ—Ä–æ–≤.

–°–Ω–∞—á–∞–ª–∞ –º–æ–¥–∏—Ñ–∏—Ü–∏—Ä—É–µ–º –ø–ª–µ–π–±—É–∫ –∏ –æ—Ç–æ–±—Ä–∞–∑–∏–º –ø–æ–ª–Ω—ã–π –≤—ã–≤–æ–¥ –∫–æ–º–∞–Ω–¥—ã `shell: echo Task2`:

```yaml
- name: Ansible error handling playbook
  hosts: all
  any_errors_fatal: false  # true - –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –ø–ª–µ–π–±—É–∫–∞ –ø—Ä–∏ –æ—à–∏–±–∫–µ –Ω–∞ –ª—é–±–æ–º —Ö–æ—Å—Ç–µ
  become: yes

  tasks:
    - name: Task 1 update apt cache
      apt:
        update_cache: yes
      ignore_errors: yes  # –∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞—Ç—å –æ—à–∏–±–∫—É –∏ –ø—Ä–æ–¥–æ–ª–∂–∞—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∑–∞–¥–∞—á –Ω–∞ —ç—Ç–æ–º —Ö–æ—Å—Ç–µ

    - name: Task2
      shell: echo Task2
      register: result

    - debug:
        var: result

    - name: Task3
      shell: echo Task3
```

–ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ –ø–ª–µ–π–±—É–∫–∞ –∏ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –≤—ã–≤–æ–¥–∞ –º—ã –≤–∏–¥–∏–º, —á—Ç–æ –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è **`result`** —Å–æ–¥–µ—Ä–∂–∏—Ç –ø–æ–¥—Ä–æ–±–Ω—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ –∫–æ–º–∞–Ω–¥—ã:

```sh
TASK [debug]
ok: [minion1] => {
    "result": {
        "changed": true,
        "cmd": "echo Task2",
        "delta": "0:00:00.002790",
        "end": "2025-07-17 20:00:11.915887",
        "failed": false,
        "msg": "",
        "rc": 0,
        "start": "2025-07-17 20:00:11.913097",
        "stderr": "",
        "stderr_lines": [],
        "stdout": "Task2",
        "stdout_lines": [
            "Task2"
        ]
    }
}
```

- `"rc": 0` ‚Äî –ø–æ–ª–µ —Å **–∫–æ–¥–æ–º –≤–æ–∑–≤—Ä–∞—Ç–∞**.
- `"stderr": ""` ‚Äî —Å–æ–¥–µ—Ä–∂–∏—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ–± –æ—à–∏–±–∫–µ, –µ—Å–ª–∏ –æ–Ω–∞ –±—ã–ª–∞ –±—ã, –∏ –∫–æ–¥ –≤–æ–∑–≤—Ä–∞—Ç–∞ –±—ã–ª –±—ã –±–æ–ª—å—à–µ 0.
- `"stdout": "Task2"` ‚Äî —Å–æ–¥–µ—Ä–∂–∏—Ç **–≤—ã–≤–æ–¥ –∫–æ–º–∞–Ω–¥—ã**.

–í –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Ü–µ–ª—è—Ö –∏–∑–º–µ–Ω–∏–º –ø–ª–µ–π–±—É–∫ —Ç–∞–∫, —á—Ç–æ–±—ã –≤–æ–∑–Ω–∏–∫–∞–ª–∞ –æ—à–∏–±–∫–∞, –µ—Å–ª–∏ –≤ –≤—ã–≤–æ–¥–µ –∫–æ–º–∞–Ω–¥—ã `echo Task2` —Å–æ–¥–µ—Ä–∂–∏—Ç—Å—è —Å–ª–æ–≤–æ `Task2` (–∞ –æ–Ω–æ, –∫–æ–Ω–µ—á–Ω–æ –∂–µ, —Å–æ–¥–µ—Ä–∂–∏—Ç—Å—è):

```yaml
- name: Ansible error handling playbook
  hosts: all
  any_errors_fatal: false  # true - –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –ø–ª–µ–π–±—É–∫–∞ –ø—Ä–∏ –æ—à–∏–±–∫–µ –Ω–∞ –ª—é–±–æ–º —Ö–æ—Å—Ç–µ
  become: yes

  tasks:
    - name: Task 1 update apt cache
      apt:
        update_cache: yes
      ignore_errors: yes  # –∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞—Ç—å –æ—à–∏–±–∫—É –∏ –ø—Ä–æ–¥–æ–ª–∂–∞—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∑–∞–¥–∞—á –Ω–∞ —ç—Ç–æ–º —Ö–æ—Å—Ç–µ

    - name: Task2
      shell: echo Task2
      register: result
      failed_when: "'Task2' in result.stdout"  # –≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º –æ—à–∏–±–∫—É –Ω–∞ –æ—Å–Ω–æ–≤–∞–Ω–∏–∏ –≤—ã–≤–æ–¥–∞ –∫–æ–º–∞–Ω–¥—ã

    - debug:
        var: result

    - name: Task3
      shell: echo Task3
```

–ó–∞–ø—É—Å—Ç–∏–º –ø–ª–µ–π–±—É–∫ –∏ —É–±–µ–¥–∏–º—Å—è, —á—Ç–æ –≤—Å—ë —Å—Ä–∞–±–æ—Ç–∞–ª–æ, –∫–∞–∫ –∑–∞–¥—É–º–∞–Ω–æ, —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–∞ –æ—à–∏–±–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–¥–∞—á–∏:

```sh
ansible-playbook playbooks/error_handling.yml
...

TASK [Task2]
fatal: [minion2]: FAILED! => {
  "changed": true,
  "cmd": "echo Task2",
  "failed_when_result": "The conditional check ''Task2' in result.stdout' failed.",
  "msg": "",
  "rc": 0,
  "stderr": "",
  "stdout": "Task2",
  "stdout_lines": ["Task2"]
}
fatal: [minion1]: FAILED! => {... –∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ ...}
fatal: [minion3]: FAILED! => {... –∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ ...}
...
```

–í–æ—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç –≥–ª–∞–≤—ã –≤ —Ñ–æ—Ä–º–∞—Ç–µ Markdown, –±–µ–∑ —Å–æ–∫—Ä–∞—â–µ–Ω–∏—è, —Å —É—á—ë—Ç–æ–º –≤—Å–µ—Ö –∑–∞–º–µ—á–∞–Ω–∏–π –∏ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–Ω—ã—Ö –ø—Ä–∞–≤–æ–∫:

## –®–∞–≥ 13. –†–∞–±–æ—Ç–∞ —Å —Å–µ–∫—Ä–µ—Ç–∞–º–∏ ‚Äî ansible-vault

`ansible-vault` ‚Äî —ç—Ç–æ –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç Ansible –¥–ª—è —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö (–ø–∞—Ä–æ–ª–∏, –∫–ª—é—á–∏, —Å–µ–∫—Ä–µ—Ç—ã). –û–Ω –ø–æ–∑–≤–æ–ª—è–µ—Ç –∑–∞—â–∏—â–∞—Ç—å:

- —Ü–µ–ª—ã–µ —Ñ–∞–π–ª—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä, `vars.yml`, –∏–ª–∏ –¥–∞–∂–µ –ø–ª–µ–π–±—É–∫–∏ —Ü–µ–ª–∏–∫–æ–º)
- –æ—Ç–¥–µ–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –≤ –ø–ª–µ–π–±—É–∫–∞—Ö —á–µ—Ä–µ–∑ `!vault`
- –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ–±—â–∏–µ –ø–∞—Ä–æ–ª–∏ –∏–ª–∏ –∫–ª—é—á–∏ –¥–ª—è —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∫–∏ –≤–æ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

### –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã–π —Ñ–∞–π–ª:

```sh
ansible-vault create secrets.yml
```

–ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –±—É–¥–µ—Ç –∑–∞–ø—Ä–æ—à–µ–Ω –ø–∞—Ä–æ–ª—å –∏ –µ–≥–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ, –ø–æ—Å–ª–µ —á–µ–≥–æ –æ—Ç–∫—Ä–æ–µ—Ç—Å—è —Ä–µ–¥–∞–∫—Ç–æ—Ä `vim` (–µ—Å–ª–∏ –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω –¥—Ä—É–≥–æ–π, –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è vim, –Ω–æ –µ–≥–æ –º–æ–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å, –∑–∞–¥–∞–≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –æ–∫—Ä—É–∂–µ–Ω–∏—è EDITOR, –Ω–∞–ø—Ä–∏–º–µ—Ä: export EDITOR=nano). –í –æ—Ç–∫—Ä—ã–≤—à–µ–º—Å—è —Ä–µ–¥–∞–∫—Ç–æ—Ä–µ –º–æ–∂–Ω–æ –±—É–¥–µ—Ç –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∏ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤–Ω–æ–≤—å —Å–æ–∑–¥–∞–Ω–Ω—ã–π –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã–π —Ñ–∞–π–ª.

–û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã–π —Ñ–∞–π–ª:

```sh
ansible-vault edit secrets.yml
```

–ë—É–¥–µ—Ç –∑–∞–ø—Ä–æ—à–µ–Ω –ø–∞—Ä–æ–ª—å –¥–ª—è –¥–µ—à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è, –ø–æ—Å–ª–µ —á–µ–≥–æ –æ—Ç–∫—Ä–æ–µ—Ç—Å—è —Ä–µ–¥–∞–∫—Ç–æ—Ä `vim`, —Å –ø–æ–º–æ—â—å—é –∫–æ—Ç–æ—Ä–æ–≥–æ –º–æ–∂–Ω–æ –±—É–¥–µ—Ç –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã–π —Ñ–∞–π–ª –∏ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è.

–®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ —Ñ–∞–π–ª–∞:

```sh
ansible-vault encrypt hi.txt
```

–ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∫–æ–º–∞–Ω–¥—ã –∏ —É–∫–∞–∑–∞–Ω–∏—è –ø–∞—Ä–æ–ª—è –¥–ª—è —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è, —Ñ–∞–π–ª `hi.txt` –±—É–¥–µ—Ç –ø–µ—Ä–µ–∑–∞–ø–∏—Å–∞–Ω —Å –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã–º —Å–æ–¥–µ—Ä–∂–∏–º—ã–º.

–†–∞—Å—à–∏—Ñ—Ä–æ–≤–∞—Ç—å —Ñ–∞–π–ª –≤—Ä—É—á–Ω—É—é –º–æ–∂–Ω–æ —Å –ø–æ–º–æ—â—å—é –∫–æ–º–∞–Ω–¥—ã `decrypt`:

```sh
ansible-vault decrypt hi.txt
```

–ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∫–æ–º–∞–Ω–¥—ã –∏ –≤–≤–æ–¥–∞ –ø–∞—Ä–æ–ª—è –¥–ª—è —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∫–∏, —Ñ–∞–π–ª –±—É–¥–µ—Ç –ø–µ—Ä–µ–∑–∞–ø–∏—Å–∞–Ω —É–∂–µ —Å —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã–º —Å–æ–¥–µ—Ä–∂–∏–º—ã–º.

–ó–∞–ø—É—Å–∫ –ø–ª–µ–π–±—É–∫–∞, –∫–æ—Ç–æ—Ä—ã–π –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ, —Å –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–º –∑–∞–ø—Ä–æ—Å–æ–º –ø–∞—Ä–æ–ª—è:

```sh
ansible-playbook playbook.yml --ask-vault-pass
```

–ú–æ–∂–Ω–æ –∑–∞–ø—É—Å—Ç–∏—Ç—å –ø–ª–µ–π–±—É–∫, —É–∫–∞–∑–∞–≤ —Ñ–∞–π–ª (–≤ –¥–∞–Ω–Ω–æ–º —Å–ª—É—á–∞–µ `.vault_pass.txt`), –≤ –∫–æ—Ç–æ—Ä–æ–º —É–∫–∞–∑–∞–Ω –ø–∞—Ä–æ–ª—å:

```sh
ansible-playbook playbook.yml --vault-password-file .vault_pass.txt
```

–§–∞–π–ª —Å –ø–∞—Ä–æ–ª–µ–º –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å —Ç–æ–ª—å–∫–æ –æ–¥–Ω—É —Å—Ç—Ä–æ–∫—É —Å –æ–¥–Ω–∏–º –ø–∞—Ä–æ–ª–µ–º –∏ –±–æ–ª—å—à–µ –Ω–∏—á–µ–≥–æ.

### –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö —Å—Ç—Ä–æ–∫

–ù–∞—á–∏–Ω–∞—è —Å –≤–µ—Ä—Å–∏–∏ 2.3+, Ansible –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö —Å—Ç—Ä–æ–∫. –≠—Ç–æ —Å–∞–º—ã–π —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω—ë–Ω–Ω—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è `ansible-vault`, –∫–æ–≥–¥–∞ —à–∏—Ñ—Ä—É—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –æ—Ç–¥–µ–ª—å–Ω—ã–µ —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (–ø–∞—Ä–æ–ª–∏, —Ç–æ–∫–µ–Ω—ã –∏ —Ç.–¥.). –†–∞—Å—Å–º–æ—Ç—Ä–∏–º –±–æ–ª–µ–µ –ø–æ–¥—Ä–æ–±–Ω–æ —ç—Ç–æ—Ç –∫–µ–π—Å.

–§–æ—Ä–º–∞—Ç –∫–æ–º–∞–Ω–¥—ã –¥–ª—è —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è –æ—Ç–¥–µ–ª—å–Ω—ã—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö:

```sh
ansible-vault encrypt_string '—Å–µ–∫—Ä–µ—Ç–Ω–æ–µ_–∑–Ω–∞—á–µ–Ω–∏–µ' --name '–∏–º—è_–ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π'
```

–ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ –∫–æ–º–∞–Ω–¥—ã –±—É–¥–µ—Ç –∑–∞–ø—Ä–æ—à–µ–Ω –ø–∞—Ä–æ–ª—å –∏ –µ–≥–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –¥–ª—è —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è. –í —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ –±—É–¥–µ—Ç –≤—ã–≤–µ–¥–µ–Ω–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è —Å –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã–º –∑–Ω–∞—á–µ–Ω–∏–µ–º.

–ù–∞–ø—Ä–∏–º–µ—Ä, –∏—Å–ø–æ–ª—å–∑—É—è –ø–∞—Ä–æ–ª—å `123456`, –∫–æ–º–∞–Ω–¥–∞:

```sh
ansible-vault encrypt_string 'SuperSecret123' --name 'db_password'
```

–≤—ã–≤–µ–¥–µ—Ç:

```yaml
db_password: !vault |
          $ANSIBLE_VAULT;1.1;AES256
          32663239623166396536383966366130323639353765316232313238383532396235643133303531
          3865656634353039323362616665393337643536633361610a343130663662666365306234303861
          66653362353737653366323433343030356265323933653764336237636430613538633031616634
          3437663037306335620a376564323233323161653439656362613862393230383036646365396563
          6435
```

–°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ, –º—ã –º–æ–∂–µ–º —Å—Ä–∞–∑—É –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–∏—Ç—å —ç—Ç–æ—Ç –≤—ã–≤–æ–¥ –≤ —Ñ–∞–π–ª —Å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏, –Ω–∞–ø—Ä–∏–º–µ—Ä:

```sh
{ echo ""; ansible-vault encrypt_string 'SuperSecret123' --name 'db_password'; } >> group_vars/all.yml
```

–ü—Ä–æ–≤–µ—Ä–∏–º —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–∞–π–ª–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö:

```sh
cat group_vars/all.yml
```

```yaml
db_password: !vault |
          $ANSIBLE_VAULT;1.1;AES256
          64303065663263643162653438643230663965643935626438623937373539646633653938353039
          3834323132363861326431396437366634396537393832300a323032666566353637356136356162
          36613532616533326433656466336535633135376635653930353562613766613735316465623630
          6533393330383733360a626566353864373263643164326435373530363737383431643262303137
          6638
```

–ï—Å–ª–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–µ–∫—Ä–µ—Ç–Ω—ã—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö, –∏—Ö –Ω—É–∂–Ω–æ —à–∏—Ñ—Ä–æ–≤–∞—Ç—å –æ–¥–Ω–∏–º –∏ —Ç–µ–º –∂–µ –ø–∞—Ä–æ–ª–µ–º. Ansible –ø–æ–∑–≤–æ–ª—è–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑–Ω—ã—Ö –ø–∞—Ä–æ–ª–µ–π, –Ω–æ —ç—Ç–æ—Ç –≤–∞—Ä–∏–∞–Ω—Ç –≤—ã—Ö–æ–¥–∏—Ç –∑–∞ —Ä–∞–º–∫–∏ –¥–∞–Ω–Ω–æ–≥–æ –±–∞–∑–æ–≤–æ–≥–æ –∫—É—Ä—Å–∞ –∏ –Ω–µ —Ä–∞—Å—Å–º–∞—Ç—Ä–∏–≤–∞–µ—Ç—Å—è –∑–¥–µ—Å—å.

–ù–∞–ø–∏—à–µ–º –ø—Ä–æ—Å—Ç–æ–π –ø–ª–µ–π–±—É–∫ `ansible_vault.yml`, –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç –≤—ã–≤–æ–¥–∏—Ç—å —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ —Å–µ–∫—Ä–µ—Ç–Ω–æ–π –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π:

```yaml
- hosts: localhost
  tasks:
    - name: Show secret vars
      debug:
        msg: "Password={{ db_password }}"
```

–ó–∞–ø—É—Å—Ç–∏–º –µ–≥–æ:

```sh
ansible-playbook playbooks/ansible_vault.yml --ask-vault-pass
```

–ò —É–≤–∏–¥–∏–º –≤—ã–≤–æ–¥:

```sh
TASK [Show secret vars]
ok: [localhost] => {
    "msg": "Password=SuperSecret123"
}
```

## –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–ù–∞ —ç—Ç–æ–º –±–∞–∑–æ–≤—ã–π –∫—É—Ä—Å –ø–æ Ansible –º–æ–∂–Ω–æ —Å—á–∏—Ç–∞—Ç—å –∑–∞–≤–µ—Ä—à—ë–Ω–Ω—ã–º. Ansible ‚Äî –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –º–æ—â–Ω—ã–π, –≥–∏–±–∫–∏–π –∏ –∑—Ä–µ–ª—ã–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏. –û–Ω –ø–æ–∑–≤–æ–ª—è–µ—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å –∏ —É–ø—Ä–∞–≤–ª—è—Ç—å —Ä–µ—Å—É—Ä—Å–∞–º–∏ –∫–∞–∫ –Ω–∞ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã—Ö —Å–µ—Ä–≤–µ—Ä–∞—Ö, —Ç–∞–∫ –∏ —É –æ–±–ª–∞—á–Ω—ã—Ö –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤ (AWS, GCP, Azure). –¢–µ–º –Ω–µ –º–µ–Ω–µ–µ, –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –æ–±–ª–∞—á–Ω–æ–π –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π —è —Ä–µ–∫–æ–º–µ–Ω–¥—É—é –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –±–æ–ª–µ–µ –¥–µ–∫–ª–∞—Ä–∞—Ç–∏–≤–Ω—ã–µ –ø–æ–¥—Ö–æ–¥—ã –∏ —Ç–∞–∫–∏–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã, –∫–∞–∫ Terraform.

Ansible —Ö–æ—Ä–æ—à–æ –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è *"–¥–æ–º–∞—à–Ω–∏–º–∏ –ø–∏—Ç–æ–º—Ü–∞–º–∏"* (pet) ‚Äî —É–Ω–∏–∫–∞–ª—å–Ω—ã–º–∏ —Å–µ—Ä–≤–µ—Ä–∞–º–∏, –∫–æ—Ç–æ—Ä—ã–º —É–¥–µ–ª—è–µ—Ç—Å—è –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–æ–µ –≤–Ω–∏–º–∞–Ω–∏–µ: –∏—Ö –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—é—Ç –≤—Ä—É—á–Ω—É—é, –∏—Ö "–ª–µ—á–∞—Ç", –µ—Å–ª–∏ –æ–Ω–∏ –ª–æ–º–∞—é—Ç—Å—è. –¢–∞–∫–æ–π –ø–æ–¥—Ö–æ–¥ –æ–ø—Ä–∞–≤–¥–∞–Ω –¥–ª—è –Ω–µ–±–æ–ª—å—à–∏—Ö –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä, –≥–¥–µ –≤–∞–∂–Ω–∞ –≥–∏–±–∫–æ—Å—Ç—å –∏ –∫–æ–Ω—Ç—Ä–æ–ª—å –Ω–∞–¥ –∫–∞–∂–¥–æ–π –º–∞—à–∏–Ω–æ–π.

–û–¥–Ω–∞–∫–æ –≤ –∫—Ä—É–ø–Ω—ã—Ö –∏ –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º—ã—Ö —Å–∏—Å—Ç–µ–º–∞—Ö –ø—Ä–µ–¥–ø–æ—á—Ç–∏—Ç–µ–ª—å–Ω–µ–µ –ø–æ–¥—Ö–æ–¥ *"—Å–∫–æ—Ç"* (cattle) ‚Äî –∫–æ–≥–¥–∞ –∫–∞–∂–¥—ã–π —Å–µ—Ä–≤–µ—Ä –∏–¥–µ–Ω—Ç–∏—á–µ–Ω –∏ –ª–µ–≥–∫–æ –∑–∞–º–µ–Ω–∏–º. –¢–∞–∫–∏–µ —Å–µ—Ä–≤–µ—Ä—ã –Ω–µ –ª–µ—á–∞—Ç ‚Äî –∏—Ö –ø—Ä–æ—Å—Ç–æ –∑–∞–º–µ–Ω—è—é—Ç –Ω–∞ –Ω–æ–≤—ã–µ. –≠—Ç–æ —É–ø—Ä–æ—â–∞–µ—Ç —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ, —Å–Ω–∏–∂–∞–µ—Ç —Ä–∏—Å–∫ –æ—à–∏–±–æ–∫ –∏ –ø–æ–≤—ã—à–∞–µ—Ç –æ—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å.

Ansible –º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –≤ –æ–±–æ–∏—Ö –ø–æ–¥—Ö–æ–¥–∞—Ö, –Ω–æ –æ—Å–æ–±–µ–Ω–Ω–æ —Ö–æ—Ä–æ—à–æ —Å–µ–±—è –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –≤ *pet*-–ø–æ–¥—Ö–æ–¥–µ. –ï—Å–ª–∏ –∂–µ –≤—ã —Å—Ç—Ä–æ–∏—Ç–µ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—É –ø–æ –ø—Ä–∏–Ω—Ü–∏–ø–∞–º *cattle*, —Ä–∞—Å—Å–º–æ—Ç—Ä–∏—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ Terraform, Kubernetes –∏ –¥—Ä—É–≥–∏—Ö –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤, –æ—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –Ω–∞ –¥–µ–∫–ª–∞—Ä–∞—Ç–∏–≤–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏–π.
